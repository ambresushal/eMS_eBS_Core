/*!
 * Source version: 1.1.19 
 * Copyright (C) 2018 LoopIndex - All Rights Reserved
 * You may use, distribute and modify this code under the
 * terms of the LoopIndex Comments CKEditor plugin license.
 * Attributions
 *
 * Rangy library:
 * Copyright 2018, Tim Down
 * https://github.com/timdown/rangy
 * license: MIT
 *
 * jQuery
 * Copyright JS Foundation and other contributors, https://js.foundation/
 * https://github.com/jquery/jquery
 * license: MIT
 *
 * Opentip adapter
 * Copyright (c) 2018, Matias Meno  
 * http://www.opentip.org
 * license: MIT
 *
 * Mutation summary
 * Copyright (c) 2018 Rafael Weinstein
 * https://github.com/rafaelw/mutation-summary
 * license: Apache 
 *
 * ice code:
 * inspired by work by Matthew DeLambo, The New York Times, CMS Group
 * https://github.com/NYTimes/ice
 *
 * You should have received a copy of the LoopIndex FLITE CKEditor plugin license with
 * this file. If not, please write to: contact@loopindex.com, or visit http://www.loopindex.com
 *
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 *
 * LICENSES
 * 
 * The MIT License (MIT)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * Apache license: see http://www.apache.org/licenses/
 */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){(function(e){!function(){"use strict";!function(e,t){e.FLITE=t.extend(e.FLITE||{},{Logger:function(){var e={log:!1,debug:!1,warn:!1,error:!1,trace:!1};return{_logs:[],config:function(n){t.extend(e,n)},ignore:function(){},log:function(){e.log&&this._log("log",Array.prototype.slice.call(arguments))},error:function(){e.error&&this._log("error",Array.prototype.slice.call(arguments))},debug:function(){e.debug&&this._log("log",Array.prototype.slice.call(arguments))},trace:function(){if(e.trace){var t=Error().stack,n=t?[t.replace("Error","Debug:"),"\n"]:[];this._log("log",n.concat(Array.prototype.slice.call(arguments)))}},warn:function(){this._log("warn",Array.prototype.slice.call(arguments))},_log:function(e,t){var n=new Date,i=[n.getMinutes(),n.getSeconds(),n.getMilliseconds()].join(":");t.unshift(i+">"),this._logs.push({method:e,logs:t}),this.scheduleDump()},dump:function(){var e=this._logs;this._logs=[],e.forEach(function(e){console[e.method].apply(console,e.logs)})},timeout:null,scheduleDump:function(){this.timeout||(this.timeout=setTimeout(function(){this.timeout=null,this.dump()}.bind(this),100))}}}()}),e.exports=e.exports||{}}(window||this,window.jQuery),function(){!function(e,t){t||console.error("rangy: root is undefined"),t.rangy=e(t),t.Logger.scheduleDump()}(function(e){var t="object",n="function",i="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],a=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function l(e,i){var r=typeof e[i];return r==n||!(r!=t||!e[i])||"unknown"==r}function d(e,n){return!(typeof e[n]!=t||!e[n])}function h(e,t){return typeof e[t]!=i}function c(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}var u=c(l),p=c(d),f=c(h);function g(e){return e&&u(e,a)&&f(e,s)}function m(e){return d(e,"body")?e.body:e.getElementsByTagName("body")[0]}var v,_,y={},N=typeof window!=i&&typeof document!=i,C={isHostMethod:l,isHostObject:d,isHostProperty:h,areHostMethods:u,areHostObjects:p,areHostProperties:f,isTextRange:g,getBody:m,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,i=e.length;n<i;++n)t(e[n],n)}},T={version:"1.3.0",initialized:!1,isBrowser:N,supported:!0,util:C,features:{},modules:y,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==i||rangyAutoInitialize}};function b(e){typeof console!=i&&l(console,"log")&&console.log(e)}function E(e,t){N&&t?alert(e):b(e)}function S(t){e.Logger.log("rangy module fail",t),T.initialized=!0,T.supported=!1,E("Rangy is not supported in this environment. Reason: "+t,T.config.alertOnFail)}T.fail=S,T.warn=function(e){E("Rangy warning: "+e,T.config.alertOnWarn)},{}.hasOwnProperty?(C.extend=v=function(e,t,n){var i,r;for(var o in t)t.hasOwnProperty(o)&&(i=e[o],r=t[o],n&&null!==i&&"object"==typeof i&&null!==r&&"object"==typeof r&&v(i,r,!0),e[o]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},C.createOptions=function(e,t){var n={};return v(n,t),e&&v(n,e),n}):S("hasOwnProperty not supported"),N||S("Rangy can only run in a browser"),function(){var e;if(N){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,i=e.length;n<i;++n)t[n]=e[n];return t}),C.toArray=e}(),N&&(l(document,"addEventListener")?_=function(e,t,n){e.addEventListener(t,n,!1)}:l(document,"attachEvent")?_=function(e,t,n){e.attachEvent("on"+t,n)}:S("Document does not have required addEventListener or attachEvent method"),C.addListener=_);var O=[];function w(e){return e.message||e.description||String(e)}function k(){if(N&&!T.initialized){var e,t=!1,n=!1;l(document,"createRange")&&(e=document.createRange(),u(e,o)&&f(e,r)&&(t=!0));var i=m(document);if(i&&"body"==i.nodeName.toLowerCase())if(i&&l(i,"createTextRange")&&g(e=i.createTextRange())&&(n=!0),t||n){var s;for(var a in T.initialized=!0,T.features={implementsDomRange:t,implementsTextRange:n},y)(s=y[a])instanceof I&&s.init(s,T);for(var d=0,h=O.length;d<h;++d)try{O[d](T)}catch(e){b("Rangy init listener threw an exception. Continuing. Detail: "+w(e))}}else S("Neither Range nor TextRange are available");else S("No body element found")}}function x(e,t,n){n&&(e+=" in module "+n.name),T.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function R(e,t,n,i){e[t]=function(){return x(t,n,i),e[n].apply(e,C.toArray(arguments))}}C.deprecationNotice=x,C.createAliasForDeprecatedMethod=R,T.init=k,T.addInitListener=function(e){T.initialized?e(T):O.push(e)};var D=[];function I(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function A(e,t,n){var i=new I(e,t,function(t){if(!0!==t.initialized)try{n(T,t),t.supported=!0}catch(t){b("Module '"+e+"' failed to load: "+w(t)),t.stack&&b(t.stack)}});return y[e]=i,i}function L(){}T.addShimListener=function(e){D.push(e)},N&&(T.shim=T.createMissingNativeApi=function(e){e=e||window,k();for(var t=0,n=D.length;t<n;++t)D[t](e)},R(T,"createMissingNativeApi","shim")),I.prototype={init:function(){for(var e,t,n=this.dependencies||[],i=0,r=n.length;i<r;++i){if(t=n[i],!((e=y[t])&&e instanceof I))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this),this.initialized=!0},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){T.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){T.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},T.createModule=function(e){var t,n;2===arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var i=A(e,n,t);T.initialized&&T.supported&&i.init()},T.createCoreModule=function(e,t,n){A(e,t,n)},T.RangePrototype=L,T.rangePrototype=new L,T.selectionPrototype=new function(){},T.createCoreModule("DomUtil",[],function(e,t){var n="undefined",i=e.util,r=i.getBody;i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),i.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var o=document.createElement("div");i.areHostMethods(o,["insertBefore","appendChild","cloneNode"]||!i.areHostObjects(o,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),i.isHostProperty(o,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");i.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!i.areHostObjects(o,["previousSibling","nextSibling","childNodes","parentNode"])||!i.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var a=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function l(e){for(var t=0;e=e.previousSibling;)++t;return t}function d(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(a(i,n))return n;return null}function h(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function c(e,t,n){for(var i,r=n?e:e.parentNode;r;){if((i=r.parentNode)===t)return r;r=i}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function p(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return f(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var i=f(e);if(typeof i.defaultView!=n)return i.defaultView;if(typeof i.parentWindow!=n)return i.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){return e&&i.isHostMethod(e,"setTimeout")&&i.isHostObject(e,"document")}var _,y=!1;function N(e){try{return e.parentNode,!1}catch(e){return!0}}function C(e){if(!e)return"[No node]";if(y&&N(e))return"[Broken node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+l(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function T(e){this.root=e,this._next=e}function b(e,t){this.node=e,this.offset=t}function E(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",y=N(n),e.features.crashyTextNodes=y}(),typeof window.getComputedStyle!=n?_=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?_=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),T.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},b.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+C(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},e.dom={arrayContains:a,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==n||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:l,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:d,isAncestorOf:h,isOrIsAncestorOf:function(e,t){return h(e,t,!0)},getClosestAncestorIn:c,isCharacterDataNode:u,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:p,splitDataNode:function(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),p(i,e),n)for(var r,o=0;r=n[o++];)r.node==e&&r.offset>t?(r.node=i,r.offset-=t):r.node==e.parentNode&&r.offset>l(e)&&++r.offset;return i},getDocument:f,getWindow:g,getIframeWindow:function(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:m,getBody:r,isWindow:v,getContentDocument:function(e,t,n){var r;if(e?i.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):f(e):v(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,n,i,r){var o,s,a,h,u;if(e==i)return n===r?0:n<r?-1:1;if(o=c(i,e,!0))return n<=l(o)?-1:1;if(o=c(e,i,!0))return l(o)<r?-1:1;if(!(s=d(e,i)))throw new Error("comparePoints error: nodes have no common ancestor");if((a=e===s?s:c(e,s,!0))===(h=i===s?s:c(i,s,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(u=s.firstChild;u;){if(u===a)return-1;if(u===h)return 1;u=u.nextSibling}},isBrokenNode:N,inspectNode:C,getComputedStyleProperty:_,createTestElement:function(e,t,n){var i=r(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var s=i.firstChild;return s?i.insertBefore(o,s):i.appendChild(o),o},removeNode:function(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=f(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new T(e)},DomPosition:b},e.DOMException=E}),T.createCoreModule("DomRange",["DomUtil"],function(t,n){var i=t.dom,r=t.util,o=i.DomPosition,s=t.DOMException,a=i.isCharacterDataNode,l=i.getNodeIndex,d=i.isOrIsAncestorOf,h=i.getDocument,c=i.comparePoints,u=i.splitDataNode,p=i.getClosestAncestorIn,f=i.getNodeLength,g=i.arrayContains,m=i.getRootContainer,v=t.features.crashyTextNodes,_=i.removeNode;function y(e,t){return 3!=e.nodeType&&(d(e,t.startContainer)||d(e,t.endContainer))}function N(e){return e.document||h(e.startContainer)}function C(e){return new o(e.parentNode,l(e))}function T(e){return new o(e.parentNode,l(e)+1)}function b(e,t,n){var r=11==e.nodeType?e.firstChild:e;return a(t)?n==t.length?i.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:u(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function E(e,t,n){if(X(e),X(t),N(t)!=N(e))throw new s("WRONG_DOCUMENT_ERR");var i=c(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=c(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?i<=0&&r>=0:i<0&&r>0}function S(e,t,n){var r,o,s,a;for(n=n||{stop:!1};s=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(s))return void(n.stop=!0);if(S(a=e.getSubtreeIterator(),t,n),a.detach(),n.stop)return}else for(r=i.createIterator(s);o=r.next();)if(!1===t(o))return void(n.stop=!0)}function O(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(O(t=e.getSubtreeIterator()),t.detach()):e.remove()}function w(e){for(var t,n,i=N(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(w(n)),n.detach()):e.remove(),10==t.nodeType)throw new s("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function k(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+i.inspectNode(e.startContainer)+":"+e.startOffset+", "+i.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function x(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&a(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||a(this.sc)?p(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||a(this.ec)?p(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}x.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,a(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!a(n)||n!==this.sc&&n!==this.ec?n.parentNode&&_(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return y(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new fe(N(this.range));var t=this._current,n=t,i=0,r=t,o=f(t);d(t,this.sc)&&(n=this.sc,i=this.so),d(t,this.ec)&&(r=this.ec,o=this.eo),pe(e,n,i,r,o)}return new x(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var R=[1,3,4,5,7,8,10],D=[2,9,11],I=[1,3,4,5,7,8,10,11],A=[1,3,4,5,7,8];function L(e){return function(t,n){for(var i,r=n?t:t.parentNode;r;){if(i=r.nodeType,g(e,i))return r;r=r.parentNode}return null}}var M=L([9,11]),P=L([5,6,10,12]),B=L([6,10,12]);function U(e,t){if(B(e,t))throw new s("INVALID_NODE_TYPE_ERR")}function H(e,t){if(!g(t,e.nodeType))throw new s("INVALID_NODE_TYPE_ERR")}function j(e,t){if(t<0||t>(a(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function F(e,t){if(M(e,!0)!==M(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function V(e){if(P(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function W(e,t){if(!e)throw new s(t)}function q(e,t){return t<=(a(e)?e.length:e.childNodes.length)}function z(e){return!!e.startContainer&&!!e.endContainer&&!(v&&(i.isBrokenNode(e.startContainer)||i.isBrokenNode(e.endContainer)))&&m(e.startContainer)==m(e.endContainer)&&q(e.startContainer,e.startOffset)&&q(e.endContainer,e.endOffset)}function X(e){if(!z(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var $=document.createElement("style"),G=!1;try{$.innerHTML="<b>x</b>",G=3==$.firstChild.nodeType}catch(e){}t.features.htmlParsingConforms=G;var Y=G?function(e){var t=this.startContainer,n=h(t);if(!t)throw new s("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:a(t)&&(r=i.parentElement(t)),(r=null===r||"HTML"==r.nodeName&&i.isHtmlNamespace(h(r).documentElement)&&i.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1)).innerHTML=e,i.fragmentFromNodeChildren(r)}:function(e){var t=N(this).createElement("body");return t.innerHTML=e,i.fragmentFromNodeChildren(t)};function J(e,t){X(e);var n=e.startContainer,i=e.startOffset,r=e.endContainer,o=e.endOffset,s=n===r;a(r)&&o>0&&o<r.length&&u(r,o,t),a(n)&&i>0&&i<n.length&&(n=u(n,i,t),s?(o-=i,r=n):r==n.parentNode&&o>=l(n)&&o++,i=0),e.setStartAndEnd(n,i,r,o)}function K(e){X(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var Q=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Z=0,ee=1,te=2,ne=3,ie=0,re=1,oe=2,se=3,ae=function(e,t,n,i,r){if(!n||isNaN(Number(n)))return!1;var o=e.collapsed;switch(n=Number(n),t){case"char":return n>0?e.moveCharRight(i,n,r):e.moveCharLeft(i,-1*n,r);case"word":default:throw new Error("move by 'word' not implemented")}o&&e.collapse(i)};function le(e){e.START_TO_START=Z,e.START_TO_END=ee,e.END_TO_END=te,e.END_TO_START=ne,e.NODE_BEFORE=ie,e.NODE_AFTER=re,e.NODE_BEFORE_AND_AFTER=oe,e.NODE_INSIDE=se}function de(e){le(e),le(e.prototype)}function he(e,t){return function(){X(this);var n,i=this.startContainer,r=this.startOffset,o=this.commonAncestorContainer,s=new x(this,!0);i!==o&&(i=(n=T(p(i,o,!0))).node,r=n.offset),S(s,V),s.reset();var a=e(s);return s.detach(),t(this,i,r,i,r),a}}function ce(e,n){function i(e,t){return function(n){H(n,R),H(m(n),D);var i=(e?C:T)(n);(t?o:s)(this,i.node,i.offset)}}function o(e,t,i){var r=e.endContainer,o=e.endOffset;t===e.startContainer&&i===e.startOffset||(m(t)==m(r)&&1!=c(t,i,r,o)||(r=t,o=i),n(e,t,i,r,o))}function s(e,t,i){var r=e.startContainer,o=e.startOffset;t===e.endContainer&&i===e.endOffset||(m(t)==m(r)&&-1!=c(t,i,r,o)||(r=t,o=i),n(e,r,o,t,i))}var d=function(){};d.prototype=t.rangePrototype,e.prototype=new d,r.extend(e.prototype,{setStart:function(e,t){U(e,!0),j(e,t),o(this,e,t)},setEnd:function(e,t){U(e,!0),j(e,t),s(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],i=e[1],r=t,o=i;switch(e.length){case 3:o=e[2];break;case 4:r=e[2],o=e[3]}n(this,t,i,r,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){X(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){U(e,!0),n(this,e,0,e,f(e))},selectNode:function(e){U(e,!1),H(e,R);var t=C(e),i=T(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:he(w,n),deleteContents:he(O,n),canSurroundContents:function(){X(this),V(this.startContainer),V(this.endContainer);var e=new x(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},splitBoundaries:function(){J(this)},splitBoundariesPreservingPositions:function(e){J(this,e)},normalizeBoundaries:function(){X(this);var e,t=this.startContainer,i=this.startOffset,r=this.endContainer,o=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,o=e.length,e.appendData(t.data),_(t))},d=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var s=e.length;if(i=n.length,e.insertData(0,n.data),_(n),t==r)o+=i,r=t;else if(r==e.parentNode){var a=l(e);o==a?(r=e,o=s):o>a&&o--}}},h=!0;if(a(r))o==r.length?s(r):0==o&&(e=r.previousSibling)&&e.nodeType==r.nodeType&&(o=e.length,t==r&&(h=!1),e.appendData(r.data),_(r),r=e);else{if(o>0){var c=r.childNodes[o-1];c&&a(c)&&s(c)}h=!this.collapsed}if(h){if(a(t))0==i?d(t):i==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(r==e&&(r=t,o+=t.length),t.appendData(e.data),_(e));else if(i<t.childNodes.length){var u=t.childNodes[i];u&&a(u)&&d(u)}}else t=r,i=o;n(this,t,i,r,o)},collapseToPoint:function(e,t){U(e,!0),j(e,t),this.setStartAndEnd(e,t)}}),de(e)}function ue(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:i.getCommonAncestor(e.startContainer,e.endContainer)}function pe(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=i.getDocument(t),ue(e)}function fe(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,ue(this)}r.extend(t.rangePrototype,{moveStart:function(e,t,n){return ae(this,e,t,!0,n)},moveEnd:function(e,t,n){return ae(this,e,t,!1,n)},setRange:function(e,t,n){e?this.setStart(t,n):this.setEnd(t,n)},moveCharLeft:function(t,n,i){var r,o,s=this.collapsed;if(t?(r=this.startContainer,o=this.startOffset):(r=this.endContainer,o=this.endOffset),r.nodeType===Node.ELEMENT_NODE)if(r.hasChildNodes()&&o>0){var a=r.childNodes[o-1],l=e.domUtils.getLastSelectableChild(a,i);if(!(r=l||e.domUtils.getPreviousSelectableNode(a,i)))return!1;o=r.data.length-n}else o=-1*n;else o-=n;for(;o<0;){if(!(r=e.domUtils.getPreviousSelectableNode(r,i)))return!1;r.nodeType===Node.ELEMENT_NODE?o++:o+=r.data.length}return s&&this.collapse(t),this.setRange(t,r,o),!0},moveCharRight:function(t,n,i){var r,o,s=this.collapsed;if(t?(r=this.startContainer,o=this.startOffset):(r=this.endContainer,o=this.endOffset),r.nodeType===Node.ELEMENT_NODE){var a=e.domUtils.getNextSelectableNode(r.childNodes[Math.min(o,r.childNodes.length-1)],i);r=a||e.domUtils.getFirstSelectableChild(e.domUtils.getNextContainer(r,i),i),o=n}else o+=n;if(!r)return!1;var l=o-(r.nodeType===Node.TEXT_NODE?r.data.length:1);if(l>0){for(;l>0;){if(!(r=e.domUtils.getFirstSelectableChild(e.domUtils.getNextContainer(r,i),i)))return!1;if(r.nodeType!==Node.ELEMENT_NODE){if(r.data.length>=l)break;r.data.length>0&&(l-=r.data.length)}else i&&i.filter&&i.filter(r)&&--l}o=l}return s&&this.collapse(t),1===r.nodeType?this.setRange(t,r,0):this.setRange(t,r,o),!0},getHTMLContents:function(e){e||(e=this.cloneContents());var t=self.env.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},getHTMLContentsObj:function(){return this.cloneContents()},compareBoundaryPoints:function(e,t){var n,i,r,o;X(this),F(this.startContainer,t.startContainer);var s=e==ne||e==Z?"start":"end",a=e==ee||e==Z?"start":"end";return n=this[s+"Container"],i=this[s+"Offset"],r=t[a+"Container"],o=t[a+"Offset"],c(n,i,r,o)},insertNode:function(e){if(X(this),H(e,I),V(this.startContainer),d(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=b(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(X(this),this.collapsed)return N(this).createDocumentFragment();if(this.startContainer===this.endContainer&&a(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=N(this).createDocumentFragment()).appendChild(e),t;var n=new x(this,!0);return e=function e(t){for(var n,i,r,o=N(t.range).createDocumentFragment();i=t.next();){if(n=t.isPartiallySelectedSubtree(),i=i.cloneNode(!n),n&&(r=t.getSubtreeIterator(),i.appendChild(e(r)),r.detach()),10==i.nodeType)throw new s("HIERARCHY_REQUEST_ERR");o.appendChild(i)}return o}(n),n.detach(),e},canSurroundContents:function(){X(this),V(this.startContainer),V(this.endContainer);var e=new x(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},surroundContents:function(e){if(H(e,A),!this.canSurroundContents())throw new s("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);b(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){X(this);for(var e,t=new fe(N(this)),n=Q.length;n--;)t[e=Q[n]]=this[e];return t},toString:function(){X(this);var e=this.startContainer;if(e===this.endContainer&&a(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new x(this,!0);return S(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){X(this);var t=e.parentNode,n=l(e);if(!t)throw new s("NOT_FOUND_ERR");var i=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return i<0?r>0?oe:ie:r>0?re:se},comparePoint:function(e,t){return X(this),W(e,"HIERARCHY_REQUEST_ERR"),F(e,this.startContainer),c(e,t,this.startContainer,this.startOffset)<0?-1:c(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Y,toHtml:function(){return K(this)},intersectsNode:function(e,t){if(X(this),m(e)!=function(e){return m(e.startContainer)}(this))return!1;var n=e.parentNode,i=l(e);if(!n)return!0;var r=c(n,i,this.endContainer,this.endOffset),o=c(n,i+1,this.startContainer,this.startOffset);return t?r<=0&&o>=0:r<0&&o>0},isPointInRange:function(e,t){return X(this),W(e,"HIERARCHY_REQUEST_ERR"),F(e,this.startContainer),c(e,t,this.startContainer,this.startOffset)>=0&&c(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return E(this,e,!1)},intersectsOrTouchesRange:function(e){return E(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=c(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=c(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==c(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==c(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new s("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==se},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,f(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();return t.setEnd(i,i.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return X(this),function(e,t,n){var i,r=Boolean(t&&t.length),o=Boolean(n);r&&(i=new RegExp("^("+t.join("|")+")$"));var s=[];return S(new x(e,!1),function(t){if((!r||i.test(t.nodeType))&&(!o||n(t))){var l=e.startContainer;if(t!=l||!a(l)||e.startOffset!=l.length){var d=e.endContainer;t==d&&a(d)&&0===e.endOffset||s.push(t)}}}),s}(this,e,t)},getDocument:function(){return N(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var n=N(this),r=t.createRange(n);e=e||i.getBody(n),r.selectNodeContents(e);var o=this.intersection(r),s=0,a=0;return o&&(r.setEnd(o.startContainer,o.startOffset),a=(s=r.toString().length)+o.toString().length),{start:s,end:a,containerNode:e}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var i,r,o,s,a=[t],l=!1,d=!1;!d&&(i=a.pop());)if(3==i.nodeType)r=n+i.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(i,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(i,e.end-n),d=!0),n=r;else for(o=(s=i.childNodes).length;o--;)a.push(s[o])},getName:function(){return"DomRange"},equals:function(e){return fe.rangesEqual(this,e)},isValid:function(){return z(this)},inspect:function(){return k(this)},detach:function(){}}),ce(fe,pe),r.extend(fe,{rangeProperties:Q,RangeIterator:x,copyComparisonConstants:de,createPrototypeRange:ce,inspect:k,toHtml:K,getRangeDocument:N,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),t.DomRange=fe}),T.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,i,r=e.dom,o=e.util,s=r.DomPosition,a=e.DomRange,l=r.getBody,d=r.getContentDocument,h=r.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var i,s,h=a.rangeProperties;function c(e){for(var t,n=h.length;n--;)e[t=h[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,c(this)},a.createPrototypeRange(n,function(e,t,n,i,r){var o=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==i||e.endOffset!=r,a=!e.equals(e.nativeRange);(o||s||a)&&(e.setEnd(i,r),e.setStart(t,n))}),(i=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),c(this)},i.cloneContents=function(){return this.nativeRange.cloneContents()},i.surroundContents=function(e){this.nativeRange.surroundContents(e),c(this)},i.collapse=function(e){this.nativeRange.collapse(e),c(this)},i.cloneRange=function(){return new n(this.nativeRange.cloneRange())},i.refresh=function(){c(this)},i.toString=function(){return this.nativeRange.toString()};var u=document.createTextNode("test");l(document).appendChild(u);var p=document.createRange();p.setStart(u,0),p.setEnd(u,0);try{p.setStart(u,1),i.setStart=function(e,t){this.nativeRange.setStart(e,t),c(this)},i.setEnd=function(e,t){this.nativeRange.setEnd(e,t),c(this)},s=function(e){return function(t){this.nativeRange[e](t),c(this)}}}catch(e){i.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}c(this)},i.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}c(this)},s=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}c(this)}}}i.setStartBefore=s("setStartBefore","setEndBefore"),i.setStartAfter=s("setStartAfter","setEndAfter"),i.setEndBefore=s("setEndBefore","setStartBefore"),i.setEndAfter=s("setEndAfter","setStartAfter"),i.selectNodeContents=function(e){this.setStartAndEnd(e,0,r.getNodeLength(e))},p.selectNodeContents(u),p.setEnd(u,3);var f=document.createRange();f.selectNodeContents(u),f.setEnd(u,4),f.setStart(u,2),-1==p.compareBoundaryPoints(p.START_TO_END,f)&&1==p.compareBoundaryPoints(p.END_TO_START,f)?i.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:i.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var g=document.createElement("div");g.innerHTML="123";var m=g.firstChild,v=l(document);v.appendChild(g),p.setStart(m,1),p.setEnd(m,2),p.deleteContents(),"13"==m.data&&(i.deleteContents=function(){this.nativeRange.deleteContents(),c(this)},i.extractContents=function(){var e=this.nativeRange.extractContents();return c(this),e}),v.removeChild(g),v=null,o.isHostMethod(p,"createContextualFragment")&&(i.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(u),i.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return(e=d(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var c=function(e,t,n,i,o){var a=e.duplicate();a.collapse(n);var l=a.parentElement();if(r.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var d=new s(l.parentNode,r.getNodeIndex(l));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var c=r.getDocument(l).createElement("span");c.parentNode&&r.removeNode(c);for(var u,p,f,g,m,v=n?"StartToStart":"StartToEnd",_=o&&o.containerElement==l?o.nodeIndex:0,y=l.childNodes.length,N=y,C=N;C==y?l.appendChild(c):l.insertBefore(c,l.childNodes[C]),a.moveToElementText(c),0!=(u=a.compareEndPoints(v,e))&&_!=N;){if(-1==u){if(N==_+1)break;_=C}else N=N==_+1?_:C;C=Math.floor((_+N)/2),l.removeChild(c)}if(m=c.nextSibling,-1==u&&m&&h(m)){var T;if(a.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(m.data)){var b=a.duplicate(),E=b.text.replace(/\r\n/g,"\r").length;for(T=b.moveStart("character",E);-1==(u=b.compareEndPoints("StartToEnd",b));)T++,b.moveStart("character",1)}else T=a.text.length;g=new s(m,T)}else p=(i||!n)&&c.previousSibling,g=(f=(i||n)&&c.nextSibling)&&h(f)?new s(f,0):p&&h(p)?new s(p,p.data.length):new s(l,r.getNodeIndex(c));return r.removeNode(c),{boundaryPosition:g,nodeInfo:{nodeIndex:C,containerElement:l}}},u=function(e,t){var n,i,o,s,a=e.offset,d=r.getDocument(e.node),c=l(d).createTextRange(),u=h(e.node);return u?i=(n=e.node).parentNode:(n=a<(s=e.node.childNodes).length?s[a]:null,i=e.node),(o=d.createElement("span")).innerHTML="&#feff;",n?i.insertBefore(o,n):i.appendChild(o),c.moveToElementText(o),c.collapse(!t),i.removeChild(o),u&&c[t?"moveStart":"moveEnd"]("character",a),c};(i=function(e){this.textRange=e,this.refresh()}).prototype=new a(document),i.prototype.refresh=function(){var e,t,n,i=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();(n=e.duplicate()).collapse(!1);var o=n.parentElement(),s=i==o?i:r.getCommonAncestor(i,o);return s==t?s:r.getCommonAncestor(t,s)}(this.textRange);!function(e){return 0==e.compareEndPoints("StartToEnd",e)}(this.textRange)?(e=(n=c(this.textRange,i,!0,!1)).boundaryPosition,t=c(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition):t=e=c(this.textRange,i,!0,!0).boundaryPosition,this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},a.copyComparisonConstants(i);var p=function(e){if(e.collapsed)return u(new s(e.startContainer,e.startOffset),!0);var t=u(new s(e.startContainer,e.startOffset),!0),n=u(new s(e.endContainer,e.endOffset),!1),i=l(a.getRangeDocument(e)).createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i};if(i.rangeToTextRange=p,i.prototype.toTextRange=function(){return p(this)},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var f=Function("return this;")();void 0===f.Range&&(f.Range=i),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new a(e)},o.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),o.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),T.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){e.config.checkSelectionRanges=!0;var n,i,r=e.dom,o=e.util,s=o.isHostMethod,a=e.DomRange,l=e.WrappedRange,d=e.DOMException,h=r.DomPosition,c=e.features,u=r.getDocument,p=r.getBody,f=a.rangesEqual;function g(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function m(e,n){if(e){if(r.isWindow(e))return e;if(e instanceof V)return e.win;var i=r.getContentDocument(e,t,n);return r.getWindow(i)}return window}function v(e){return m(e,"getDocSelection").document.selection}function _(e){var t=!1;return e.anchorNode&&(t=1==r.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var y=s(window,"getSelection"),N=o.isHostObject(document,"selection");c.implementsWinGetSelection=y,c.implementsDocSelection=N;var C=N&&(!y||e.config.preferTextRange);if(C)n=v,e.isSelectionValid=function(e){var t=m(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||u(n.createRange().parentElement())==t};else{if(!y)return t.fail("Neither document.selection or window.getSelection() detected."),!1;n=function(e){return m(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}}e.getNativeSelection=n;var T=n();if(!T)return t.fail("Native selection was null (possibly issue 138?)"),!1;var b=e.createNativeRange(document),E=p(document),S=o.areHostProperties(T,["anchorNode","focusNode","anchorOffset","focusOffset"]);c.selectionHasAnchorAndFocus=S;var O=s(T,"extend");c.selectionHasExtend=O;var w="number"==typeof T.rangeCount;c.selectionHasRangeCount=w;var k=!1,x=!0,R=O?function(t,n){var i=a.getRangeDocument(n),r=e.createRange(i);r.collapseToPoint(n.endContainer,n.endOffset),t.addRange(P(r)),t.extend(n.startContainer,n.startOffset)}:null;o.areHostMethods(T,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof T.rangeCount&&c.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,i=n>1,o=[],s=_(t),a=0;a<n;++a)o[a]=t.getRangeAt(a);var l=r.createTestElement(document,"",!1),d=l.appendChild(document.createTextNode("   ")),h=document.createRange();if(h.setStart(d,1),h.collapse(!0),t.removeAllRanges(),t.addRange(h),x=1==t.rangeCount,t.removeAllRanges(),!i){var c=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(c&&parseInt(c[1])>=36)k=!1;else{var u=h.cloneRange();h.setStart(d,0),u.setEnd(d,3),u.setStart(d,2),t.addRange(h),t.addRange(u),k=2==t.rangeCount}}for(r.removeNode(l),t.removeAllRanges(),a=0;a<n;++a)0==a&&s?R?R(t,o[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[a])):t.addRange(o[a])}}(),c.selectionSupportsMultipleRanges=k,c.collapsedNonEditableSelectionsSupported=x;var D,I,A=!1;function L(e,t,n){var i=n?"end":"start",r=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function M(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function P(t){var n;return t instanceof a?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof l?n=t.nativeRange:c.implementsDomRange&&t instanceof r.getWindow(t.startContainer).Range&&(n=t),n}function B(e){var n=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!r.isAncestorOf(e[0],e[t]))return!1;return!0}(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function U(e){return!!e&&void 0!==e.text}function H(e,t){var n=new l(t);e._ranges=[n],L(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function j(t){if(t._ranges.length=0,"None"==t.docSelection.type)M(t);else{var n=t.docSelection.createRange();if(U(n))H(t,n);else{t.rangeCount=n.length;for(var i,r=u(n.item(0)),o=0;o<t.rangeCount;++o)(i=e.createRange(r)).selectNode(n.item(o)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,L(t,t._ranges[t.rangeCount-1],!1)}}}function F(e,n){for(var i=e.docSelection.createRange(),r=B(n),o=u(i.item(0)),s=p(o).createControlRange(),a=0,l=i.length;a<l;++a)s.add(i.item(a));try{s.add(r)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),j(e)}function V(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function W(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}E&&s(E,"createControlRange")&&(D=E.createControlRange(),o.areHostProperties(D,["item","add"])&&(A=!0)),c.implementsControlRange=A,i=S?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},s(T,"getRangeAt")?I=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:S&&(I=function(t){var n=u(t.anchorNode),i=e.createRange(n);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),V.prototype=e.selectionPrototype;var q=[];function z(e,t){for(var n,i,r=q.length;r--;)if(i=(n=q[r]).selection,"deleteAll"==t)W(i);else if(n.win==e)return"delete"==t?(q.splice(r,1),!0):i;return"deleteAll"==t&&(q.length=0),null}var X=function(e){if(e&&e instanceof V)return e.refresh(),e;var t=z(e=m(e,"getNativeSelection")),i=n(e),r=N?v(e):null;return t?(t.nativeSelection=i,t.docSelection=r,t.refresh()):(t=new V(i,r,e),q.push({win:e,selection:t})),t};e.getSelection=X,o.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var $,G=V.prototype;function Y(e,n){for(var i,r=u(n[0].startContainer),o=p(r).createControlRange(),s=0,a=n.length;s<a;++s){i=B(n[s]);try{o.add(i)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),j(e)}if(!C&&S&&o.areHostMethods(T,["removeAllRanges","addRange"])){G.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),M(this)};var J=function(e,t){R(e.nativeSelection,t),e.refresh()};G.addRange=w?function(t,n){if(A&&N&&"Control"==this.docSelection.type)F(this,t);else if(g(n)&&O)J(this,t);else{var r;k?r=this.rangeCount:(this.removeAllRanges(),r=0);var o=P(t).cloneRange();try{this.nativeSelection.addRange(o)}catch(e){console.error(e,t)}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var s=I(this.nativeSelection,this.rangeCount-1);s&&!f(s,t)&&(t=new l(s))}this._ranges[this.rangeCount-1]=t,L(this,t,K(this.nativeSelection)),this.isCollapsed=i(this)}else this.refresh()}}:function(e,t){g(t)&&O?J(this,e):(this.nativeSelection.addRange(P(e)),this.refresh())},G.setRanges=function(e){if(A&&N&&e.length>1)Y(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(s(T,"empty")&&s(b,"select")&&A&&C))return t.fail("No means of selecting a Range or TextRange was found"),!1;G.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=u(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=u(t.item(0)))}e&&(p(e).createTextRange().select(),this.docSelection.empty())}}catch(e){}M(this)},G.addRange=function(t){"Control"==this.docSelection.type?F(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,t,!1))},G.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?Y(this,e):t&&this.addRange(e[0])}}if(G.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new d("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},C)$=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=p(t.win.document).createTextRange()).collapse(!0),"Control"==t.docSelection.type?j(t):U(n)?H(t,n):M(t)};else if(s(T,"getRangeAt")&&"number"==typeof T.rangeCount)$=function(t){if(A&&N&&"Control"==t.docSelection.type)j(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));L(t,t._ranges[t.rangeCount-1],K(t.nativeSelection)),t.isCollapsed=i(t)}else M(t)};else{if(!S||"boolean"!=typeof T.isCollapsed||"boolean"!=typeof b.collapsed||!c.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;$=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=I(n,0),e._ranges=[t],e.rangeCount=1,function(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}(e),e.isCollapsed=i(e)):M(e)}}G.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if($(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;r--;)if(!f(t[r],this._ranges[r]))return!0;return!1}};var K,Q=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,r=n.length;i<r;++i)f(t,n[i])||e.addRange(n[i]);e.rangeCount||M(e)};function Z(e,t){if(e.win.document!=u(t))throw new d("WRONG_DOCUMENT_ERR")}function ee(t){return function(n,i){var r;this.rangeCount?(r=this.getRangeAt(0))["set"+(t?"Start":"End")](n,i):(r=e.createRange(this.win.document)).setStartAndEnd(n,i),this.setSingleRange(r,this.isBackward())}}function te(e){var t=[],n=new h(e.anchorNode,e.anchorOffset),i=new h(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var o=0,s=e.rangeCount;o<s;++o)t[o]=a.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}G.removeRange=A&&N?function(e){if("Control"==this.docSelection.type){for(var t=this.docSelection.createRange(),n=B(e),i=u(t.item(0)),r=p(i).createControlRange(),o=!1,s=0,a=t.length;s<a;++s)t.item(s)!==n||o?r.add(t.item(s)):o=!0;r.select(),j(this)}else Q(this,e)}:function(e){Q(this,e)},!C&&S&&c.implementsDomRange?(K=_,G.isBackward=function(){return K(this)}):K=G.isBackward=function(){return!1},G.isBackwards=G.isBackward,G.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},G.collapse=function(t,n){Z(this,t);var i=e.createRange(t);i.collapseToPoint(t,n),this.setSingleRange(i),this.isCollapsed=!0},G.collapseToStart=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},G.collapseToEnd=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},G.selectAllChildren=function(t){Z(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},G.deleteFromDocument=function(){if(A&&N&&"Control"==this.docSelection.type){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),r.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,o=n.length;i<o;++i)n[i].deleteContents();this.addRange(n[o-1])}}},G.eachRange=function(e,t){for(var n=0,i=this._ranges.length;n<i;++n)if(e(this.getRangeAt(n)))return t},G.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},G.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},G.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(i){n.push(i[e].apply(i,t||[]))}),n},G.setStart=ee(!0),G.setEnd=ee(!1),e.rangePrototype.select=function(e){X(this.getDocument()).setSingleRange(this,e)},G.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},G.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},G.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},G.moveToBookmark=function(t){for(var n,i,r=[],o=0;n=t.rangeBookmarks[o++];)(i=e.createRange(this.win)).moveToBookmark(n),r.push(i);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},G.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},G.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},G.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(a.toHtml(t))}),e.join("")},c.implementsTextRange&&(G.getNativeTextRange=function(){var n;if(n=this.docSelection){var i=n.createRange();if(U(i))return i;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),G.getName=function(){return"WrappedSelection"},G.inspect=function(){return te(this)},G.detach=function(){z(this.win,"delete"),W(this)},V.detachAll=function(){z(null,"deleteAll")},V.inspect=te,V.isDirectionBackward=g,e.Selection=V,e.selectionPrototype=G,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return X(e)}),e=null})});var M=!1,P=function(e){M||(M=!0,!T.initialized&&T.config.autoInitialize&&k())};return N&&("complete"==document.readyState?P():(l(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",P,!1),_(window,"load",P))),T.isInitialized=function(){var t;for(var n in this.modules)if(!(t=this.modules[n])||!t.initialized||!t.supported)return e.Logger.debug("rangy module",n,"initialized",t.initialized,"supported",t.supported),!1;return!0},T},(window||this).FLITE)}();var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t;e||console.error("mutation-summary: global is not defined"),function(e){e[e.STAYED_OUT=0]="STAYED_OUT",e[e.ENTERED=1]="ENTERED",e[e.STAYED_IN=2]="STAYED_IN",e[e.REPARENTED=3]="REPARENTED",e[e.REORDERED=4]="REORDERED",e[e.EXITED=5]="EXITED"}(t||(t={}));var i=void 0!==window.WebKitMutationObserver?window.WebKitMutationObserver:window.MutationObserver;if(!i)throw console.error("DOM Mutation Observers are required."),console.error("https://developer.mozilla.org/en-US/docs/DOM/MutationObserver"),new Error("DOM Mutation Observers are required");var r=["added","removed","reordered","reparented","valueChanged","characterDataChanged"],o=function(){function e(){this.nodes=[],this.values=[]}return e.prototype.isIndex=function(e){return+e==e>>>0},e.prototype.nodeId=function(t){var n=t[e.ID_PROP];return n||(n=t[e.ID_PROP]=e.nextId_++),n},e.prototype.set=function(e,t){var n=this.nodeId(e);this.nodes[n]=e,this.values[n]=t},e.prototype.get=function(e){var t=this.nodeId(e);return this.values[t]},e.prototype.has=function(e){return this.nodeId(e)in this.nodes},e.prototype.delete=function(e){var t=this.nodeId(e);delete this.nodes[t],this.values[t]=void 0},e.prototype.keys=function(){var e=[];for(var t in this.nodes)this.isIndex(t)&&e.push(this.nodes[t]);return e},e.ID_PROP="__mutation_summary_node_map_id__",e.nextId_=1,e}();var s=function(){function e(e,t,n,i,r,o,s,a){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===r&&(r=null),void 0===o&&(o=!1),void 0===s&&(s=null),void 0===a&&(a=null),this.node=e,this.childList=t,this.attributes=n,this.characterData=i,this.oldParentNode=r,this.added=o,this.attributeOldValues=s,this.characterDataOldValue=a,this.isCaseInsensitive=this.node.nodeType===Node.ELEMENT_NODE&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}return e.prototype.getAttributeOldValue=function(e){if(this.attributeOldValues)return this.isCaseInsensitive&&(e=e.toLowerCase()),this.attributeOldValues[e]},e.prototype.getAttributeNamesMutated=function(){var e=[];if(!this.attributeOldValues)return e;for(var t in this.attributeOldValues)e.push(t);return e},e.prototype.attributeMutated=function(e,t){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},e in this.attributeOldValues||(this.attributeOldValues[e]=t)},e.prototype.characterDataMutated=function(e){this.characterData||(this.characterData=!0,this.characterDataOldValue=e)},e.prototype.removedFromParent=function(e){this.childList=!0,this.added||this.oldParentNode?(this.added=!1,this.oldParentNode=this.oldParentNode||e):this.oldParentNode=e},e.prototype.insertedIntoParent=function(){this.childList=!0,this.added=!0},e.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode},e}(),a=function(){return function(){this.added=new o,this.removed=new o,this.maybeMoved=new o,this.oldPrevious=new o,this.moved=void 0}}(),l=function(e){function i(t,n,i){var r,o,s=e.call(this)||this;i=i||function(e){return!0},s.rootNode=t,s.reachableCache=void 0,s.wasReachableCache=void 0,s.anyParentsChanged=!1,s.anyAttributesChanged=!1,s.anyCharacterDataChanged=!1;for(var a=0;a<n.length;a++)switch((o=n[a]).type){case"childList":s.anyParentsChanged=!0;for(var l=0;l<o.removedNodes.length;l++)i(r=o.removedNodes[l])&&s.getChange(r).removedFromParent(o.target);for(l=0;l<o.addedNodes.length;l++)i(r=o.addedNodes[l])&&s.getChange(r).insertedIntoParent();break;case"attributes":s.anyAttributesChanged=!0,i(o.target)&&s.getChange(o.target).attributeMutated(o.attributeName,o.oldValue);break;case"characterData":s.anyCharacterDataChanged=!0,i(o.target)&&s.getChange(o.target).characterDataMutated(o.oldValue)}return s}return n(i,e),i.prototype.getChange=function(e){var t=this.get(e);return t||(t=new s(e),this.set(e,t)),t},i.prototype.getOldParent=function(e){var t=this.get(e);return t?t.getOldParent():e.parentNode},i.prototype.getIsReachable=function(e){if(e===this.rootNode)return!0;if(!e)return!1;this.reachableCache=this.reachableCache||new o;var t=this.reachableCache.get(e);return void 0===t&&(t=this.getIsReachable(e.parentNode),this.reachableCache.set(e,t)),t},i.prototype.getWasReachable=function(e){if(e===this.rootNode)return!0;if(!e)return!1;this.wasReachableCache=this.wasReachableCache||new o;var t=this.wasReachableCache.get(e);return void 0===t&&(t=this.getWasReachable(this.getOldParent(e)),this.wasReachableCache.set(e,t)),t},i.prototype.reachabilityChange=function(e){return this.getIsReachable(e)?this.getWasReachable(e)?t.STAYED_IN:t.ENTERED:this.getWasReachable(e)?t.EXITED:t.STAYED_OUT},i}(o),d=function(){function e(e,t,n,i,r,s){this.rootNode=e,this.mutations=t,this.selectors=n,this.calcReordered=i,this.calcOldPreviousSibling=r,this.nodeFilter=s,this.nodeFilter=this.nodeFilter||function(e){return!0},this.treeChanges=new l(e,t,this.nodeFilter),this.entered=[],this.exited=[],this.stayedIn=new o,this.visited=new o,this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}return e.prototype.processMutations=function(){if(this.treeChanges.anyParentsChanged||this.treeChanges.anyAttributesChanged)for(var e=this.treeChanges.keys(),t=0;t<e.length;t++)this.visitNode(e[t],void 0)},e.prototype.visitNode=function(e,n){if(!this.visited.has(e)&&this.nodeFilter(e)){this.visited.set(e,!0);var i=this.treeChanges.get(e),r=n;if((i&&i.childList||void 0==r)&&(r=this.treeChanges.reachabilityChange(e)),r!==t.STAYED_OUT){if(this.matchabilityChange(e),r===t.ENTERED)this.entered.push(e);else if(r===t.EXITED)this.exited.push(e),this.ensureHasOldPreviousSiblingIfNeeded(e);else if(r===t.STAYED_IN){var o=t.STAYED_IN;i&&i.childList&&(i.oldParentNode!==e.parentNode?(o=t.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(e)):this.calcReordered&&this.wasReordered(e)&&(o=t.REORDERED)),this.stayedIn.set(e,o)}if(r!==t.STAYED_IN)for(var s=e.firstChild;s;s=s.nextSibling)this.visitNode(s,r)}}},e.prototype.ensureHasOldPreviousSiblingIfNeeded=function(e){if(this.calcOldPreviousSibling){this.processChildlistChanges();var t=e.parentNode,n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);var i=this.childListChangeMap.get(t);i||(i=new a,this.childListChangeMap.set(t,i)),i.oldPrevious.has(e)||i.oldPrevious.set(e,e.previousSibling)}},e.prototype.getChanged=function(e,n,i){var r,o;this.selectors=n,this.characterDataOnly=i;for(var s=0;s<this.entered.length;s++)r=this.entered[s],(o=this.matchabilityChange(r))!==t.ENTERED&&o!==t.STAYED_IN||e.added.push(r);var a,l=this.stayedIn.keys();for(s=0;s<l.length;s++)if(a=(r=l[s]).nodeType===Node.TEXT_NODE&&this.stayedIn.get(r)===t.REPARENTED,(o=this.matchabilityChange(r,a?t.STAYED_IN:null))===t.ENTERED)e.added.push(r);else if(o===t.EXITED)e.removed.push(r);else if(o===t.STAYED_IN&&(e.reparented||e.reordered)){var d=this.stayedIn.get(r);e.reparented&&d===t.REPARENTED?e.reparented.push(r):e.reordered&&d===t.REORDERED&&e.reordered.push(r)}for(s=0;s<this.exited.length;s++)r=this.exited[s],(o=this.matchabilityChange(r))!==t.EXITED&&o!==t.STAYED_IN||e.removed.push(r)},e.prototype.getOldParentNode=function(e){var n=this.treeChanges.get(e);if(n&&n.childList)return n.oldParentNode?n.oldParentNode:null;var i=this.treeChanges.reachabilityChange(e);if(i===t.STAYED_OUT||i===t.ENTERED)throw Error("getOldParentNode requested on invalid node.");return e.parentNode},e.prototype.getOldPreviousSibling=function(e){var t=e.parentNode,n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);var i=this.childListChangeMap.get(t);if(!i)throw Error("getOldPreviousSibling requested on invalid node.");return i.oldPrevious.get(e)},e.prototype.getOldAttribute=function(e,t){var n=this.treeChanges.get(e);if(!n||!n.attributes)throw Error("getOldAttribute requested on invalid node.");var i=n.getAttributeOldValue(t);if(void 0===i)throw Error("getOldAttribute requested for unchanged attribute name.");return i},e.prototype.attributeChangedNodes=function(e){if(!this.treeChanges.anyAttributesChanged)return{};var n,i;if(e){n={},i={};for(var r=0;r<e.length;r++){var o=e[r];n[o]=!0,i[o.toLowerCase()]=o}}var s,a,l={},d=this.treeChanges.keys();for(r=0;r<d.length;r++){s=d[r];var h=this.treeChanges.get(s);if(h.attributes&&(t.STAYED_IN===this.treeChanges.reachabilityChange(s)&&t.STAYED_IN===this.matchabilityChange(s))){a=s;for(var c=h.getAttributeNamesMutated(),u=void 0,p=0;p<c.length;p++)u=c[p],(!n||n[u]||h.isCaseInsensitive&&i[u])&&h.getAttributeOldValue(u)!==a.getAttribute(u)&&(i&&h.isCaseInsensitive&&(u=i[u]),l[u]=l[u]||[],l[u].push(a))}}return l},e.prototype.getOldCharacterData=function(e){var t=this.treeChanges.get(e);if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue},e.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];for(var e,n,i=this.treeChanges.keys(),r=[],o=0;o<i.length;o++)e=i[o],t.STAYED_IN===this.treeChanges.reachabilityChange(e)&&(n=this.treeChanges.get(e)).characterData&&e.textContent!=n.characterDataOldValue&&r.push(e);return r},e.prototype.computeMatchabilityChange=function(e,t){this.matchCache||(this.matchCache=[]),this.matchCache[e.uid]||(this.matchCache[e.uid]=new o);var n=this.matchCache[e.uid],i=n.get(t);return void 0===i&&(i=e.matchabilityChange(t,this.treeChanges.get(t)),n.set(t,i)),i},e.prototype.matchabilityChange=function(e,n){var i=this;if(this.characterDataOnly)switch(e.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return t.STAYED_IN;default:return t.STAYED_OUT}if(!this.selectors)return t.STAYED_IN;if(e.nodeType!==Node.ELEMENT_NODE)return null===n||void 0===n?e.parentNode?t.STAYED_IN:t.STAYED_OUT:n;for(var r=e,o=this.selectors.map(function(e){return i.computeMatchabilityChange(e,r)}),s=t.STAYED_OUT,a=0;s!==t.STAYED_IN&&a<o.length;){switch(o[a]){case t.STAYED_IN:s=t.STAYED_IN;break;case t.ENTERED:s=s===t.EXITED?t.STAYED_IN:t.ENTERED;break;case t.EXITED:s=s===t.ENTERED?t.STAYED_IN:t.EXITED}a++}return s},e.prototype.getChildlistChange=function(e){var t=this.childListChangeMap.get(e);return t||(t=new a,this.childListChangeMap.set(e,t)),t},e.prototype.processChildlistChanges=function(){if(!this.childListChangeMap){var e,n,i,r;this.childListChangeMap=new o;for(var s=function(e,t,n){!e||n.added.has(e)||n.maybeMoved.has(e)||t&&!n.oldPrevious.get(e)&&(t&&(n.added.has(t)||n.maybeMoved.has(t))||n.oldPrevious.set(e,t))},a=0;a<this.mutations.length;a++)if("childList"==(e=this.mutations[a]).type&&(this.treeChanges.reachabilityChange(e.target)===t.STAYED_IN||this.calcOldPreviousSibling)){i=this.getChildlistChange(e.target),r=e.previousSibling;for(var l=0;l<e.removedNodes.length;l++)s(n=e.removedNodes[l],r,i),i.added.has(n)?i.added.delete(n):(i.removed.set(n,!0),i.maybeMoved.delete(n)),r=n;s(e.nextSibling,r,i);for(l=0;l<e.addedNodes.length;l++)n=e.addedNodes[l],i.removed.has(n)?(i.removed.delete(n),i.maybeMoved.set(n,!0)):i.added.set(n,!0)}}},e.prototype.wasReordered=function(e){if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();var t=e.parentNode,n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);var i=this.childListChangeMap.get(t);if(!i)return!1;if(i.moved)return i.moved.get(e);i.moved=new o;var r=new o;function s(e){if(!e)return!1;if(!i.maybeMoved.has(e))return!1;var t=i.moved.get(e);return void 0!==t?t:(r.has(e)?t=!0:(r.set(e,!0),t=function(e){if(l.has(e))return l.get(e);var t=e.previousSibling;for(;t&&(i.added.has(t)||s(t));)t=t.previousSibling;return l.set(e,t),t}(e)!==function e(t){var n=a.get(t);if(void 0!==n)return n;n=i.oldPrevious.get(t);for(;n&&(i.removed.has(n)||s(n));)n=e(n);void 0===n&&(n=t.previousSibling);a.set(t,n);return n}(e)),r.has(e)?(r.delete(e),i.moved.set(e,t)):t=i.moved.get(e),t)}var a=new o;var l=new o;return i.maybeMoved.keys().forEach(s),i.moved.get(e)},e}(),h=function(){function e(e,t){var n=this;if(this.projection=e,this.added=[],this.removed=[],this.reparented=t.all||t.element||t.characterData?[]:void 0,this.reordered=t.all?[]:void 0,this.projection=e,e.getChanged(this,t.elementFilter,t.characterData),t.all||t.attribute||t.attributeList){var i=t.attribute?[t.attribute]:t.attributeList,r=e.attributeChangedNodes(i);t.attribute?this.valueChanged=r[t.attribute]||[]:(this.attributeChanged=r,t.attributeList&&t.attributeList.forEach(function(e){n.attributeChanged.hasOwnProperty(e)||(n.attributeChanged[e]=[])}))}if(t.all||t.characterData){var o=e.getCharacterDataChanged();t.characterData?this.valueChanged=o:this.characterDataChanged=o}this.reordered&&(this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e))}return e.prototype.getOldParentNode=function(e){return this.projection.getOldParentNode(e)},e.prototype.getOldAttribute=function(e,t){return this.projection.getOldAttribute(e,t)},e.prototype.getOldPreviousSibling=function(e){return this.projection.getOldPreviousSibling(e)},e.prototype.getOldCharacterData=function(e){return this.projection.getOldCharacterData(e)},e.prototype.getCharacterDataChanged=function(){return this.projection.getCharacterDataChanged()},e}(),c=/[a-zA-Z_]+/,u=/[a-zA-Z0-9_\-]+/;function p(e){return'"'+e.replace(/"/,'\\"')+'"'}var f=function(){function e(){}return e.prototype.matches=function(e){if(null===e)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==e;for(var t=e.split(" "),n=0;n<t.length;n++)if(this.attrValue===t[n])return!0;return!1},e.prototype.toString=function(){var e="["+this.attrName+"]";return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+p(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+p(this.attrValue)+"]":e:"#"+this.attrValue},e}(),g=function(){function e(){this.uid=e.nextUid++,this.qualifiers=[]}return Object.defineProperty(e.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:!0,configurable:!0}),e.prototype.isMatching=function(t){return t[e.matchesSelector](this.selectorString)},e.prototype.wasMatching=function(e,t,n){if(!t||!t.attributes)return n;var i=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==i&&i!==e.tagName)return!1;for(var r,o=[],s=!1,a=0;a<this.qualifiers.length;a++){r=this.qualifiers[a];var l=t.getAttributeOldValue(r.attrName);o.push(l),s=s||void 0!==l}if(!s)return n;for(a=0;a<this.qualifiers.length;a++){if(r=this.qualifiers[a],void 0===(l=o[a])&&(l=e.getAttribute(r.attrName)),!r.matches(l))return!1}return!0},e.prototype.matchabilityChange=function(e,n){return this.isMatching(e)?this.wasMatching(e,n,!0)?t.STAYED_IN:t.ENTERED:this.wasMatching(e,n,!1)?t.EXITED:t.STAYED_OUT},e.parseSelectors=function(t){var n,i,r=[];function o(){n&&(i&&(n.qualifiers.push(i),i=void 0),r.push(n)),n=new e}function s(){i&&n.qualifiers.push(i),i=new f}for(var a,l,d=/\s/,h="Invalid or unsupported selector syntax.",p=1,g=0;g<t.length;)switch(l=t[g++],p){case 1:if(l.match(c)){o(),n.tagName=l,p=2;break}if("*"===l){o(),n.tagName="*",p=3;break}if("."===l){o(),s(),n.tagName="*",i.attrName="class",i.contains=!0,p=4;break}if("#"===l){o(),s(),n.tagName="*",i.attrName="id",p=4;break}if("["===l){o(),s(),n.tagName="*",i.attrName="",p=6;break}if(l.match(d))break;throw Error(h);case 2:if(l.match(u)){n.tagName+=l;break}if("."===l){s(),i.attrName="class",i.contains=!0,p=4;break}if("#"===l){s(),i.attrName="id",p=4;break}if("["===l){s(),i.attrName="",p=6;break}if(l.match(d)){p=14;break}if(","===l){p=1;break}throw Error(h);case 3:if("."===l){s(),i.attrName="class",i.contains=!0,p=4;break}if("#"===l){s(),i.attrName="id",p=4;break}if("["===l){s(),i.attrName="",p=6;break}if(l.match(d)){p=14;break}if(","===l){p=1;break}throw Error(h);case 4:if(l.match(c)){i.attrValue=l,p=5;break}throw Error(h);case 5:if(l.match(u)){i.attrValue+=l;break}if("."===l){s(),i.attrName="class",i.contains=!0,p=4;break}if("#"===l){s(),i.attrName="id",p=4;break}if("["===l){s(),p=6;break}if(l.match(d)){p=14;break}if(","===l){p=1;break}throw Error(h);case 6:if(l.match(c)){i.attrName=l,p=7;break}if(l.match(d))break;throw Error(h);case 7:if(l.match(u)){i.attrName+=l;break}if(l.match(d)){p=8;break}if("~"===l){i.contains=!0,p=9;break}if("="===l){i.attrValue="",p=11;break}if("]"===l){p=3;break}throw Error(h);case 8:if("~"===l){i.contains=!0,p=9;break}if("="===l){i.attrValue="",p=11;break}if("]"===l){p=3;break}if(l.match(d))break;throw Error(h);case 9:if("="===l){i.attrValue="",p=11;break}throw Error(h);case 10:if("]"===l){p=3;break}if(l.match(d))break;throw Error(h);case 11:if(l.match(d))break;if('"'===l||"'"===l){a=l,p=13;break}i.attrValue+=l,p=12;break;case 12:if(l.match(d)){p=10;break}if("]"===l){p=3;break}if("'"===l||'"'==l)throw Error(h);i.attrValue+=l;break;case 13:if(l===a){p=10;break}i.attrValue+=l;break;case 14:if(l.match(d))break;if(","===l){p=1;break}throw Error(h)}switch(p){case 1:case 2:case 3:case 5:case 14:o();break;default:throw Error(h)}if(!r.length)throw Error(h);return r},e.nextUid=1,e.matchesSelector=function(){var e=document.createElement("div");return"function"==typeof e.webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof e.mozMatchesSelector?"mozMatchesSelector":"function"==typeof e.msMatchesSelector?"msMatchesSelector":"matchesSelector"}(),e}(),m=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function v(e){if("string"!=typeof e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!(e=e.trim()))throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(m))throw Error("Invalid request option. invalid attribute name: "+e);return e}function _(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");for(var t,n,i={},r={},o=e.split(/\s+/),s=0;s<o.length;s++)if(t=o[s]){if(i[n=(t=v(t)).toLowerCase()])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");r[t]=!0,i[n]=!0}return Object.keys(r)}var y=function(){function e(t,n){var r=this;this.connected=!1,this.options=e.validateOptions(t),this.observerOptions=e.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this.callback=this.options.callback,this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(e){return e.elementFilter?e.elementFilter:[]})),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(function(e){return e.all}),this.queryValidators=[],e.createQueryValidator&&(this.queryValidators=this.options.queries.map(function(t){return e.createQueryValidator(r.root,t)})),this.observer=new i(function(e){r.observerCallback(e)}),n&&this.reconnect()}return e.prototype.filterIgnoredMutations=function(e){if(!this.options.mutationFilter||!e)return e;for(var t,n=[],i=this.options.mutationFilter,r=e.length-1;r>=0;--r)i(t=e[r])&&n.push(t);return n},e.createObserverOptions=function(e){var t,n={childList:!0,subtree:!0};function i(e){n.attributes&&!t||(n.attributes=!0,n.attributeOldValue=!0,e?(t=t||{},e.forEach(function(e){t[e]=!0,t[e.toLowerCase()]=!0})):t=void 0)}return e.forEach(function(e){if(e.characterData)return n.characterData=!0,void(n.characterDataOldValue=!0);if(e.all)return i(),n.characterData=!0,void(n.characterDataOldValue=!0);if(e.attribute)i([e.attribute.trim()]);else{var t=function(e,t){var n={};return e.forEach(function(e){e.qualifiers.forEach(function(e){t&&"class"===e.attrName||(n[e.attrName]=!0)})}),Object.keys(n)}(e.elementFilter,!1===e.classAttribute).concat(e.attributeList||[]);t.length&&i(t)}}),t&&(n.attributeFilter=Object.keys(t)),n},e.validateOptions=function(t){for(var n in t)if(!(n in e.optionKeys))throw Error("Invalid option: "+n);if("function"!=typeof t.callback)throw Error("Invalid options: callback is required and must be a function");if(!t.queries||!t.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");for(var i={callback:t.callback,mutationFilter:t.mutationFilter,nodeFilter:t.nodeFilter,rootNode:t.rootNode||document,observeOwnChanges:!!t.observeOwnChanges,oldPreviousSibling:!!t.oldPreviousSibling,queries:[]},r=0;r<t.queries.length;r++){var o=t.queries[r];if(o.all){if(Object.keys(o).length>1)throw Error("Invalid request option. all has no options.");i.queries.push({all:!0})}else if("attribute"in o){if((a={attribute:v(o.attribute)}).elementFilter=g.parseSelectors("*["+a.attribute+"]"),Object.keys(o).length>1)throw Error("Invalid request option. attribute has no options.");i.queries.push(a)}else if("element"in o){var s=Object.keys(o).length,a={element:o.element,elementFilter:g.parseSelectors(o.element)};if(o.hasOwnProperty("elementAttributes")&&(a.attributeList=_(o.elementAttributes),s--),void 0!==o.classAttribute&&(a.classAttribute=!1!==o.classAttribute,s--),s>1)throw Error("Invalid request option. element only allows elementAttributes option.");i.queries.push(a)}else{if(!o.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(o).length>1)throw Error("Invalid request option. characterData has no options.");i.queries.push({characterData:!0})}}return i},e.prototype.createSummaries=function(e){var t=this.filterIgnoredMutations(e);if(!t||!t.length)return[];for(var n=new d(this.root,t,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling,this.options.nodeFilter),i=[],r=0;r<this.options.queries.length;r++)i.push(new h(n,this.options.queries[r]));return i},e.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(e){e&&e.recordPreviousState()})},e.prototype.runQueryValidators=function(e){this.queryValidators.forEach(function(t,n){t&&t.validate(e[n])})},e.prototype.changesToReport=function(e){return e.some(function(e){if(r.some(function(t){return e[t]&&e[t].length}))return!0;if(e.attributeChanged&&Object.keys(e.attributeChanged).some(function(t){return!!e.attributeChanged[t].length}))return!0;return!1})},e.prototype.filterSummaries=function(e){if(e&&!(e.length<2)){var t,n,i,r=0;for(e.length;r<length;++r)if(!((t=e[r].added).length<1))for(var o=r+1;o<e.length;++o){i=e[o];for(var s=t.length-1;s>=0;--s)i.removed.indexOf(t[s])>=0?(t.splice(r,1),i.removed.splice(s,1)):(n=i.added.indexOf(t[0]))>=0&&i.added.splice(n,1)}}},e.prototype.observerCallback=function(e){this.options.observeOwnChanges||this.observer.disconnect();var t=this.createSummaries(e);this.runQueryValidators(t),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(t)&&(this.filterSummaries(t),this.callback(t)),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))},e.prototype.reconnect=function(){this.connected||(this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators())},e.prototype.disconnect=function(){if(!this.connected)return[];var e;try{e=this.takeSummaries(),this.observer.disconnect()}catch(e){}return this.connected=!1,e},e.prototype.takeSummaries=function(){if(!this.connected)throw Error("Not connected");var e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:void 0},e.NodeMap=o,e.parseElementFilter=g.parseSelectors,e.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0,mutationFilter:!1,nodeFilter:!1},e}();Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1}),e.MutationSummary=y}((window||this).FLITE),Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=function(){function e(t,n){var i=this;this.callback=n,this.id=String(e.nextId++),e._guards[this.id]=this;var r=function(s){t.removeEventListener("keyup",r,!0),delete e._guards[i.id],o&&clearTimeout(o);var a=s.keyCode||s.which;8===a?n({backspace:!0,ctrl:s.ctrlKey,shift:s.shiftKey}):46===a&&n({del:!0,ctrl:s.ctrlKey,shift:s.shiftKey})};t.addEventListener("keyup",r,!0);var o=setTimeout(function(){o=0,removeEventListener("keyup",r,!0),delete e._guards[i.id]},1)}return e._guards={},e.nextId=0,e}();t.BackspaceGuard=o,function(e,t){var n,i=function(){function e(){}return Object.defineProperty(e.prototype,"browser",{get:function(){if(this._browser)return t.extend({},this._browser);var e=navigator.userAgent.toLowerCase(),n=function(e){e=e.toLowerCase();var t=/(edge)\s*\/?([0-9\.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}(e),i={type:"unknown",version:0,msie:!1,edge:!1,webkit:!1,safari:!1,firefox:!1};return n.browser&&(i[n.browser]=!0,i.version=Number(n.version),i.type=n.browser),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),i.webkit&&(i.type="webkit"),i.firefox=1==/firefox/.test(e),i.msie||(i.msie=Boolean(/trident/.test(e))),this._browser=i,t.extend({},i)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"browserType",{get:function(){if(null===this._browserType){for(var e=["msie","firefox","chrome","safari"],t=e.length,n=0;n<t;n++)if(!0===new RegExp(e[n],"i").test(navigator.userAgent))return this._browserType=e[n],this._browserType;this._browserType="other"}return this._browserType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webkitType",{get:function(){return"webkit"===this.browser.type&&(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?"safari":"chrome")},enumerable:!0,configurable:!0}),e.prototype.isBrowser=function(e){return this.browser.type===e},e.prototype.isFLITEBody=function(e){return e&&Boolean(e.getAttribute("data-flite-body"))},e.prototype.markFLITEBody=function(e){e&&e.setAttribute("data-flite-body","1")},e.prototype.getTagName=function(e){return e&&e.tagName&&e.tagName.toLowerCase()||null},e.prototype.isBRNode=function(e){return"br"==this.getTagName(e)},e.prototype.printRange=function(e){if(!e)return"<null range>";var t=["Range:",n.printNode(e.startContainer),e.startOffset];return e.collapsed||(t=t.concat([n.printNode(e.endContainer),e.endOffset])),t.join(" ")},e.prototype.printNode=function(e){if(!e)return"<null node>";var t=e.nodeType,n=[t===Node.TEXT_NODE?"text":t===Node.ELEMENT_NODE?e.nodeName:"<"+t+"node>"];return e.id&&n.push("#",e.id),e.className&&n.push(".",e.className),n.push("(",(t===Node.TEXT_NODE?e.data+String(e.length):String(e.innerHTML)).substring(0,15),")"),n.push("parent:",e.parentNode&&e.parentNode.nodeName||"NULL"),n.join("")},e.prototype.stripNode=function(e){if(e&&1===e.nodeType){var n=e,i=t.map(n.attributes,function(e){return e.name});t(e).removeClass(),t.each(i,function(e,t){n.removeAttribute(t)})}},e.prototype.findIndexInArray=function(e,t){if(!e)return-1;for(var n=0,i=e.length;n<i;++n)if(t(e[n]))return n;return-1},e.prototype.findInArray=function(e,t){var n=this.findIndexInArray(e,t);return n>=0?e[n]:null},e.prototype.createBackspaceGuard=function(e,t){return new o(e,t)},e.prototype.makeDateLabel=function(e,t,n,i){new Date;var r=e("MONTHS"),o="string"==typeof r?r.split(","):r;return[o&&o[n]||"",t,i].join(" ")},e.prototype.fixSelection=function(e,t){if(!e||!t||e.collapsed)return e;var n;try{for(;(n=e.endContainer)&&n!==t&&0==e.endOffset&&!e.collapsed&&(n.previousSibling?e.setEndBefore(n):n.parentNode&&n.parentNode!==t&&e.setEndBefore(n.parentNode),e.endContainer!==n););}catch(e){}try{for(;(n=e.startContainer)&&n!==t&&!e.collapsed&&((n=e.startContainer).nodeType==Node.TEXT_NODE?e.startOffset>=n.nodeValue.length&&e.setStartAfter(n):e.startOffset>=n.childNodes.length&&e.setStartAfter(n),e.startContainer!=n););}catch(e){}},e}();e.utils=n=new i}(window.FLITE,window.jQuery),Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){var n={meta:!0,input:!0,frame:!0,col:!0,base:!0,area:!0,img:!0,hr:!0,iframe:!0,param:!0,link:!0},i={body:!0,p:!0,div:!0,table:!0,tbody:!0,tr:!0,td:!0,th:!0,pre:!0,ul:!0,ol:!0,li:!0,fieldset:!0,form:!0,blockquote:!0,dl:!0,dt:!0,dd:!0,dir:!0,center:!0,address:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0},r=function(e){for(var t={},n=0,i=e.length;n<i;++n)t[String(e[n])]=1;return t}(["body","p","div","pre","u","b","s","sub","sup","em","strong","span","i","li","td","th","blockquote","dt","dd","center","address","h1","h2","h3","h4","h5","h6","ins","del"]),o=t.extend({},n);o.br=1;var s=Object.keys(n).join(", ");var a=function(){function n(){this.wsrgx=/^\s*$/,this.numrgx=/^\d+$/}return n.prototype.isEmptyString=function(e){for(var t,n=void 0!==e&&null!==e&&e.length-1||0;n>=0;)if("​"!==(t=e[n--])&&"\ufeff"!==t&&" "!==t)return!1;return!0},n.prototype.addStubElement=function(e){o[e]=!0},n.prototype.getKeyChar=function(e){return String.fromCharCode(e.which)},n.prototype.removeEmptyCharsFromTextNode=function(e){var t;if(!e||!(t=e.length))return!1;for(var n=[],i=e.data,r=0;r<t;++r)8203===i.charCodeAt(r)&&n.push(r);if(n.length<1)return!1;var o=i.split("");for(r=n.length-1;r>=0;--r)o.splice(r,1);return e.data=o.join(""),!0},n.prototype.getChildrenOfClass=function(e,n,i){n||(n=document.body);var r=e.split(" ");return r.unshift(i||""),e=r.join("."),t.makeArray(t(n).find(e))},n.prototype.getElementWidth=function(e){return e.offsetWidth},n.prototype.getElementHeight=function(e){return e.offsetHeight},n.prototype.getElementDimensions=function(e){return{width:this.getElementWidth(e),height:this.getElementHeight(e)}},n.prototype.insertAfter=function(e,t,n){return e?(n=n||t&&t.parentNode,t&&t.parentNode,n?t?n.insertBefore(e,t.nextSibling):n.insertBefore(e,n.firstChild):void 0):null},n.prototype.contents=function(e){return t.makeArray(t(e).contents())},n.prototype.extractContent=function(e){for(var t,n=document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},n.prototype.getNode=function(e,n){if(!e)return null;e=e.$||e;var i=t(e);return e.nodeType!==Node.TEXT_NODE&&i.is(n)?e:i.parents(n)[0]||null},n.prototype.getParents=function(e,n,i){for(var r=t(e).parents(n),o=r.length,s=[],a=0;a<o&&r[a]!==i;a++)s.push(r[a]);return s},n.prototype.getSiblings=function(e,n,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=null),!0===i)return"prev"===n?t(e).prevAll():t(e).nextAll();var o=[];if("prev"===n)for(;e.previousSibling&&(e=e.previousSibling)!==r;)o.push(e);else for(;e.nextSibling&&(e=e.nextSibling)!==r;)o.push(e);return o},n.prototype.hasClass=function(e,t){if(!e||1!==e.nodeType)return!1;var n=e,i=n.classList||n.className&&n.className.split(/\s/);if(i&&i.length)for(var r=i.length-1;r>=0;--r)if(i[r]===t)return!0;return!1},n.prototype.getNodeTextContent=function(e){return t(e).text()},n.prototype.getNodeStubContent=function(e){return t(e).find(s)},n.prototype.hasNoTextOrStubContent=function(e){var n=e,i=n&&n.tagName&&String(n.tagName).toLowerCase();if(!(i&&i in r))return!1;var o=this.getNodeTextContent(e);return!!this.isEmptyString(o)&&(!e.firstChild||0===t(e).find(s).length)},n.prototype.isEmptyTextNode=function(e){if(!e||Node.TEXT_NODE!==e.nodeType)return!1;var t=e;return 0===t.length||this.isEmptyString(t.nodeValue)},n.prototype.getNodeCharacterLength=function(e){return this.getNodeTextContent(e).length+t(e).find(s).length},n.prototype.setNodeTextContent=function(e,n){return t(e).text(n)},n.prototype.getIframeDocument=function(e){var t=null;return e.contentDocument?t=e.contentDocument:e.contentWindow?t=e.contentWindow.document:e.document&&(t=e.document),t},n.prototype.isBlockElement=function(e){return e&&e.nodeName&&e.nodeName.toLowerCase()in i},n.prototype.isStubElement=function(e){return e&&e.nodeName&&e.nodeName.toLowerCase()in o},n.prototype.isChildOf=function(e,t){try{for(;e&&e.parentNode;){if(e.parentNode===t)return!0;e=e.parentNode}}catch(e){}return!1},n.prototype.isChildOfTagNames=function(e,t){try{for(var n=void 0;e&&e.parentNode;){if(e.parentNode&&e.parentNode.nodeName){n=e.parentNode.nodeName.toLowerCase();for(var i=0;i<t.length;i++)if(n===t[i])return e.parentNode}e=e.parentNode}}catch(e){}return null},n.prototype.getElementsBetween=function(e,t){var n,i,r=[];if(e===t)return r;if(this.isChildOf(t,e)){n=(i=e).childNodes.length;for(var o=0;o<n&&e.childNodes[o]!==t;o++){if(!0===this.isChildOf(t,i.childNodes[o]))return this.arrayMerge(r,this.getElementsBetween(i.childNodes[o],t));r.push(i.childNodes[o])}return r}for(var s=e.nextSibling;s;){if(!0===this.isChildOf(t,s))return r=this.arrayMerge(r,this.getElementsBetween(s,t));if(s===t)return r;r.push(s),s=s.nextSibling}for(var a=this.getParents(e,null,null),l=this.getParents(t,null,null),d=this.arrayDiff(a,l,!0),h=d.length,c=0;c<h-1;c++)r=this.arrayMerge(r,this.getSiblings(d[c],"next"));var u=d[d.length-1];return r=this.arrayMerge(r,this.getElementsBetween(u,t))},n.prototype.walk=function(e,t,n){e&&(n||(n=0),!1!==t.call(this,e,n)&&(e.childNodes&&e.childNodes.length>0?this.walk(e.firstChild,t,n+1):e.nextSibling?this.walk(e.nextSibling,t,n):e.parentNode&&e.parentNode.nextSibling&&this.walk(e.parentNode.nextSibling,t,n-1)))},n.prototype.getCommonAncestor=function(e,t){for(var n=e;n;){if(!0===this.isChildOf(t,n))return n;n=n.parentNode}return null},n.prototype.getNextNode=function(e,t){if(e)for(;e.parentNode;){if(e===t)return null;if(e.nextSibling){if(e.nextSibling.nodeType===Node.TEXT_NODE&&0===e.nextSibling.length){e=e.nextSibling;continue}return this.getFirstChild(e.nextSibling)}e=e.parentNode}return null},n.prototype.canContainTextElement=function(e){return Boolean(e&&e.nodeName&&e.nodeName.toLowerCase()in r)},n.prototype.getFirstChild=function(e){return e.nodeType!==Node.ELEMENT_NODE?null:e.firstChild?e.firstChild.nodeType===Node.ELEMENT_NODE?this.getFirstChild(e.firstChild):e.firstChild:e},n.prototype.getLastChild=function(e){return e.nodeType!==Node.ELEMENT_NODE?null:e.lastChild?e.lastChild.nodeType===Node.ELEMENT_NODE?this.getLastChild(e.lastChild):e.lastChild:e},n.prototype.getNextContentNode=function(e,t){if(e)for(;e.parentNode;){if(e===t)return null;if(e.nextSibling&&this.canContainTextElement(this.getBlockParent(e,t))){if(e.nextSibling.nodeType===Node.TEXT_NODE&&this.isEmptyTextNode(e)){e=e.nextSibling;continue}return e.nextSibling}if(e.nextElementSibling)return e.nextElementSibling;e=e.parentNode}return null},n.prototype.getPrevNode=function(e,t){if(e)for(;e.parentNode;){if(e===t)return null;if(e.previousSibling){if(e.previousSibling.nodeType===Node.TEXT_NODE&&0===e.previousSibling.length){e=e.previousSibling;continue}return this.getLastChild(e.previousSibling)}e=e.parentNode}return null},n.prototype.getPrevContentNode=function(e,t){if(e)for(;e.parentNode;){if(e===t)return null;if(e.previousSibling&&this.canContainTextElement(this.getBlockParent(e,t))){if(e.previousSibling.nodeType===Node.TEXT_NODE&&0===e.previousSibling.length){e=e.previousSibling;continue}return e.previousSibling}if(e.previousElementSibling)return e.previousElementSibling;e=e.parentNode}return null},n.prototype._findNextTextContainer=function(e){for(var t;e;){if(Node.TEXT_NODE==e.nodeType)return e;for(var n=e.firstChild;n;n=n.nextSibling)if(t=this._findNextTextContainer(n))return t;if(this.isTextContainer(e))return e;e=e.nextSibling}return null},n.prototype._findPrevTextContainer=function(e){for(;e;){if(Node.TEXT_NODE==e.nodeType)return e;for(var t=e.lastChild;t;t=t.previousSibling){var n=this._findPrevTextContainer(t);if(n)return n}if(this.isTextContainer(e))return e;e=e.previousSibling}return null},n.prototype.findPrevTextContainer=function(e,t){if(!e||e==t)return{node:t,offset:0};if(e.parentNode&&this.isTextContainer(e.parentNode))return{node:e.parentNode,offset:this.getNodeIndex(e)};for(;e.previousSibling;){var n=this._findPrevTextContainer(e.previousSibling);if(n)return{node:n,offset:this.getNodeLength(n)};e=e.previousSibling}return this.findPrevTextContainer(e.parentNode&&e.parentNode.previousSibling,t)},n.prototype.findNextTextContainer=function(e,t){if(!e||e==t)return{node:t,offset:this.getNodeLength(t)};if(e.parentNode&&this.isTextContainer(e.parentNode))return{node:e.parentNode,offset:this.getNodeIndex(e)+1};for(;e.nextSibling;){var n=this._findNextTextContainer(e.nextSibling);if(n)return{node:n,offset:0};e=e.previousSibling}return this.findNextTextContainer(e.parentNode&&e.parentNode.nextSibling,t)},n.prototype.getNodeLength=function(e){return e?Node.TEXT_NODE==e.nodeType?e.length:e.childNodes&&e.childNodes.length||0:0},n.prototype.isTextContainer=function(e){return e&&Node.TEXT_NODE==e.nodeType||(e.nodeName||"").toLowerCase()in r},n.prototype.getNodeIndex=function(e){for(var t=0;e=e.previousSibling;)++t;return t},n.prototype.splitTextAt=function(e,t,n,i){void 0===i&&(i=!1);var r,o=e.length;return t<0||t>=o?null:(t+n>=o&&(n=o-t),n===o?i?e:null:((r=t>0?e.splitText(t):e).length>n&&r.splitText(n),r))},n.prototype.isset=function(e){return void 0!==e&&null!==e},n.prototype.inArray=function(e,t){for(var n=t.length,i=0;i<n;i++)if(e===t[i])return!0;return!1},n.prototype.arrayDiff=function(e,t,n){var i,r=e.length,o=[];for(i=0;i<r;i++)!1===this.inArray(e[i],t)&&o.push(e[i]);if(!0!==n)for(r=t.length,i=0;i<r;i++)!1===this.inArray(t[i],e)&&o.push(t[i]);return o},n.prototype.arrayMerge=function(e,t){for(var n=t.length,i=0;i<n;i++)e.push(t[i]);return e},n.prototype.getBlockParent=function(e,t){if(!0===this.isBlockElement(e))return e;if(e&&e!==t)for(;e.parentNode;){if(e=e.parentNode,!0===this.isBlockElement(e))return e;if(e===t)return null}return null},n.prototype.isOnBlockBoundary=function(e,t,n){return!(!e||!t)&&(this.getBlockParent(e,n)||this.isBlockElement(e)&&e||null)!==(this.getBlockParent(t,n)||this.isBlockElement(t)&&t||null)},n.prototype.mergeContainers=function(e,n){if(!e||!n)return!1;if(e.nodeType===Node.TEXT_NODE||this.isStubElement(e))n.appendChild(e);else if(e.nodeType===Node.ELEMENT_NODE){for(;e.firstChild;)n.appendChild(e.firstChild);t(e).remove()}return!0},n.prototype.isRangeInElement=function(e,t){for(var n=e&&e.startContainer;n;){if(n===t)return!0;n=n.parentNode}return!1},n.prototype.mergeBlockWithSibling=function(e,n,i){var r=i?t(n).next().get(0):t(n).prev().get(0);return i?this.mergeContainers(r,n):this.mergeContainers(n,r),e.collapse(!0),!0},n.prototype.normalizeNode=function(t){return t?e.utils.browser.msie||"function"!=typeof t.normalize?(function e(t){if(t&&t.nodeType===Node.ELEMENT_NODE)for(var n=t.firstChild;n;){if(n.nodeType===Node.ELEMENT_NODE)e(n);else if(n.nodeType==Node.TEXT_NODE)for(var i;(i=n.nextSibling)&&i.nodeType==Node.TEXT_NODE;){var r=i.nodeValue;null!=r&&r.length&&(n.nodeValue=n.nodeValue+r),t.removeChild(i)}n=n.nextSibling}}(t),t):(t.normalize(),t):null},n.prototype._getNextContainer=function(e,t){var n=t&&t.root;if(!e||e===n)return null;for(;e.nextSibling;){if((e=e.nextSibling).nodeType!==Node.TEXT_NODE){var i=this.getFirstSelectableChild(e,t);if(null!==i)return i}if(this.isSelectable(e,t))return e}for(;e&&!e.nextSibling;){if(e===n)return null;e=e.parentNode}if(!e||e===n)return null;if(e=e.nextSibling,this.isSelectable(e,t))return e;var r=this.getFirstSelectableChild(e,t);return null!==r?r:this._getNextContainer(e,t)},n.prototype.getNextContainer=function(e,t){return this._getNextContainer(e,t||{})},n.prototype._getPreviousContainer=function(t,n){var i=n.root,r=n.filter;if(!t||t===i)return null;for(;t.previousSibling;){if((t=t.previousSibling).nodeType!==Node.TEXT_NODE){if(!0===e.domUtils.isStubElement(t))return t;var o=this.getLastSelectableChild(t,n);if(null!==o)return o}if(this.isSelectable(t,n))return t}do{if(!(t=t.parentNode)||t===i)return null;if(r&&r(t))return t;if(t.previousSibling)break}while(t);if(t=t.previousSibling,this.isSelectable(t,n))return t;var s=this.getLastSelectableChild(t,n);return null!==s?s:this._getPreviousContainer(t,n)},n.prototype.getPreviousContainer=function(e,t){return this._getPreviousContainer(e,t||{})},n.prototype.getNextSelectableNode=function(e,t){if(void 0===t&&(t=null),!e)return null;var n=e.nodeType;if(t=t||{},n===Node.TEXT_NODE&&(!1!==t.allowEmptyText||!this.isEmptyTextNode(e)))return e;if(n===Node.ELEMENT_NODE){if(!t.excludeSelf&&t.filter&&t.filter(e))return e;if(e.firstChild){var i=this.getFirstSelectableChild(e,t);if(i)return i}}return(e=this.getNextContainer(e,t))?e.nodeType===Node.TEXT_NODE?e:t&&t.filter&&t.filter(e)?e:this.getNextSelectableNode(e,t):null},n.prototype._getPreviousSelectableNode=function(e,t){return(e=this._getPreviousContainer(e,t))?e.nodeType!==Node.TEXT_NODE||!1===t.allowEmptyText&&this.isEmptyTextNode(e)?t&&t.filter&&t.filter(e)?e:this._getPreviousSelectableNode(e,t):e:null},n.prototype.getPreviousSelectableNode=function(e,t){return this._getPreviousSelectableNode(e,t||{})},n.prototype.getFirstSelectableChild=function(e,t){if(!e)return null;if(!(t=t||{}).excludeSelf){if(e.nodeType===Node.TEXT_NODE&&(!1!==t.allowEmptyText||!this.isEmptyTextNode(e)))return e;if(t&&t.filter&&t.filter(e))return e}var n,i=e.firstChild;for(t=t.excludeSelf?{root:t.root,excludeSelf:!1,filter:t.filter,allowEmptyText:t.allowEmptyText}:t;i;){if(n=this.getFirstSelectableChild(i,t))return n;i=i.nextSibling}return null},n.prototype.getLastSelectableChild=function(e,t){if(void 0===t&&(t=null),!e)return null;if(!(t=t||{}).excludeSelf){if(e.nodeType==Node.TEXT_NODE&&(!1!==t.allowEmptyText||!this.isEmptyTextNode(e)))return e;if(t&&t.filter&&t.filter(e))return e}var n,i=e.lastChild;for(t=t.excludeSelf?{root:t.root,excludeSelf:!1,filter:t.filter,allowEmptyText:t.allowEmptyText}:t;i;){if(n=this.getLastSelectableChild(i,t))return n;i=i.previousSibling}return null},n.prototype.isSelectable=function(e,t){return!!e&&(e.nodeType===Node.TEXT_NODE&&!this.isEmptyTextNode(e)||!(!t||!t.filter)&&t.filter(e))},n.prototype.insertNodeAt=function(e,t,n){return!(!e||!t||t.nodeType!==Node.ELEMENT_NODE||n<0)&&(t.insertBefore(e,t.childNodes[n]),!0)},n.prototype.matchesSelector=function(e,n){return!(!e||e.nodeType!==Node.ELEMENT_NODE)&&(e.matches?e.matches(n):e.msMatchesSelector?e.msMatchesSelector(n):t(e).is(n))},n.prototype.findNodeByTagName=function(e,t){for(var n,i=e&&e.length||0,r=0;r<i;++r)if((n=e[r]).nodeType===Node.ELEMENT_NODE&&t.test(n.tagName))return n;return null},n.prototype.isAncestorAmong=function(t,n){for(var i=e.rangy.dom,r=0;r<t.length;++r)if(i.isAncestorOf(t[r],n,!1))return!0;return!1},n}();e.domUtils=new a}((this||window).FLITE,window.jQuery),Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){var n=function(){function e(e){}return e.prototype.init=function(e){},e.prototype.hideAll=function(e){},e.prototype.showTooltip=function(e,t,n){e&&e.setAttribute("title",t)},e.prototype.hideTooltip=function(e){t(e).attr("title",null)},e}();e.DefaultTooltips=n}((window||this).FLITE,window.jQuery),Object.defineProperty(t,"__esModule",{value:!0}),function(e){e||console.error("documentselection: global is not defined");var t=function(){function t(e){this.env=e,this._setHook=null,this._selection=null,this.getSelection()}return Object.defineProperty(t.prototype,"nativeSelection",{get:function(){return this.getSelection().nativeSelection},enumerable:!0,configurable:!0}),t.prototype.setHook=function(e){this._setHook=e},t.prototype.getSelection=function(){return e.rangy.getSelection?(this._selection?this._selection.refresh():this.env.frame?this._selection=e.rangy.getSelection(this.env.frame):this._selection=e.rangy.getSelection(null),this._selection):(e.Logger.log("no getselection, rangy is",Object.keys(e.rangy),"global is",Object.keys(e),"initialized",e.rangy.isInitialized()),null)},t.prototype.createRange=function(){return e.rangy.createRange(this.env.document)},t.prototype.getRangeAt=function(e){try{return this._selection.refresh(),this._selection.getRangeAt(e)}catch(e){this._selection=null;try{return this.getSelection().getRangeAt(0)}catch(e){}}return null},t.prototype.getRange=function(){return this.getRangeAt(0)},t.prototype.moveLeft=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=1),(e=e||this.getRangeAt(0))&&(e.moveStart("char",-t,n),e.collapse(!0),this.addRange(e))},t.prototype.nudgeLeft=function(t,n){if((t=t||this.getRangeAt(0))&&t.collapsed&&t.startContainer){var i=t.startContainer;if(0===t.startOffset){var r=e.domUtils.getPreviousSelectableNode(i.previousSibling||i.parentNode,n);r&&r!==i&&this.setEnd(r,!0,r.nodeType===Node.TEXT_NODE?r.length:0)}}},t.prototype.nudgeRight=function(t,n){var i,r=(t=t||this.getRangeAt(0))&&t.collapsed&&t.endContainer;if(r&&(1===r.nodeType?i=t.endOffset>=r.childNodes.length:3===r.nodeType&&(i=t.endOffset>=r.length),i)){var o=e.domUtils.getFirstSelectableChild(r.nextSibling||r.parentNode,n);o&&o!==r&&this.setStart(o,!0,0)}},t.prototype.moveRight=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=1),(e=e||this.getRangeAt(0))&&(e.moveStart("char",t,n),e.collapse(!0),this.addRange(e))},t.prototype.collapseBefore=function(t,n){var i=this.getRangeAt(0);if(!i||!t)return!1;try{t=this._getEffectiveStartNode(t),i.setStartBefore(t),i.collapse(!0);var r=i.startContainer;if(n&&1===r.nodeType&&i.startOffset){var o=r.childNodes[i.startOffset-1],s=o&&o.nodeType;if(3===s)i.setStart(o,o.length);else if(1===s){var a=e.domUtils.getLastSelectableChild(o,n),l=a&&a.nodeType;3===l?i.setStart(a,a.length):1===l&&i.setStart(a,a.childNodes.length)}}return i.collapse(!0),void this.addRange(i)}catch(e){return!1}},t.prototype.collapseAtStart=function(e){return this._collapseAt(e,!0)},t.prototype.collapseAtEnd=function(e){return this._collapseAt(e,!1)},t.prototype.collapseAfter=function(e,t){var n=this.getRangeAt(0);if(!n||!e)return!1;try{return n.setEndAfter(e),n.collapse(!1),void this.addRange(n)}catch(e){return!1}},t.prototype.setStart=function(e,t,n){if(e&&e.ownerDocument&&e.parentNode){var i=this.getRangeAt(0);return!!i&&(i.setStart(e,n),t&&i.collapse(!0),this.addRange(i),i.startContainer===e)}},t.prototype.setEnd=function(e,t,n){if(e&&e.ownerDocument&&e.parentNode){var i=this.getRangeAt(0);return!!i&&(i.setEnd(e,n),t&&i.collapse(!1),this.addRange(i),i.endContainer===e)}},t.prototype.addRange=function(e){this._selection||(this._selection=this.getSelection()),this._selection.setSingleRange(e),this._selection.ranges=[e],this._setHook&&this._setHook(e)},t.prototype._selectNodeOrContent=function(e,t){t.nodeType===Node.TEXT_NODE?e.selectNode(t):e.selectNodeContents(t)},t.prototype._collapseAt=function(t,n){var i=this.getRangeAt(0);if(!i||!t)return!1;try{3===t.nodeType?n?this.setStart(t,!0,0):this.setEnd(t,!0,t.length):(this._selectNodeOrContent(i,t),i.collapse(n),this.addRange(i))}catch(t){return e.Logger.error("collapseAt",n?"start":"end",t),!1}},t.prototype._getEffectiveStartNode=function(e){if(!e||1!==e.nodeType)return e;var t=e.parentNode;return t&&e===t.firstChild?"LI"===e.nodeName||"TR"===e.nodeName?e.parentNode:"TD"===e.nodeName&&t===(t.parentNode&&t.parentNode.firstChild)?t.parentNode:e:e},t.prototype._getEffectiveEndNode=function(e){if(!e||1!==e.nodeType)return e;var t=e.parentNode;return t&&e===t.lastChild?"LI"===e.nodeName||"TR"===e.nodeName?e.parentNode:"TD"===e.nodeName&&t===(t.parentNode&&t.parentNode.lastChild)?t.parentNode:e:e},t}();e.Selection=t}((window||this).FLITE),Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){e||console.error("marker: global is not defined");var n=function(){function n(n,i,r){this.env=n;var o=n.element;this.removeBookmarks(o);var s,a=r||i.getRangeAt(0),l=a.cloneRange(),d=l.startContainer,h=l.startOffset;l.collapse(!1);var c=this.env.document.createElement("span");c.style.display="none",t(c).html("&nbsp;").addClass("flite-bookmark flite-bookmark_end").attr("flite-bookmark","end"),l.insertNode(c),e.domUtils.isChildOf(c,o)||o.appendChild(c),l.setStart(d,h),l.collapse(!0);var u=this.env.document.createElement("span");u.style.display="none",t(u).addClass("flite-bookmark flite-bookmark-start").html("&nbsp;").attr("flite-bookmark","start");try{l.insertNode(u),u.previousSibling===c&&(s=u,u=c,c=s)}catch(e){t(u).insertBefore(c)}!1===e.domUtils.isChildOf(u,o)&&(o.firstChild?t(u).insertBefore(o.firstChild):o.appendChild(u)),c.previousSibling||(s=this.env.document.createTextNode(""),t(s).insertBefore(c)),u.nextSibling||(s=this.env.document.createTextNode(""),e.domUtils.insertAfter(s,u)),a.setStart(u.nextSibling,0),a.setEnd(c.previousSibling,c.previousSibling.length||0),this._start=u,this._end=c}return Object.defineProperty(n.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),n.prototype.collapseAndRemove=function(e,t){t&&this._start?e.collapseBefore(this._start):!t&&this._end&&e.collapseAfter(this._end),this.remove()},n.prototype.remove=function(){this._start&&(t([this._start,this.end]).remove(),this._start=this._end=null)},n.prototype.selectBookmark=function(n){var i=n.getRangeAt(0),r=null,o=null,s=0,a=null,l=this._start&&this._start.parentNode;if(this._start.nextSibling===this.end||0===e.domUtils.getElementsBetween(this._start,this.end).length)this.end.nextSibling?r=e.domUtils.getFirstChild(this.end.nextSibling):this._start.previousSibling?(r=e.domUtils.getFirstChild(this._start.previousSibling)).nodeType===Node.TEXT_NODE&&(s=r.length):(this.end.parentNode.appendChild(this.env.document.createTextNode("")),r=e.domUtils.getFirstChild(this.end.nextSibling));else{if(this._start.nextSibling)r=e.domUtils.getFirstChild(this._start.nextSibling);else{if(!this._start.previousSibling){var d=this.env.document.createTextNode("");t(this._start).before(d)}s=(r=e.domUtils.getLastChild(this._start.previousSibling)).length}this.end.previousSibling?o=e.domUtils.getLastChild(this.end.previousSibling):(o=e.domUtils.getFirstChild(this.end.nextSibling||this.end),a=0)}t([this._start,this.end]).remove();try{e.domUtils.normalizeNode(l)}catch(e){}null===o?i&&(i.setEnd(r,s),i.collapse(!1)):(i.setStart(r,s),null===a&&(a=o.length||0),i.setEnd(o,a));try{n.addRange(i)}catch(e){}},n.prototype.removeBookmarks=function(e){t(e).find("span.flite-bookmark").remove()},n}();e.DOMMarker=n}((window||this).FLITE,window.jQuery),Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.inline=0]="inline",e[e.block=1]="block",e[e.none=2]="none"}(i||(i={})),function(e){e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.None=0]="None"}(r||(r={})),function(e){var t,n="insertType",o="deleteType",s="flite-container-only",a="."+s,l=a+",[data-flite-complex]",d=":not(."+s+")",h={LI:1,TD:1,P:1},c={LI:1,P:1,DIV:1},u={OL:1,UL:1},p={LI:1,OL:1,UL:1},f={div:1,p:1,br:1,table:1,ol:1,li:1,ul:1,img:1},g=/^u|ol$/i,m=/li/i,v=[{start:0,end:31},{start:33,end:40},{start:45,end:45},{start:91,end:93},{start:112,end:123},{start:144,end:145}],_={attributes:{lite2Created:"data-flite-created",lite2Marked:"data-flite-marked",changeId:"data-flite-cid",userId:"data-userid",userName:"data-username",sessionId:"data-session-id",time:"data-time",lastTime:"data-last-change-time",changeData:"data-changedata"},changeGroupTime:200,ignoredInsertSelectors:null,ignoredDeleteSelectors:null,trackedInsertSelectors:null,trackedDeleteSelectors:null,ignoredSelectors:null,opaqueSelectors:null,hostMethods:{hideTooltip:null,showTooltip:null,hostNodeToNativeNode:null,getHostNativeRange:null,nativeNodeToHostNode:null,beforeInsert:null,getHostRange:null,beforeDelete:null,setHostRange:null,beforeEdit:null,getNewLineNodeName:null,updateLastUndo:null,getLocalizedString:null},classes:{block:"ice-block"},attrValuePrefix:"",mergeBlocks:!1,blockEl:"p",stylePrefix:"cts",changeTypes:{insertType:{alias:"ins",action:"Inserted"},deleteType:{alias:"del",action:"Deleted"}},contentEditable:void 0,tooltips:!1,tooltipsDelay:1,isVisible:!0,_changeData:null,handleSelectAll:!1};!function(e){e[e.Always=1]="Always",e[e.NotEmpty=2]="NotEmpty"}(t||(t={}));var y=[{selector:"img,br,.cke_widget_wrapper,li",type:t.Always},{selector:"p,div,td",type:t.NotEmpty}];function N(e){return!(!e||1!==e.nodeType)&&null!==e.getAttribute("data-mce-bogus")}var C=function(){function C(t){if(this._changes={},this._userStyles={},this._styleMap={},this._uniqueStyleIndex=0,this._isShowingTips=!1,this._ignoreMutations=!1,this._boundEventHandler=null,this._mutationSummary=null,this._domObserver=null,this._browserType=null,this._batchChangeId=null,this._uniqueIDIndex=1,!t.element)throw new Error("options.element must be defined for flite construction.");if(this.$this=$(this),this._summaryGuard=new T,this._lastMutationContext=new b,this._tooltipMouseOver=this._tooltipMouseOverImpl.bind(this),this._tooltipMouseOut=this._tooltipMouseOutImpl.bind(this),this._isDeletableCallback=this._isDeletableElement.bind(this),this._params=$.extend(!0,{},_,t),this._insertClassName=this._params.attrValuePrefix+this._params.changeTypes[n].alias,this._deleteClassName=this._params.attrValuePrefix+this._params.changeTypes[o].alias,t.tooltips&&(!$.isFunction(t.hostMethods.showTooltip)||!$.isFunction(t.hostMethods.hideTooltip)))throw new Error("hostMethods.showTooltip and hostMethods.hideTooltip must be defined if tooltips is true");this._params.opaqueSelectors&&e.domUtils.addStubElement(this._params.opaqueSelectors);var i=t.userStyles||{};for(var r in i)if(i.hasOwnProperty(r)){var a=Number(i[r]);isNaN(a)||(this._userStyles[r]=this._params.stylePrefix+"-"+a,this._uniqueStyleIndex=Math.max(a,this._uniqueStyleIndex),this._styleMap[a]=!0)}this._insertSelector="."+this._getTrackedNodeClass(n),this._deleteSelector="."+this._getTrackedNodeClass(o),this._deleteParentSelector=this._deleteSelector+":not(."+s+")",this._insertParentSelector=this._insertSelector+":not(."+s+")",this._lite2Selector=this._insertSelector+","+this._deleteSelector,this._domObserver=null,e.utils.browser.msie&&Object.defineProperty(this,"rootElement",{get:function(){try{return this._params.element}catch(e){return null}},configurable:!0,enumerable:!0})}return C.prototype.dispose=function(){this.setIgnoreMutations(!0),this._selection&&(this._selection.setHook(null),this._selection=null),this._params=null},C.prototype.getSelectedNode=function(){var e=this._getNodeAtCaret();return e&&e.node},C.prototype.createNativeRange=function(){return e.rangy.createNativeRange(this._host.document)},C.prototype.fixEmbeddedTrackedSpans=function(){},C.prototype.removeFLITETracking=function(e){var t=this;if(e&&e.nodeType===Node.ELEMENT_NODE){Object.keys(this.attributes).forEach(function(n){e.removeAttribute(t.attributes[n])});var n=$(e);n.removeClass(this._insertClassName).removeClass(this._deleteClassName).removeClass(s);var i=(e.className||"").split(" "),r=this._params.stylePrefix;return i.forEach(function(e){e&&0===e.indexOf(r)&&n.removeClass(e)}),""===e.getAttribute("class")&&e.removeAttribute("class"),e}},C.prototype.currentChangeNode=function(t,n){var i=this._lite2Selector;t=t||this.getSelectedNode();var r=n?t&&e.domUtils.matchesSelector(t,i):e.domUtils.getNode(t,i);return r},C.prototype.ignoreNextMutation=function(){this._summaryGuard.set(1)},C.prototype.setIgnoreMutations=function(e){var t=this._ignoreMutations;if(e){if(this._mutationSummary&&this._mutationSummary.disconnect(),this._domObserver){try{this._domObserver.disconnect()}catch(e){}this._domObserver=null}}else this._createMutationObservers(!0);return this._ignoreMutations=e,t},Object.defineProperty(C.prototype,"isVisible",{get:function(){return this._params.isVisible},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"contentEditable",{get:function(){return this._params.contentEditable},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"currentUser",{get:function(){return{id:this._user&&this._user.id,name:this._user&&this._user.name}},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"rootElement",{get:function(){return this._params.element},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"attributes",{get:function(){return this._params.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"changeTypes",{get:function(){return this._params.changeTypes},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"changeData",{get:function(){return this._params._changeData},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"hostMethods",{get:function(){return this._params.hostMethods},enumerable:!0,configurable:!0}),C.prototype.toggleChangeTracking=function(e,t){return e?this._startTracking(t):this._stopTracking(),this},C.prototype.setCurrentUser=function(e){var t=this,n={id:e&&String(e.id)||"",name:e&&String(e.name)||""};for(var i in this._user=n,this._changes){var r=this._changes[i];r.userid===n.id&&(r.username=n.name)}var o,s=this.getTrackedNodes(),a=this._params.attributes.userId;s.each(function(e,i){null!==(o=i.getAttribute(a))&&o!==n.id||i.setAttribute(t._params.attributes.userName,n.name)})},C.prototype.setSessionId=function(e){this._sessionId=e,this._lastChange=null},C.prototype.isNodeVisible=function(e){if(e&&e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),e){var t=e.getBoundingClientRect();return t.top>0&&t.left>0}},C.prototype.getWrappingTagName=function(e,t){var n=this.getNodeWrappingType(e);return n===i.block?"div":n===i.inline?"span":null},C.prototype.getNodeWrappingType=function(t){if(!t||t.nodeType===Node.TEXT_NODE)return i.inline;if("SPAN"===t.nodeName&&!e.domUtils.matchesSelector(t,a))return i.none;if(e.utils.getTagName(t)in f)return i.none;var n=t&&t.nodeType===Node.ELEMENT_NODE&&window.getComputedStyle(t),r=n&&n.display;return r?"none"===r?i.none:r.indexOf("inline")>=0?i.inline:r.indexOf("table")>=0||r.indexOf("list")>=0?i.none:i.block:i.none},C.prototype._insertNodes=function(t,i){this._startBatchChange();var r=[];try{var o=i&&i.startContainer,s=this._getNodeTrackingContext(o),a=(e.utils.findInArray(t,function(e){return e&&e.nodeType===Node.ELEMENT_NODE}),void 0);s.isTracking&&this._moveCaretOutOfTracking(i,s);for(var l=[],d=this._params.ignoredInsertSelectors,h={node:null,changeId:void 0,refNode:null,containerOnly:!1,trackChildren:!1,type:n},c=0,u=t.length;c<u;++c)a=t[c],this._isTrackable(a,d)?(h.node=a,h.changeId=null,h.containerOnly=a.nodeType!==Node.TEXT_NODE,h.trackChildren=h.containerOnly,a=this._createTrackedNode(h)):l.push(a),r.push(a);l.length&&this._getOrAddChange({type:n,nodes:l,changeId:null,containerOnly:!0,trackChildren:!0})}catch(t){e.Logger.error("_insertNode: ",t)}finally{this._endBatchChange(this._batchChangeId,!1)}return r},C.prototype._moveCaretOutOfTracking=function(t,n){if(t.collapsed&&n.tracksContent){var i=t.startContainer;if(1!==i.nodeType){if(3===i.nodeType){var r=i,o=e.domUtils.getNodeIndex(r);a=null;0===t.startOffset?o>0?a=this._splitNode(n.trackingNode,n.trackingNode,o):this._selection.collapseBefore(n.trackingNode):t.startOffset>=r.length?o<n.trackingNode.childNodes.length-1?a=this._splitNode(n.trackingNode,n.trackingNode,o+1):this._selection.collapseAfter(n.trackingNode):a=this._splitNode(n.trackingNode,r,t.startOffset),a&&(t.setStart(a.parentNode,e.domUtils.getNodeIndex(a)+1),t.collapse(!0),this._selection.addRange(t))}}else{var s=i;if(s===n.trackingNode)if(0===t.startOffset)this._selection.collapseBefore(n.trackingNode);else if(t.startOffset>=i.childNodes.length)this._selection.collapseAfter(s);else{var a=this._splitNode(n.trackingNode,n.trackingNode,t.startOffset);this._selection.collapseAfter(a)}}}},C.prototype.toggleTooltips=function(e){e=void 0===e?!this._params.tooltips:Boolean(e),this._params.tooltips=e,this._updateTooltipsState()},C.prototype.reload=function(e){e&&(this._loadEditor(e),this.setShowChanges(this.isVisible)),this._loadFromDom()},C.prototype.prepareToCut=function(){var t=this.setIgnoreMutations(!0);try{var n=this._getCurrentRange(!0),i=n.cloneRange();if(!n||n.collapsed)return!1;e.utils.fixSelection(n,this.rootElement);var r=n.cloneContents(),o=(n.cloneRange(),r.firstChild),s=r.lastChild;this.hostMethods.beforeEdit(),n.collapse(!1),n.insertNode(r),n.setStartBefore(o),n.setEndAfter(s);var a=this._startBatchChange();try{this._deleteSelectionNew(n,!1)}catch(t){e.Logger.error(t,"While trying to delete selection")}finally{this._endBatchChange(a,!1),this._selection.addRange(i),this._removeTrackingInRange(i)}return!0}finally{this._summaryGuard.set(1),this.setIgnoreMutations(t)}},C.prototype.prepareToCopy=function(){var e=this._getCurrentRange();if(e&&!e.collapsed){var t=this.setIgnoreMutations(!0);try{this._removeTrackingInRange(e)}finally{this.setIgnoreMutations(t)}}},C.prototype.tryToCut=function(){},C.prototype.setShowChanges=function(e){var t=this._$element;e=Boolean(e),this._params.isVisible=e,t&&(t.toggleClass("FLITE-Tracking",e),this._showTitles(e),this._updateTooltipsState())},C.prototype.unlistenToEvents=function(){return this.rootElement&&this._boundEventHandler&&this.rootElement.removeEventListener("keydown",this._boundEventHandler,!0),this._boundEventHandler=null,this},C.prototype.listenToEvents=function(){return this.rootElement&&!this._boundEventHandler&&(this._boundEventHandler=this.handleEvent.bind(this),this.rootElement.addEventListener("keydown",this._boundEventHandler,!0)),this},C.prototype.handleEvent=function(e){var t=!1;return"keypress"==e.type?t=this._keyPress(e):"keydown"==e.type&&(t=!this._handleKeyDown(e)),t&&(e.stopImmediatePropagation(),e.preventDefault()),!t},C.prototype.markNodeForPendingInsertion=function(e){e&&e.nodeType===Node.ELEMENT_NODE&&(e.setAttribute("data-flite-inserting","1"),setTimeout(function(){try{e.removeAttribute("data-flite-inserting")}finally{}},10))},C.prototype.setMutationContext=function(e,t){this._lastMutationContext.setContext(e,t)},C.prototype.getMutationContext=function(){return this._lastMutationContext.currentType},C.prototype.getCleanDOM=function(e,t){t=$.extend({},{callback:null,clone:!1,prepare:null},t);var n=this._lite2Selector;return e?"string"==typeof e?e=$("<div>"+e+"</div>")[0]:t.clone&&(e=$(e).clone()[0]):e=t.clone?$(this.rootElement).clone()[0]:this.rootElement,this._cleanBody(e,n,t)},C.prototype._cleanBody=function(e,t,n){var i=this;e=n.prepare?n.prepare.call(this,e):e;var r=$(e),o=r.find(t);return $.each(o,function(e,t){var n=$(t);n.attr(i.attributes.lite2Created)?i._replaceNodeWithContent(n):i.removeFLITETracking(t)}),r.find(this._deleteSelector).remove(),e=n.callback?n.callback.call(this,e):e},C.prototype.processNodesForInsert=function(t){if(!t||!t.length)return[];this.hostMethods.beforeInsert&&this.hostMethods.beforeInsert();var n=this._getCurrentRange(!0);if(!n)return[];var i,r=Boolean(!n.collapsed);try{r&&this._deleteContents(!0,n),i=this._insertNodes(t,n)}catch(t){e.Logger.error(t,"while trying to insert nodes"),i=[]}return i},C.prototype.isInsideChange=function(t,n){try{return Boolean(this.currentChangeNode(t,n))}catch(t){return e.Logger.error(t,"While testing if isInsideChange"),!1}},C.prototype.hasChanges=function(){var e,t=this._changes;for(var n in t)if(t.hasOwnProperty(n)&&(e=t[n])&&e.type)return!0;return!1},C.prototype.getTrackedNodes=function(){return this._$element?this._$element.find(this._lite2Selector):$()},C.prototype.countChanges=function(e){return this._filterChanges(e).count},C.prototype.acceptAll=function(e){return this._acceptRejectSome(e,!0)},C.prototype.rejectAll=function(e){return this._acceptRejectSome(e,!1),!0},C.prototype.acceptChange=function(e){this.acceptRejectChange(e,{isAccept:!0}),this._removeFLITEArtifacts()},C.prototype.getCurrentUser=function(){var e=this.currentUser||{},t=null===e.id||void 0===e.id?"":String(e.id);return{name:e.name||"",id:t}},C.prototype.rejectChange=function(e){return this.acceptRejectChange(e,{isAccept:!1}),this._removeFLITEArtifacts(),!0},C.prototype.getChanges=function(e){var t=e?this._filterChanges(e):this._changes;return $.extend(!0,{},t)},C.prototype.getContentElement=function(){return null},C.prototype.getChange=function(e){return this._changes[e]||null},C.prototype._acceptRejectSome=function(e,t){var n,i=this,r=function(e,n){i.acceptRejectChange(n,{isAccept:t,notify:!1})},o=e?this._filterChanges(e):{changes:this._changes,count:Object.keys(this._changes).length};for(n in o.changes)this._$element.find("["+this.attributes.changeId+"="+n+"]").each(r);this._removeFLITEArtifacts(),o.count&&this._triggerChange({isText:!0})},C.prototype._createTrackedNode=function(e){var t=e.refNode||e.node,n=e.node,i=e.trackChildren,r=e.containerOnly,o=this.getWrappingTagName(t,null);if(o){var s=this._host.document.createElement(o);if(n){var a=n.parentNode;a&&a.insertBefore(s,n),s.appendChild(n),n.nodeType!==Node.TEXT_NODE&&s.setAttribute("data-flite-complex","1")}s.setAttribute(this.attributes.lite2Created,"1"),r=this._isOpaqueNode(n),i=!1,n=s}else n=t;return this._getOrAddChange({type:e.type,nodes:[n],changeId:e.changeId,containerOnly:r,ignoredNodes:e.ignoredNodes,trackChildren:r&&i}),n},C.prototype._startTracking=function(e){return"boolean"==typeof this._params.contentEditable&&this.rootElement.setAttribute("contentEditable",String(this._params.contentEditable)),this._loadEditor(e),this._updateTooltipsState(),this.setIgnoreMutations(!1),this},C.prototype._stopTracking=function(){try{this.unlistenToEvents(),this.setIgnoreMutations(!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),this._mutationSummary&&(this._mutationSummary.disconnect(),this._mutationSummary=null),this._changes={}}catch(t){e.Logger.error(t,"While trying to stop tracking")}return this._updateTooltipsState(),this},C.prototype._filterChanges=function(e){var t,n=0,i={},r=e||{},o=r.filter,s=r.exclude?$.map(r.exclude,String):null,a=r.include?$.map(r.include,String):null,l=r.verify;for(var d in this._changes)if((t=this._changes[d])&&t.type){var h=o&&!o({userid:t.userid,time:t.time,data:t.data})||s&&s.indexOf(t.userid)>=0||a&&a.indexOf(t.userid)<0;h||(l&&(h=!this._$element.find("["+this.attributes.changeId+"]").length),h||(++n,i[d]=t))}return{count:n,changes:i}},C.prototype.acceptRejectChange=function(t,n){var i=this;n=n||{};var r,o,a,l,d,h,c,u,p,f=e.domUtils,g=this._$element,m=this._getCurrentRange(),v=m&&m.cloneRange(),_=this.hostMethods.getHostNativeRange(),y=_&&_.startContainer||v&&v.startContainer,N=this._deleteSelector,C=this._insertSelector,T=this.setIgnoreMutations(!0),b=!1!==n.removeChange,E=this._userStyles,S=this.attributes.userId,O=this._deleteClassName,w=this._insertClassName,k=n.isAccept,x=!1!==n.notify;try{var R=function(e){v&&e.each(function(e,t){t===y&&i._selection.setStart(v.startContainer,!0,v.startOffset)})};if(!t){if(!v||!v.collapsed)return;t=v.startContainer}if(r=N,o=C,k||(r=C,o=N),!(a=f.getNode(t,this._lite2Selector)))return;c=a.getAttribute(this.attributes.changeId),d=(l=g.find(r+"["+this.attributes.changeId+"="+c+"]")).length,l.each(function(t,n){var r=$(n);if(r.unbind("mouseover").unbind("mouseout"),r.hasClass(s)&&!i._isOpaqueNode(n.firstChild)){var o=n===y,a=!o&&r.contents();o&&i._selection.collapseBefore(n),i._acceptDeletedParagraph(r)||i._replaceNodeWithContent(r),o||R(a)}else e.rangy.dom.isAncestorOf(n,y,!0)&&i._selection.collapseBefore(n),i._removeNode(n)}),d+=(l=g.find(o+"["+this.attributes.changeId+"="+c+"]")).length,$.each(l,function(t,n){var r=$(n);if(h=n.getAttribute(S),p=null!==h&&E[h]||"",u=r.contents(),r.removeClass(w).removeClass(O).removeClass(p),n.getAttribute(i.attributes.lite2Created)){var o=n===y;o&&i._selection.collapseBefore(n),i._replaceNodeWithContent(r),o||R(u)}else i.removeFLITETracking(n);$.each(u,function(t,n){var i=Node.TEXT_NODE===n.nodeType&&n.nodeValue;if(i){for(var r=!1;i.indexOf("  ")>=0;)r=!0,i=i.replace("  ","  ");r&&(n.nodeValue=i)}e.domUtils.normalizeNode(n.parentNode)})}),b&&delete this._changes[c],d>0&&x&&this._triggerChange({isText:!0})}finally{this.setIgnoreMutations(T)}},C.prototype._acceptDeletedParagraph=function(e){var t=e[0],n=t&&t.nodeName;if(!(n&&n in c))return!1;var i=t.previousSibling;if(i&&i.nodeName===n){i.lastChild&&"BR"===i.lastChild.nodeName&&i.removeChild(i.lastChild);var r=e.contents();return $(i).append(r),e.remove(),!0}return!1},C.prototype._tooltipMouseOverImpl=function(e){var t,n=this,i=e.target||e.currentTarget,r=$(i);e.buttons||r.data("_tooltip_t")||(t=setTimeout(function(){var e=n.currentChangeNode(i,!1),t=e&&e.getAttribute(n._params.attributes.changeId),o=t&&n.getChange(t);if(o){var s=$(e).hasClass(n._insertClassName)?"insert":"delete";r.removeData("_tooltip_t"),n._params.hostMethods.showTooltip(i,{username:o.username,id:t,style:null,data:o.data,sessionId:o.sessionId,userid:o.userid,time:o.time,lastTime:o.lastTime,type:s})}},this._params.tooltipsDelay),r.data("_tooltip_t",t))},C.prototype._tooltipMouseOutImpl=function(e){var t=e.currentTarget,n=$(t),i=n.data("_tooltip_t");n.removeData("_tooltip_t"),i?clearTimeout(i):this._params.hostMethods.hideTooltip(t)},C.prototype._getTrackedNodeClass=function(e){return this._params.attrValuePrefix+this._params.changeTypes[e].alias},C.prototype._loadEditor=function(t){this._host=this._host||{},this._$element=$(t),this._host.element=t,this._host.document=t.ownerDocument,this._host.window=this._host.document.defaultView||window,this._host.frame=this._host.window.frameElement,this._lastChange=null,this._selection=new e.Selection(this._host),this._selection.setHook(this._onRangeChanged.bind(this)),this._loadFromDom(),this._updateTooltipsState(),this._isDeletableOptions={root:t,filter:this._isDeletableCallback},this._isDeletableNoSelfOptions={root:t,excludeSelf:!0,filter:this._isDeletableCallback}},C.prototype._loadFromDom=function(){var e=this;this._changes={},this._uniqueStyleIndex=0;var t,n=this.currentUser&&this.currentUser.id,i=this.currentUser&&this.currentUser.name||"",r=(new Date).getTime(),o=new RegExp(this._params.stylePrefix+"-(\\d+)"),s=[];for(var a in this.changeTypes)s.push(this._getTrackedNodeClass(a));var l=new RegExp("("+s.join("|")+")");this.getTrackedNodes().each(function(s,a){for(var d,h,c,u="",p=a.className.split(" "),f=0;f<p.length;f++)(t=o.exec(p[f]))&&(d=t[0],h=t[1]),(c=l.exec(p[f]))&&(u=e._getChangeTypeFromAlias(c[1]));var g=a.getAttribute(e.attributes.changeId)||a.getAttribute("data-cid")||"";if(g&&!isNaN(Number(g))){a.setAttribute(e.attributes.changeId,g);var m,v=a.getAttribute(e.attributes.userId);n&&v==n?(m=i,a.setAttribute(e.attributes.userName,i)):m=a.getAttribute(e.attributes.userName),e._setUserStyle(v,Number(h)),a.setAttribute(e.attributes.changeId,String(g));var _=parseInt(a.getAttribute(e.attributes.time)||"");isNaN(_)&&(_=r);var y=parseInt(a.getAttribute(e.attributes.lastTime)||"");isNaN(y)&&(y=_);var N=a.getAttribute(e.attributes.sessionId),C=a.getAttribute(e.attributes.changeData)||"";e._changes[g]={id:null,type:u,style:d,userid:String(v),username:m,time:_,lastTime:y,sessionId:N,data:C},e._updateNodeTooltip(a)}else e.removeFLITETracking(a)}),this._triggerChange()},C.prototype._updateTooltipsState=function(){var e=this;this._params.tooltips&&this.isVisible?this._isShowingTips||(this._isShowingTips=!0,this.getTrackedNodes().each(function(t,n){e._addTooltipToNode(n)})):this._isShowingTips&&(this._isShowingTips=!1,this.getTrackedNodes().each(function(e,t){$(t).unbind("mouseover").unbind("mouseout")}))},C.prototype._triggerChange=function(e){this.$this.trigger("change"),e&&e.isText&&this.$this.trigger("textChange")},C.prototype._addTooltipToNode=function(e){$(e).unbind("mouseover").unbind("mouseout").mouseover(this._tooltipMouseOver).mouseout(this._tooltipMouseOut)},C.prototype._updateNodeTooltip=function(e){e&&e.nodeType===Node.ELEMENT_NODE&&this._params.tooltips&&this.isVisible&&this._addTooltipToNode(e)},C.prototype.getNewChangeId=function(){var e;do{e=String(++this._uniqueIDIndex)}while(this._changes[e]);return e},C.prototype._getOrAddChange=function(t){var n=this,i=t.changeId||this._batchChangeId,r=i&&this._changes[i]||this._getCurrentChange();return r||(r={id:this.getNewChangeId(),type:t.type,time:Date.now(),lastTime:0,sessionId:this.sessionId,userid:String(this.currentUser.id),username:this.currentUser.name,data:this.changeData||"",style:null},this._changes[r.id]=r,this._lastChange=r,this._triggerChange({isText:!1})),i=r.id,this._updateChangeTime(r),t.nodes&&$.each(t.nodes,function(o,a){if(a&&a.nodeType===Node.ELEMENT_NODE&&a!==n.rootElement){n._addNodeToChange(i,a,t.type);var l=n._isOpaqueNode(a);if(t.containerOnly||l){e.domUtils.isBlockElement(a);if(a.className+=" "+s,t.trackChildren&&a.childNodes.length&&!l)for(var d=a,h=[].slice.call(d.childNodes,0),c=t.ignoredNodes,u=void 0,p=0,f=h.length;p<f;++p){if(u=h[p],c&&c.indexOf(u)>=0)return;(u.nodeType!==Node.TEXT_NODE||t.containerOnly)&&n._createTrackedNode({type:t.type,node:u,changeId:r.id,ignoredNodes:c,refNode:null,containerOnly:u.nodeType!==Node.TEXT_NODE,trackChildren:t.trackChildren})}}}}),r},C.prototype._getCurrentChange=function(){var e=this._lastChange;return e&&this._user?this._user&&e.sessionId===this._sessionId&&e.userid===this._user.id?Date.now()-e.lastTime<=this._params.changeGroupTime?e:null:void 0:null},C.prototype._addNodeToChange=function(e,t,n){var i,r=this.getChange(e),o=this.attributes,s=$(t),a=this._getTrackedNodeClass(n),l=((i={})[o.changeId]=e,i[o.userName]=r.username,i[o.userId]=this._user&&this._user.id||"0",i[o.lite2Marked]=1,i[o.changeData]=String(r.data||""),i[o.time]=r.time,i[o.lastTime]=r.lastTime,i[o.sessionId]=r.sessionId||null,i);r.style||(r.style=this._getUserStyle(r.userid)),s.attr(l).addClass(r.style).addClass(a),this._updateNodeTooltip(t)},C.prototype._getUserStyle=function(e){if(null===e||""===e||void 0===e)return this._params.stylePrefix;return this._userStyles[e]?this._userStyles[e]:this._setUserStyle(e,this._getNewStyleId())},C.prototype._setUserStyle=function(e,t){var n=this._params.stylePrefix+"-"+t;return this._styleMap[t]||(this._styleMap[t]=!0),this._userStyles[e]=n},C.prototype._getNewStyleId=function(){var e=++this._uniqueStyleIndex;return this._styleMap[e]?this._getNewStyleId():(this._styleMap[e]=!0,e)},C.prototype._getChangeTypeFromAlias=function(e){var t,n=null;for(t in this.changeTypes)this.changeTypes.hasOwnProperty(t)&&this.changeTypes[t].alias==e&&(n=t);return n},C.prototype._isCurrentUserNode=function(e){var t=e&&e.nodeType===Node.ELEMENT_NODE&&e;return Boolean(t&&t.getAttribute(this.attributes.userId)===String(this.currentUser.id))},C.prototype._isCurrentSessionNode=function(e){var t=e&&e.nodeType===Node.ELEMENT_NODE&&e,n=t&&t.getAttribute(this.attributes.userId)===this.currentUser.id;n&&this.sessionId&&(n=t.getAttribute(this.attributes.sessionId)===this.sessionId);return Boolean(n)},C.prototype._cleanupAroundNode=function(t,n){for(var i,r=t.parentNode,o=t.nextSibling,s=!1;o;)$(o).is(this._lite2Selector)&&e.domUtils.hasNoTextOrStubContent(o)||e.domUtils.isEmptyTextNode(o)?(s=!0,i=o,o=o.nextSibling,r.removeChild(i)):o=o.nextSibling;for(o=t.previousSibling;o;)$(o).is(this._lite2Selector)&&e.domUtils.hasNoTextOrStubContent(o)||e.domUtils.isEmptyTextNode(o)?(i=o,s=!0,o=o.previousSibling,r.removeChild(i)):o=o.previousSibling;return n&&e.domUtils.isEmptyTextNode(t)&&(s=!0,r.removeChild(t)),s},C.prototype._getWrappingTrackedNode=function(e,t){var n=$(e);if(n.is(t))return e;t.indexOf(d)<0&&(t=t.split(",").map(function(e){return e+d}).join(","));return n.parents(t)[0]||null},C.prototype._updateChangeTime=function(e){var t=(new Date).getTime(),n=this._$element.find("["+this.attributes.changeId+"="+e.id+"]"),i=this.attributes.lastTime;e.lastTime=t,n.each(function(e,n){n.setAttribute(i,String(t))})},C.prototype._getCurrentRange=function(t){void 0===t&&(t=!1);try{var n;if(t||!this._selection){var i=this.hostMethods.getHostNativeRange(),r=i&&new e.rangy.WrappedRange(i);return r&&this._selection&&this._selection.addRange(r),r}return(n=this._selection.getRangeAt(0))&&e.domUtils.isRangeInElement(n,this.rootElement)?n:this._getCurrentRange(!0)}catch(t){return e.Logger.error(t,"While trying to get current range"),null}},C.prototype._deleteContents=function(e,t){var n,i=!0;if(this.hostMethods.beforeDelete&&this.hostMethods.beforeDelete(),t?this._selection.addRange(t):t=this._getCurrentRange(!0),!t)return!1;n=this._startBatchChange();try{t.collapsed?i=this._deleteAtCaret(e,t):(this._deleteSelectionNew(t,e),t=this._getCurrentRange(!0))}finally{this._endBatchChange(n,i)}return i},C.prototype._deleteAtCaret=function(t,n){var i=this.setIgnoreMutations(!0),r=!0;try{if(n=this._cleanupSelection(n,!0),t)r=this._deleteForward(n),this.isNodeVisible(n.endContainer)||$(n.endContainer.parentNode).is(this._lite2Selector)&&this._selection.collapseAfter(n.endContainer.parentNode);else{if(!this.isNodeVisible(n.startContainer)&&n.endOffset===e.domUtils.getNodeCharacterLength(n.endContainer)){var o=n.startContainer.previousSibling,s=$(o);if(s.is(this._deleteSelector))for(;o;){if(!s.is(this._deleteSelector)){n.setEndBefore(o.nextSibling),n.collapse(!1);break}o=o.previousSibling,s=$(o)}}r=this._deleteBack(n)}}finally{this.setIgnoreMutations(i)}return r},C.prototype._deleteSelectionNew=function(t,n){var i,r=new e.DOMMarker(this._host,this._selection,t),o=this.rootElement,s=t.getNodes(["1","3"],function(e){return e!==o}),a=this.setIgnoreMutations(!0),l=this._startBatchChange();try{for(var d=0;d<s.length;d++)i=s[d],this._markNodeAsDeleted(i,l)}finally{r.collapseAndRemove(this._selection,!n),this.setIgnoreMutations(a)}return t},C.prototype._markNodeAsDeleted=function(e,t){if(e&&e.parentNode&&!this._shouldIgnoreNode(e)){var n=this._getNodeTrackingContext(e),i=3===e.nodeType,r=!i&&this._isOpaqueNode(e),o={changeId:t,ignoreAdjacentTracking:!0,containerOnly:!i&&!r,trackingContext:n,trackContent:!1};if(n.isTracking){if(n.isDelete)return;n.isCurrent?this._removeNode(e):this._addDeleteTracking(e,o)}else this._addDeleteTracking(e,o)}},C.prototype._startBatchChange=function(){if(!this._batchChangeId){var e=this._getCurrentChange();this._batchChangeId=e&&e.id||this.getNewChangeId()}return this._batchChangeId},C.prototype._endBatchChange=function(e,t){e&&e===this._batchChangeId&&(this._batchChangeId=null,t&&this._triggerChange({isText:!0}))},C.prototype._cleanupElementSelection=function(t){var n,i=t.startContainer,r=i.childNodes.length,o=!1,s=!1;if(r<1)return e.domUtils.isBlockElement(i)||e.domUtils.isStubElement(i)||(t.setStartBefore(i),t.collapse(!0),this._removeNode(i),o=!0),o;try{if(t.startOffset>0?n=i.childNodes[t.startOffset-1]:(n=i.firstChild,s=!0),!n)return!1}catch(e){return!1}if(this._cleanupAroundNode(n,s))return this._cleanupElementSelection(this._getCurrentRange(!0));if(0===t.startOffset)return!1;var a=e.domUtils.getNodeIndex(n)+1;return e.domUtils.isEmptyTextNode(n)&&(a=Math.max(0,a-1),i.removeChild(n),o=!0),i.childNodes.length!==r&&(t.setStart(i,a),t.setEnd(i,a),o=!0),o},C.prototype._removeNode=function(e){var t=e&&e.parentNode;t&&t.removeChild(e)},C.prototype._cleanupSelection=function(e,t){var n;return e&&e.collapsed&&(n=e.startContainer)&&(n.nodeType===Node.TEXT_NODE?this._cleanupTextSelection(n,t):this._cleanupElementSelection(e))?this._getCurrentRange(!0):e},C.prototype._cleanupTextSelection=function(t,n){var i=this._cleanupAroundNode(t,!1);if(e.domUtils.removeEmptyCharsFromTextNode(t)&&(i=!0),n&&e.domUtils.isEmptyTextNode(t)){e.domUtils.isEmptyTextNode(t);var r=t.parentNode,o=e.domUtils.getNodeIndex(t);r.removeChild(t),o=Math.max(0,o),this._selection.setStart(r,!0,o),i=!0}return i},C.prototype._deleteForward=function(e){var t=this._findNextNodeToDelete(e);if(!t)return!1;if("BR"===t.tagName)return this._lastMutationContext.setContext("delete-br",t.node),!1;var n=this._getNodeAtCaret(e,!0),i=this._getNodeTrackingContext(n.node),r=t.node===n.node?i:this._getNodeTrackingContext(t.node);return i.isTracking||r.isTracking?i.isTracking&&!r.isTracking?i.isDelete&&i.isCurrent?this._assimilateNextChar(i,null,n,t):this._deleteForwardUntrackedContext(t,e):i.isTracking&&r.isTracking?r.isDelete?(this._selection.collapseAfter(r.trackingNode),!0):r.isCurrent?(t.isText||this.ignoreNextMutation(),!1):i.isDelete&&i.isCurrent?this._assimilateNextChar(i,r,n,t):this._deleteForwardUntrackedContext(t,e,r):r.isInsert?r.isCurrent?(t.isText||this.ignoreNextMutation(),!1):this._deleteForwardUntrackedContext(t,e,r):(this._selection.collapseAfter(r.trackingNode),!0):this._deleteForwardUntrackedContext(t,e)},C.prototype._deleteBack=function(t){var n=this._findPreviousNodeToDelete(t);if(e.Logger.log("delete back, previousChar is",e.utils.printNode(n&&n.node),"range is",e.utils.printRange(t)),!n||"BR"===n.tagName)return!1;var i=this._getNodeAtCaret(t),r=this._getNodeTrackingContext(i.node),o=n.node===i.node?r:this._getNodeTrackingContext(n.node);return r.isTracking||o.isTracking?r.isTracking&&!o.isTracking?r.isDelete&&r.isCurrent?this._assimilatePrevChar(r,null,i,n):this._deleteBackUntrackedContext(n,t):r.isTracking&&o.isTracking?o.isDelete?(this._selection.collapseBefore(o.trackingNode,this._isDeletableNoSelfOptions),!0):o.isCurrent?(n.isText||this.ignoreNextMutation(),!1):r.isDelete&&r.isCurrent?this._assimilatePrevChar(r,o,i,n):this._deleteBackUntrackedContext(n,t,o):o.isInsert?o.isCurrent?(n.isText||this.ignoreNextMutation(),!1):this._deleteBackUntrackedContext(n,t,o):(this._selection.collapseBefore(o.trackingNode,this._isDeletableNoSelfOptions),!0):this._deleteBackUntrackedContext(n,t)},C.prototype._assimilatePrevChar=function(t,n,i,o){if(o.isText){var s=o.node,a=i.offset,d=i.node,h=e.domUtils.splitTextAt(s,o.offset,1,!0);if(!h||!d)return!1;var c=d.nodeType===Node.TEXT_NODE&&(d.previousSibling===h||d.parentNode.previousSibling===h);if(c){var u=d;u.data=u.data.substr(0,a-1)+h.data+u.data.substr(a),h.parentNode.removeChild(h),this._selection.setStart(u,!0,a)}else{if(!c||e.domUtils.matchesSelector(d,l)){if(n&&n.trackingNode){this._splitNode(n.trackingNode,h,0);var p=$(n.trackingNode);if(!(h=e.domUtils.getFirstSelectableChild(n.trackingNode,{root:this.rootElement,allowEmptyText:!1})))return!1;this._replaceNodeWithContent(p)}this._addDeleteTracking(h,{move:r.Left,containerOnly:!1,changeId:t.changeId,ignoreAdjacentTracking:!0})}else e.domUtils.insertNodeAt(h,d,0);this._selection.setStart(h,!0,0)}}else this._addDeleteTracking(o.node,{move:r.None,containerOnly:!0,changeId:t.changeId,ignoreAdjacentTracking:!0}),this._selection.collapseBefore(o.node,this._isDeletableNoSelfOptions);return!0},C.prototype._assimilateNextChar=function(t,n,i,o){var s=o.node;if(s.nodeType===Node.ELEMENT_NODE)return this._markElementAsDeleted(s,t.changeId),this._collapseOnEdgeOf(s,!0,o.isCurrent),!0;var a=o.node,d=i.node,h=e.domUtils.splitTextAt(a,o.offset,1,!0);if(!h)return!1;var c=d.nodeType===Node.TEXT_NODE&&d.nextSibling===h||d.parentNode.nextSibling===h;if(c){var u=d;u.data+=h.data,h.parentNode.removeChild(h),this._selection.setEnd(u,!0,u.length)}else{if(!c||e.domUtils.matchesSelector(d,l)){if(n&&n.trackingNode){var p=this._splitNode(n.trackingNode,h,1),f=$(p);if(!(h=e.domUtils.getFirstSelectableChild(p,{root:this.rootElement,allowEmptyText:!1})))return!1;this._replaceNodeWithContent(f)}this._addDeleteTracking(h,{move:r.Left,containerOnly:!1,changeId:t.changeId,ignoreAdjacentTracking:!0})}else d.appendChild(h);this._selection.setEnd(h,!0,1)}return!0},C.prototype._markElementAsDeleted=function(e,t){var n={merge:!1,ignoreAdjacentTracking:!0,changeId:t,containerOnly:!0,trackContent:!1};if(this._addDeleteTracking(e,n),"BR"===e.nodeName){var i=this.hostMethods.getNewLineNodeName(),r=e.parentNode;if(i&&e.parentNode.nodeName===i&&e===r.lastChild&&r.nextSibling&&r.nextSibling.nodeName===i&&r.nextSibling.hasChildNodes)return this._addDeleteTracking(r.nextSibling,n),void this._selection.setStart(r.nextSibling.firstChild,!0,0)}},C.prototype._deleteBackUntrackedContext=function(t,n,i){if(!t.isText)return this._markElementAsDeleted(t.node,null),this._collapseOnEdgeOf(t.node,!1,t.isCurrent),!0;var o;if(i){var s=this._splitNode(i.trackingNode,t.node,t.offset),a=e.domUtils.getLastSelectableChild(i.trackingNode);o=a&&e.domUtils.splitTextAt(a,a.length-1,1,!0),s.parentNode.insertBefore(o,s.nextSibling),e.domUtils.hasNoTextOrStubContent(i.trackingNode)&&$(i.trackingNode).remove()}else o=e.domUtils.splitTextAt(t.node,t.offset,1,!0);return!!o&&(this._addDeleteTracking(o,{range:n,move:r.Left,merge:!0,ignoreAdjacentTracking:!0}),!0)},C.prototype._deleteForwardUntrackedContext=function(t,n,i){if(!t.isText)return this._markElementAsDeleted(t.node,null),this._collapseOnEdgeOf(t.node,!0,t.isCurrent),!0;var o;if(i){var s=this._splitNode(i.trackingNode,t.node,t.offset),a=e.domUtils.getFirstSelectableChild(i.trackingNode);o=a&&e.domUtils.splitTextAt(a,0,1,!0),s.parentNode.insertBefore(o,s.nextSibling),e.domUtils.hasNoTextOrStubContent(i.trackingNode)&&$(i.trackingNode).remove()}else o=e.domUtils.splitTextAt(t.node,t.offset,1,!0);return!!o&&(this._addDeleteTracking(o,{ignoreAdjacentTracking:!0,range:n,move:r.None,merge:!0}),this._selection.setEnd(o,!0,1),!0)},C.prototype._isNodeOfChangeType=function(e,t){if(!e)return!1;var n="."+this._getTrackedNodeClass(t);return $(e.$||e).is(n)},C.prototype._isInsertNode=function(e){return this._isNodeOfChangeType(e,n)},C.prototype._isDeleteNode=function(e){return this._isNodeOfChangeType(e,o)},C.prototype.getAdjacentChangeId=function(t,n){var i,o=n===r.Left?e.domUtils.getNextNode(t,this.rootElement):e.domUtils.getPrevNode(t,this.rootElement),s=null;return(i=this._getWrappingTrackedNode(o,this._lite2Selector))||(this._isInsertNode(o)||this._isDeleteNode(o))&&(i=o),i&&this._isCurrentSessionNode(i)&&(s=i.getAttribute(this.attributes.changeId)),s},C.prototype._getVoidElement=function(t){if(!t)return null;var n=t.node,i=!1!==t.checkEmpty;try{var r=this._getWrappingTrackedNode(n,this._deleteSelector);return!r&&Node.TEXT_NODE===n.nodeType&&i&&"​"==n.nodeValue?n:r}catch(t){return e.Logger.error(t,"While trying to get void element of",n),null}},C.prototype._addDeleteTracking=function(t,n){if(n=n||{},t){var i,s=t.nodeType===Node.TEXT_NODE,a=n.range,l=!1;if(!n.ignoreAdjacentTracking){var d=n.trackingContext||this._getNodeTrackingContext(t);if(d.isInsert)return this._addDeletionInInsertNode(t,d,n);if(d.isDelete&&d.isCurrent)return void this._moveCaret(a,n&&n.move);if(a&&d.isDelete)return this._deleteInDeleted(t,n)}if(t.previousSibling&&e.domUtils.isEmptyTextNode(t.previousSibling)&&t.parentNode.removeChild(t.previousSibling),t.nextSibling&&e.domUtils.isEmptyTextNode(t.nextSibling)&&t.parentNode.removeChild(t.nextSibling),s){var h=this._getNodeTrackingContext(t.previousSibling),c=this._getNodeTrackingContext(t.nextSibling);if(l=!0,h.isDelete&&h.isTextSpan&&h.isCurrent){if((i=h.trackingNode).appendChild(t),c.isDelete&&c.isTextSpan&&c.isCurrent){var u=e.domUtils.extractContent(c.trackingNode);i.appendChild(u),c.trackingNode.parentNode.removeChild(c.trackingNode)}}else c.isDelete&&c.isTextSpan&&c.isCurrent?(i=c.trackingNode).insertBefore(t,i.firstChild):l=!1}if(!l){var p=n.changeId||s&&!n.ignoreAdjacentTracking&&this.getAdjacentChangeId(t,n&&n.move);i=this._createTrackedNode({type:o,node:t,changeId:p,refNode:null,containerOnly:n.containerOnly,trackChildren:"boolean"==typeof n.trackContent&&n.trackContent})}return a&&(e.domUtils.isStubElement(t)?a.selectNode(t):a.selectNodeContents(t),a.collapse(n.move==r.Left),this._selection.addRange(a)),i&&(setTimeout(function(){return e.domUtils.normalizeNode(i)},0),a&&a.refresh()),!0}},C.prototype._addDeletionInInsertNode=function(t,n,i){var s=i.range;if(n.isCurrent){if(s){var a=i.move===r.Left;a?s.setStartBefore(t):s.setStartAfter(t),s.collapse(a)}t.parentNode.removeChild(t),e.domUtils.normalizeNode(n.trackingNode);var l=$(n.trackingNode),d=void 0;l.find(".liteBookmark").length>0?((d=l.clone()).find(".liteBookmark").remove(),d=d[0]):d=n.trackingNode,e.domUtils.hasNoTextOrStubContent(d)&&(s&&(s.setStartBefore(n.trackingNode),s.collapse(!0)),this._replaceNodeWithContent($(n.trackingNode)))}else{var h,c=e.domUtils.getNodeIndex(t),u=t.parentNode,p=t===n.trackingNode,f=u.childNodes.length;if(p||u.removeChild(t),h=this._createTrackedNode({type:o,node:t,changeId:null,refNode:null,containerOnly:!1,trackChildren:!1}),!p){if(c>0&&c>=f-1)e.domUtils.insertAfter(h,n.trackingNode);else{if(c>0){var g=this._splitNode(n.trackingNode,u,c);this._deleteEmptyNode(g)}n.trackingNode.parentNode.insertBefore(h,n.trackingNode)}this._deleteEmptyNode(n.trackingNode)}s&&i.move==r.Left&&this._selection.collapseBefore(h,this._isDeletableNoSelfOptions),i&&i.merge&&this._mergeDeleteNode(h),s&&s.refresh()}return!0},C.prototype._splitAtCaret=function(t){if(!t||!t.collapsed)return t;var n=t.startContainer,i=t.cloneRange(),r=t.startOffset;if(n.nodeType===Node.TEXT_NODE){var o=n;if(r>=o.length)return t;var s=e.domUtils.splitTextAt(o,r,o.length-r,!0);return i.setStart(s.parentNode,e.domUtils.getNodeIndex(s)+1),i.collapse(!0),i}var a=n;if(r>=a.childNodes.length)i.setStartAfter(a),i.collapse(!0);else{s=this._splitNode(a,a,r);i.setStart(s,0)}return i},C.prototype._splitNode=function(t,n,i){var r,o=t.parentNode,s=e.domUtils.getNodeIndex(t),a=n.ownerDocument.createRange();return a.setStart(o,s),a.setEnd(n,i),r=a.extractContents(),o.insertBefore(r,t),this.isInsideChange(t,!0)&&this._updateNodeTooltip(t.previousSibling),t.previousSibling},C.prototype._deleteEmptyNode=function(t){var n=t&&t.parentNode;n&&e.domUtils.hasNoTextOrStubContent(t)&&n.removeChild(t)},C.prototype._handleVoidEl=function(e,t){var n=e&&this._getVoidElement({node:e,checkEmpty:!1});return!(!n||this._getWrappingTrackedNode(n,this._deleteSelector))&&(t.collapse(!0),!0)},C.prototype._deleteInDeleted=function(t,n){var i=n.range,o=n.move===r.Left,s=!1;if(e.domUtils.normalizeNode(t),o){for(var a=e.domUtils.getPrevContentNode(t,this.rootElement);!s;)this._getWrappingTrackedNode(a,this._deleteSelector)?a=e.domUtils.getPrevContentNode(a,this.rootElement):s=!0;if(a){var l=e.domUtils.getLastSelectableChild(a);l&&(a=l),i.setStart(a,e.domUtils.getNodeCharacterLength(a)),i.collapse(!0)}}else{for(var d=e.domUtils.getNextContentNode(t,this.rootElement);!s;)this._getWrappingTrackedNode(d,this._deleteSelector)?d=e.domUtils.getNextContentNode(d,this.rootElement):s=!0;d&&this._selection.collapseAtStart(d)}return!0},C.prototype._mergeDeleteNode=function(t){var n,i;this._isCurrentSessionNode(n=this._getWrappingTrackedNode(t.previousSibling,this._deleteSelector))?(i=e.domUtils.extractContent(t),t.parentNode.removeChild(t),n.appendChild(i),this._mergeDeleteNode(n)):this._isCurrentSessionNode(n=this._getWrappingTrackedNode(t.nextSibling,this._deleteSelector))&&(i=e.domUtils.extractContent(n),t.parentNode.removeChild(n),t.appendChild(i),this._mergeDeleteNode(t))},C.prototype._showTitles=function(e){var t=this,n=this.getTrackedNodes();e?$(n).each(function(e,n){t._updateNodeTooltip(n)}):$(n).removeAttr("title")},C.prototype._handleSpecialKey=function(e){var t=!1;switch(e){case 8:t=this._deleteContents(!1,null);break;case 46:t=this._deleteContents(!0,null)}return t},C.prototype._keyPress=function(t){var n=null;if(t.ctrlKey||t.metaKey)return!1;var i=t.keyCode||t.which;switch(i){case 32:return this._insertText(" ");case 8:case 46:return this._handleSpecialKey(i);case 13:return this._handleEnter();default:if(function(e){if(!e)return!0;var t,n,i=v.length;for(t=0;t<i;++t)if(e>=(n=v[t]).start&&e<=n.end)return!0;return!1}(i))return!1;if(n=t.char||String.fromCharCode(i)){var r=e.utils.browser.msie?n:null;return this._insertText(r)}return!1}},C.prototype._handleEnter=function(){var e=this._getCurrentRange(!0);if(e){if(this._lastMutationContext.setContext("enter"),e.collapsed){if(this._isOnRightEdge(e.startContainer,e.endOffset)){var t=this.currentChangeNode(e.endContainer,!1);t&&"span"===(t.nodeName||"").toLowerCase()&&this._selection.collapseAfter(t)}}else this._deleteContents(!1,null);return!1}},C.prototype._handleEditKey=function(e){switch(e.which||e.keyCode){case 120:case 88:if(!0===e.ctrlKey||!0===e.metaKey)return this.prepareToCut(),!0;break;case 67:case 99:if(!0===e.ctrlKey||!0===e.metaKey)return this.prepareToCopy(),!0}return!1},C.prototype._insertText=function(t){this.hostMethods.beforeInsert&&this.hostMethods.beforeInsert();var n=this._getCurrentRange(!0),i=this._startBatchChange(),r=this.setIgnoreMutations(!0),o=Boolean(n&&!n.collapsed),s=!1;try{o&&(this._deleteContents(!1,n),n=this._getCurrentRange()),n&&(this._moveRangeToValidTrackingPos(n),s=this._doInsertText(t,n))}catch(t){e.Logger.error(t,"while trying to insert nodes")}finally{this.setIgnoreMutations(r),this._endBatchChange(i,Boolean(t||s))}return s},C.prototype._doInsertText=function(e,t){var i=t.startContainer,r=this._host.document,o=!1,s=null,a=this._getNodeTrackingContext(i);if(a.isInsert&&a.isCurrent)if(a.tracksContent)this._prepareSelectionForInsert(null,t,r,!0);else{var l=this._createTrackedNode({type:n,node:null,changeId:null,refNode:null,containerOnly:!1,trackChildren:!1});t.insertNode(l),this._prepareSelectionForInsert(l,t,r,!0)}else{l=this._createTrackedNode({type:n,node:null,changeId:null,refNode:null,containerOnly:!1,trackChildren:!1});if(a.isTracking&&a.tracksContent){if(3===i.nodeType){var d=this._splitNode(a.trackingNode,i,t.startOffset);s=a.trackingNode,this._selection.collapseAfter(d)}else(s=i.childNodes&&i.childNodes[t.startOffset]||i)!==i?this._splitNode(i,i,t.startOffset):this._selection.collapseBefore(i),s=i,this._selection.collapseBefore(s);t=this._selection.getRangeAt(0)}if(s?s.parentNode.insertBefore(l,s):t.insertNode(l),e){o=!0;var h=r.createTextNode(e);l.appendChild(h),this._selection.collapseAtEnd(h)}else this._prepareSelectionForInsert(l,t,r,!0)}return o},C.prototype._prepareSelectionForInsert=function(e,t,n,i){if(i){var r=e||t.startContainer;if(t.collapsed&&r&&r.nodeType===Node.TEXT_NODE&&r.length)return;var o=n.createTextNode("\ufeff");e?e.appendChild(o):t.insertNode(o),t.selectNode(o),this._selection.addRange(t)}else e&&(t.selectNodeContents(e),this._selection.addRange(t))},C.prototype._handleKeyDown=function(e){return!!this._handleEditKey(e)||!this._keyPress(e)},C.prototype._moveRangeToValidTrackingPos=function(e){if(e)for(var t=!1;!t;)return void e.startContainer},C.prototype._isOnRightEdge=function(e,t){if(!e)return!1;var n=e.nodeType;return Node.TEXT_NODE==n?t&&e.nodeValue&&t>=e.nodeValue.length-1:Node.ELEMENT_NODE==n&&(e.childNodes&&e.childNodes.length&&t>=e.childNodes.length)},C.prototype._restoreAndMarkDeletedNode=function(t,n,i){if(!t||t.nodeType===Node.TEXT_NODE&&e.domUtils.isEmptyTextNode(t))return!1;i&&i.parentNode!==n&&(i=null);var r=this._isOpaqueNode(t),o=t.nodeType===Node.ELEMENT_NODE&&"SPAN"===t.nodeName;if(!r&&o&&t.firstChild){for(var s=!0,a=t.firstChild;a&&s;a=a.nextSibling)a.nodeType===Node.TEXT_NODE&&e.domUtils.isEmptyTextNode(a)||(s=!1);if(s)return!1}var l=this._getNodeTrackingContext(t);return(!l.isInsert||!l.isCurrent)&&(e.domUtils.insertAfter(t,i,n),i?i.nextSibling?n.insertBefore(t,i?i.nextSibling:n.firstChild):n.appendChild(t):n.insertBefore(t,n.firstChild),this._addDeleteTracking(t,{containerOnly:r||!o,trackContent:!r&&!o,trackingContext:l}),!0)},C.prototype._onDomMutation=function(e){if(!this._ignoreMutations)for(var t,n,i,r=e&&e.length||0,o=this._params.trackedDeleteSelectors||"",s=this._params.ignoredDeleteSelectors||"",a=o.length,l=(s.length,0);l<r;++l)if(!(t=e[l]).target&&(i=t.removedNodes))for(var d=i.length,h=0;h<d;++h){n=$(i[h]);for(var c=0;c<a;++c)n.is(o[c])}},C.prototype._onMutationSummary=function(t){var n=this,i=this.rootElement&&this.rootElement.ownerDocument;if(i&&!this._summaryGuard.shouldIgnore(t)){var r,o,s,a,l,d,h=this._getCurrentRange(!0),c=!1,u=this._startBatchChange(),p=[];try{switch(this._lastMutationContext.type){case"insert-list":if(this._handleInsertedList(t))return h=null,void(c=!0);break;case"remove-list":return this._loadFromDom(),void(h=null);case"enter":if(this._handleEnterMutation(t))return void(c=!0);break;case"delete-br":if(this._handleDeleteBreak(t))return h=null,void(c=!0)}for(var f=0,g=t.length;f<g;++f){var m=void 0;if((a=(r=t[f]).added||[]).forEach(function(e){n._isValidFLITENode(e)||n.removeFLITETracking(e)}),l=this._restoreDeletedHierarchy(r.removed,r),a=this._restoreAddedHierarchy(a),!this._handleIdenticalChanges(a,l))if(this._restoreList(r)||this._processNewParagraph(r)||this._processDeletedLastLI(r)||this._processNewList(r)||this._processAddedListItem(r)||this._processAddedBreakDiv(r))c=!0;else{d=r.reparented||[];for(var v=0,_=l.length;v<_;++v)o=l[v],this._shouldRestoreNode(o,r.getOldParentNode(o))&&(e.domUtils.isAncestorAmong(p,o)?p.push(o):(s=r.getOldParentNode(o))&&s.ownerDocument===i&&this._restoreAndMarkDeletedNode(o,s,r.getOldPreviousSibling(o))&&(c=!0,p.push(o),d.length&&o.nodeType===Node.ELEMENT_NODE&&(m=o.querySelectorAll("*"))&&m.length&&(p=p.concat([].slice.apply(m)))));for(var y=0,N=(d=this._restoreDeletedHierarchy(d,r)).length;y<N;++y)o=d[y],(s=r.getOldParentNode(o))&&p.indexOf(s)>=0&&(this._restoreIntoLI(o,s,r.getOldPreviousSibling(o))||e.domUtils.insertAfter(o,r.getOldPreviousSibling(o),s),c=!0);p.forEach(function(e){n._removeHostArtifacts(e)});for(var C=0,T=a.length;C<T;++C)c=this._tryToTrackAddedNode(a[C],r.reparented)||c;var b=r.getCharacterDataChanged();b&&b.length}}}catch(t){e.Logger.error("While analyzing mutation summary",t)}finally{this._endBatchChange(u,!1),h&&h.collapsed&&e.rangy.dom.isAncestorOf(this.rootElement,h.startContainer,!0)&&this._selection.addRange(h),p&&p.length&&e.utils.createBackspaceGuard(this.rootElement,function(e){n._cleanupSelection(n._getCurrentRange(!0),!0),e.backspace?n._selection.nudgeLeft(null,n._isDeletableOptions):e.del&&n._selection.nudgeRight(null,n._isDeletableOptions)}),c&&this.hostMethods.updateLastUndo()}}},C.prototype._handleDeleteBreak=function(t){if(1!==t.length)return!1;var n=t[0],i=n.removed[0],r=this.rootElement&&this.rootElement.ownerDocument;if(i&&"BR"===i.nodeName){var o=n.getOldParentNode(i);if(o&&o.ownerDocument===r&&this._restoreAndMarkDeletedNode(i,o,n.getOldPreviousSibling(i))){var s=e.domUtils.getNextSelectableNode(i,this._isDeletableNoSelfOptions);return s&&this._selection.collapseAtStart(s),!0}}return!1},C.prototype._handleInsertedList=function(e){if(1!==e.length)return!1;for(var t,n,i=e[0],r=i.reparented||[],o=i.added,s=o.concat(r),a=!1,l=0,d=o.length;l<d;++l)(t=o[l]).nodeName in p&&(a=this._tryToTrackAddedNode(o[l],s)||a,"LI"!==t.nodeName&&(n=t));if(a&&n)for(l=0,d=r.length;l<d;++l)"LI"===(t=r[l]).nodeName&&t.parentNode===n&&this._tryToTrackAddedNode(r[l],s);return a},C.prototype._handleEnterMutation=function(e){if(1!==e.length)return!1;var t=e[0],n=this.hostMethods.getNewLineNodeName();if(!n)return!1;for(var i,r=t.added,o=r.concat(t.reparented||[]),s=!1,a=r.length-1;a>=0;--a)(i=r[a]).nodeName===n&&(s=!0,this._tryToTrackAddedNode(i,o));return s},C.prototype._handleIdenticalChanges=function(t,n){var i,r,o=t.length,s=n.length,a=o-s;if(a<-1||a>1)return!1;o>s?(i=t.slice(),r=n.slice()):(i=n,r=t);for(var l,d,h,c=null,u=[],p=0;p<i.length;++p){l=i[p],h=!1;for(var f=0;f<r.length&&!h;++f)d=r[f],3===l.nodeType?3===d.nodeType&&l.data===d.data&&(h=!0):1===l.nodeType&&1===d.nodeType&&d.nodeName===l.nodeName&&l.innerHTML===d.innerHTML&&(h=!0),h&&(u.push({n1:l,n2:d}),r.splice(f,1));if(!h){if(e.domUtils.getNodeCharacterLength(l)||c)return!1;c=l}}return u.forEach(function(e){e.n1.parentNode&&!e.n2.parentNode?e.n1.parentNode.replaceChild(e.n2,e.n1):e.n2.parentNode&&!e.n1.parentNode&&e.n2.parentNode.replaceChild(e.n1,e.n2)}),u.length>0},C.prototype._restoreIntoLI=function(t,n,i){if("LI"!==n.nodeName)return!1;if(i&&i.parentNode===n)return e.domUtils.insertAfter(t,i,n),!0;for(var r=n.firstChild;r;r=r.nextSibling)if("BR"===r.nodeName)return n.insertBefore(t,r),!0;return n.appendChild(t),!0},C.prototype._shouldRestoreNode=function(t,n){if(t.nodeType!==Node.ELEMENT_NODE)return!0;var i=e.domUtils.matchesSelector(t,this._insertSelector)?t:this._getWrappingTrackedNode(n,this._insertSelector);return!this._isCurrentSessionNode(i)},C.prototype._tryToTrackAddedNode=function(t,i){if(!this._isTrackable(t,this._params.ignoredSelectors))return!1;var r=this._getNodeTrackingContext(t);if(r.isTracking){if(!r.isInsert||r.isCurrent)return!1;this._createTrackedNode({type:n,node:t,changeId:null,ignoredNodes:i,refNode:null,containerOnly:!1,trackChildren:!1})}else this._createTrackedNode({type:n,node:t,changeId:null,refNode:null,containerOnly:e.domUtils.isBlockElement(t),trackChildren:!0,ignoredNodes:i});return!0},C.prototype._restoreAddedHierarchy=function(t){var n,i,r;if(!t||(n=t.length)<2)return t;for(var o=[],s=[],a=0;a<n;++a)(r=t[a]).nodeType===Node.TEXT_NODE&&e.domUtils.isEmptyString(r.nodeValue)||(i=r.parentNode)&&t.indexOf(i)<0&&(r.nodeType===Node.ELEMENT_NODE&&r.getAttribute("data-flite-inserting")?s.push(r):o.push(r));return s.length?s:o},C.prototype._restoreDeletedHierarchy=function(e,t){if(!e||!e.length)return[];e=e.slice();for(var n,i,r,o,s,a=function(t){for(var n=e.length-1;n>=0;--n)if(e[n]===t)return n;return-1},l=0;l<e.length;++l)n=e[l],(i=t.getOldParentNode(n))&&(i!==n.parentNode?(o=a(i))>=0&&o>l&&(e.splice(o,1),e.splice(l,0,i),--l):(e.splice(l,1),l--));for(l=0;l<e.length;++l)n=e[l],(r=t.getOldPreviousSibling(n))&&(s=a(r))>l&&(e.splice(s,1),e.splice(l,0,r),--l);var d=function(e,n){if(!(n>=e.length-1)){var i,r,o=e[n];if(o.nodeType!==Node.ELEMENT_NODE)return d(e,n+1);for(var s=n+1;s<e.length;++s)i=e[s],t.getOldParentNode(i)===o&&(d(e,n+1),r=t.getOldPreviousSibling(i),o.insertBefore(i,r&&r.nextSibling),e.splice(s,1),s--)}};return d(e,0),e},C.prototype._createMutationObservers=function(t){var n=this;if(this._mutationSummary)t&&this._mutationSummary.reconnect();else{var i={callback:this._onMutationSummary.bind(this),rootNode:this.rootElement,oldPreviousSibling:!0,observeOwnChanges:!1,mutationFilter:this._filterMutations.bind(this),nodeFilter:function(e){return!n._shouldIgnoreNode(e)},queries:[]};this._params.trackedDeleteSelectors&&i.queries.push({element:this._params.trackedDeleteSelectors,classAttribute:!1}),this._params.trackedInsertSelectors&&i.queries.push({element:this._params.trackedInsertSelectors}),this._mutationSummary=new e.MutationSummary(i,t);this.rootElement}if(this._domObserver||(this._domObserver=new MutationObserver(this._onDomMutation.bind(this))),t);},C.prototype._removeTrackingInRange=function(t){var n=Date.now()%1e6,i="."+this._insertClassName+",."+this._deleteClassName,r={},o="data-ice-class";t.getNodes(null,function(e){var t,s,a=null;if(s=(a=e.nodeType==Node.TEXT_NODE?$(e).parents(i):(t=$(e)).is(i)?t:t.parents(i))&&a[0]){var l=function(e){for(var t,n=e.attributes,i=n&&n.length,r={},o=0;o<i;++o)r[(t=n[o]).name]=t.value;return r}(s),d=s.className,h=String(n++);return r[h]={attributes:l,className:d},function(e){var t,n=null;e.attributes;try{for(;e.attributes.length>0;){if((t=e.attributes[0])===n)return;n=t,e.removeAttribute(t.name)}}catch(e){}}(s),s.setAttribute(o,h),s.setAttribute("class","ice-no-decoration"),!0}return!1});var s=this.rootElement;setTimeout(function(){$(s).find("["+o+"]").each(function(t,n){var i=n.getAttribute(o),s=r[i]||{};i?(delete r[i],Object.keys(s.attributes||{}).forEach(function(e){n.setAttribute(e,s.attributes[e])}),n.setAttribute("class",s.className),n.removeAttribute(o)):e.Logger.warn("missing save data for node")})},10)},C.prototype._isOpaqueNode=function(t){return!(!t||t.nodeType!==Node.ELEMENT_NODE)&&(this._params.opaqueSelectors&&e.domUtils.matchesSelector(t,this._params.opaqueSelectors))},C.prototype._isTrackable=function(t,n){return!!t&&(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.ELEMENT_NODE&&(!n||!e.domUtils.matchesSelector(t,n)))},C.prototype._processAddedListItem=function(t){if(0!==t.removed.length||0!==t.reparented.length||1!==t.added.length)return!1;var i=t.added[0];if("li"!==e.utils.getTagName(i))return!1;var r=this._getNodeTrackingContext(i);if(r.isInsert){if(r.isCurrent)return!0;this._splitNode(i.parentNode,i,0),this._createTrackedNode({type:n,node:i,changeId:null,refNode:null,containerOnly:!0,trackChildren:!1})}else r.isDelete?(this._splitNode(i.parentNode,i,0),this._createTrackedNode({type:n,node:i,changeId:null,refNode:null,containerOnly:!0,trackChildren:!1})):this._createTrackedNode({type:n,node:i,changeId:null,refNode:null,containerOnly:!0,trackChildren:!1});return $(i).addClass(s),!0},C.prototype._processNewList=function(t){var i=t.added,r=t.removed,o=i&&i.length;r&&r.length;if(2!==o)return!1;var s=e.domUtils.findNodeByTagName(i,g),a=s&&e.domUtils.findNodeByTagName(i,m);if(!s)return!1;var l=this._getNodeTrackingContext(s);return!(!l.isInsert||!l.isCurrent)||(this._createTrackedNode({type:n,node:s,changeId:null,refNode:null,containerOnly:!0,trackChildren:!1}),a&&this._createTrackedNode({type:n,node:a,changeId:null,refNode:null,containerOnly:!0,trackChildren:!1}),!0)},C.prototype._processNewParagraph=function(e){var t=e.added,n=this.hostMethods.getNewLineNodeName();if(!n||"BR"===n)return!1;if(2!==t.length)return!1;var i=t[0],r=t[1];if(e.removed&&e.removed.length)return!1;if(i.nodeName!==n||r.nodeName!==n)return!1;for(var o=null,s=e.reparented.length-1;s>=0&&!o;--s)e.reparented[s].parentNode===r?o=i:e.reparented[0].parentNode===i&&(o=r);return o||(o=r.childNodes.length>i.childNodes.length?i:r),this._tryToTrackAddedNode(o,e.reparented),!0},C.prototype._processDeletedLastLI=function(t){var i=t.added&&1===t.added.length&&t.added[0],r=i&&i.nodeName,o=this.hostMethods.getNewLineNodeName(),s=t.removed&&1===t.removed.length&&t.removed[0];if(r!==o||"li"!==e.utils.getTagName(s)||s.firstChild)return!1;var a=this._getNodeTrackingContext(i);if(a.isInsert&&a.isCurrent)return!0;a.isDelete&&this._splitNode(i.parentNode,i,0);var l=this._createTrackedNode({type:n,node:i,changeId:null,refNode:null,containerOnly:!0,trackChildren:!1}),d=e.domUtils.getFirstSelectableChild(l,this._isDeletableOptions);return this._selection.setStart(d||l,!0,0),!0},C.prototype._processAddedBreakDiv=function(t){var n=t.added,i=n&&n.length,r=t.removed&&t.removed.length;if(i<1||0!==r)return!1;var o=n[0];return!("div"!==e.utils.getTagName(o)||!o.childNodes||1!==o.childNodes.length||"br"!==e.utils.getTagName(o.firstChild))&&(this._tryToTrackAddedNode(o,t.reparented),!0)},C.prototype._restoreList=function(t){var n=t.added,i=t.removed,r=this.hostMethods.getNewLineNodeName(),o=r?1:0,s=n&&n.length,a=i&&i.length;if(s<o||!a)return!1;for(var l,d,h,c,u=0,p=0;p<a;++p){if(l=i[p],!d&&g.test(l.nodeName)){if(d=l,(h=this._getNodeTrackingContext(d)).isInsert&&h.isCurrent)return!1;break}"LI"===l.nodeName&&0===l.children.length&&(e.utils.findInArray(t.reparented,function(e){return t.getOldParentNode(e)===l})||++u)}if(!d&&1!==u)return!1;var f=0,m=0;for(p=n.length-1;p>=0;--p)(l=n[p]).nodeType===Node.ELEMENT_NODE&&(l.nodeName===r?++f:d&&l.nodeName===d.nodeName&&++m);if(f===o&&1===u&&!d)return!1;if(f<o)return!1;if(c=t.getOldParentNode(d),!this._shouldRestoreNode(d,c))return!0;var v=t.getOldPreviousSibling(d);c.insertBefore(d,v&&v.nextSibling),this._removeHostArtifacts(d),m?this._addDeleteTracking(d.firstChild,{trackingContext:h,containerOnly:!0}):this._addDeleteTracking(d,{trackingContext:h,containerOnly:!0,trackContent:!0});for(p=t.added.length-1;p>=0;--p)(c=(l=t.added[p]).parentNode)&&c.removeChild(l);return!0},C.prototype._filterMutations=function(e){return!!e&&("childList"!==e.type||(!this._shouldIgnoreMutationNodeList(e.addedNodes)||!this._shouldIgnoreMutationNodeList(e.removedNodes)))},C.prototype._shouldIgnoreMutationNodeList=function(e){if(!e||!e.length)return!0;for(var t,n=e.length-1;n>=0;--n){if(((t=e[n]).className||"").indexOf("opentip-container")>=0)return!0;if(!this._shouldIgnoreNode(t))return!1}return!0},C.prototype._shouldIgnoreNode=function(t){if(!t)return!0;if(t.nodeType===Node.TEXT_NODE&&e.domUtils.isEmptyString(t.nodeValue))return!0;if(t.nodeType!==Node.ELEMENT_NODE)return t.nodeType!==Node.TEXT_NODE;if(t.style&&"none"===t.style.display)return!0;var n=this._params.ignoredSelectors;if(n){if(e.domUtils.matchesSelector(t,n))return!0;if(1===t.childNodes.length&&t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&e.domUtils.matchesSelector(t.firstChild,n))return!0;for(var i=this.rootElement,r=t.parentNode;r&&r!==i;r=r.parentNode)if(r.nodeType===Node.ELEMENT_NODE&&e.domUtils.matchesSelector(r,n))return!0}return!1},C.prototype.tryToExtractNestedTrack=function(e,t){},C.prototype._findNextNodeToDelete=function(t){var n=t.startContainer,i=n,r=t.cloneRange();if(!r.collapsed)return null;if(n.nodeType===Node.ELEMENT_NODE){if(N(n))return r.setEndAfter(n),r.collapse(!1),this._findNextNodeToDelete(r);if(r.endOffset>=n.childNodes.length?r.moveEnd("char",1,this._isDeletableOptions)&&(r.moveEnd("char",-1,null),n=r.endContainer):n=e.domUtils.getFirstSelectableChild(n.childNodes[r.endOffset],this._isDeletableOptions),!n)return null;if(n.nodeType!==Node.TEXT_NODE)return{node:n,offset:0,isText:!1,tagName:n.nodeName,isCurrent:e.rangy.dom.isAncestorOf(n,i,!0)};r.setStart(n,0),r.collapse(!0)}if(n.nodeType===Node.TEXT_NODE){if(r.endOffset<n.length)return{node:n,offset:r.endOffset,isText:!0,isCurrent:!1,tagName:null};if(!r.moveEnd("char",1,this._isDeletableOptions))return null;if(r.collapse(!1),r.endContainer&&r.endContainer!==n){if(e.domUtils.isEmptyTextNode(r.endContainer)||N(r.endContainer))return this._findNextNodeToDelete(r);var o=r.endContainer.nodeType===Node.TEXT_NODE;return{node:r.endContainer,offset:r.endOffset&&r.endOffset-1||0,isText:o,tagName:r.endContainer.nodeName,isCurrent:!o&&e.rangy.dom.isAncestorOf(r.endContainer,i,!0)}}}return null},C.prototype._findPreviousNodeToDelete=function(t){var n=t.endContainer,i=n,r=t.cloneRange();if(!r.collapsed)return null;if(n.nodeType===Node.ELEMENT_NODE){if(0===r.endOffset){if("BR"===n.nodeName&&N(n))return r.setStartBefore(n.previousSibling),r.collapse(!0),this._findPreviousNodeToDelete(r);e.domUtils.getPreviousSelectableNode(n,this._isDeletableNoSelfOptions);var o=this._findDeletableParent(n.childNodes[0]||n,this.rootElement);if(o)return{node:o,offset:e.domUtils.getNodeIndex(o),tagName:o.nodeName,isText:!1,isCurrent:!0};r.moveStart("char",-1,this._isDeletableOptions)&&(r.moveStart("char",1,null),n=r.startContainer)}if(n.nodeType===Node.ELEMENT_NODE){if(e.domUtils.isStubElement(n))return{node:n,offset:0,isText:!1,isCurrent:!1,tagName:n.nodeName};var s=n.childNodes[r.endOffset-1];if(!(n=e.domUtils.getLastSelectableChild(s,this._isDeletableNoSelfOptions))&&this._isDeletableElement(s)&&(n=s),!n)return null;if(n.nodeType!==Node.TEXT_NODE)return"BR"===n.nodeName&&n===n.parentNode.lastChild&&n.previousSibling&&n.parentNode.nodeName in h?(r.setStartBefore(n),r.collapse(!0),this._findPreviousNodeToDelete(r)):{node:n,offset:0,isText:!1,tagName:n.nodeName,isCurrent:e.rangy.dom.isAncestorOf(n,i,!0)};r.setStart(n,n.length||0),r.collapse(!0)}}if(n&&n.nodeType===Node.TEXT_NODE){if(r.startOffset>0)return{node:n,offset:r.startOffset-1,tagName:null,isText:!0,isCurrent:!1};if(r.moveStart("char",-1,this._isDeletableOptions)){var a=r.startContainer.nodeType===Node.TEXT_NODE;return{node:r.startContainer,offset:r.startOffset,tagName:a?null:r.startContainer.nodeName,isText:a,isCurrent:!a&&e.rangy.dom.isAncestorOf(r.startContainer,i,!0)}}}return null},C.prototype._getNodeTrackingContext=function(t){var n,i={isTracking:!1,isCurrentUser:!1,isCurrentSession:!0,isCurrent:!1,trackingNode:null,isDelete:!1,isInsert:!1,changeId:null,isTextSpan:!1,tracksContent:!1};return t&&(n=this._isOpaqueNode(t)&&e.domUtils.matchesSelector(t.parentNode,this._lite2Selector)?t.parentNode:this._getWrappingTrackedNode(t,this._lite2Selector))&&(n!==t||e.domUtils.isTextContainer(t)||this._isDeletableElement(t))?(i.isTracking=!0,i.isCurrentUser=this._isCurrentUserNode(n),i.trackingNode=n,i.isDelete=e.domUtils.matchesSelector(n,this._deleteSelector),i.isInsert=!i.isDelete,i.isTextSpan=e.domUtils.matchesSelector(n,"span:not(."+s+")"),i.changeId=n.getAttribute(this.attributes.changeId),this.sessionId&&(i.isCurrentSession=n.getAttribute(this.attributes.sessionId)===this.sessionId),i.isCurrent=i.isCurrentSession&&i.isCurrentUser,i.tracksContent=!e.domUtils.hasClass(n,s),i):i},C.prototype._removeHostArtifacts=function(e){e&&e.nodeType===Node.ELEMENT_NODE&&$(e).find("[data-cke-bookmark],[data-cke-hidden-sel]").remove()},C.prototype._removeFLITEArtifacts=function(){var e=this._$element;e.find("[class='']").each(function(e,t){t.removeAttribute("class")}),e.find(["span",this._insertSelector,":empty,span",this._deleteSelector,":empty"].join("")).each(function(e,t){t.parentNode&&t.parentNode.removeChild(t)})},C.prototype._isValidFLITENode=function(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;var t=$(e);return Boolean(t.hasClass(this._deleteClassName)&&t.hasClass(this._insertClassName)&&t.attr(this.attributes.changeId)&&t.attr(this.attributes.userId))},C.prototype._replaceNodeWithContent=function(e){var t=e[0],n=t&&t.parentNode;if(n&&t.nodeType===Node.ELEMENT_NODE){var i=!1,r=e.contents();r.length?("LI"===t.nodeName&&n.nodeName in u&&(i=!0,t===t.parentNode.firstChild&&t.parentNode!==this.rootElement?(e.parent().before(r),this._removeNode(t)):t.previousSibling?($(t.previousSibling).append(r),this._removeNode(t)):i=!1),i||e.replaceWith(r)):e.remove()}},C.prototype._restoreCaret=function(t){var n=t&&t.node;if(!n||!e.rangy.dom.isAncestorOf(this.rootElement,n,!1))return!1;try{if(n.previousSibling!==t.prev||n.nextSibling!==t.next||n.parentNode!==t.parent)return!1;if(n.nodeType===Node.TEXT_NODE)this._selection.setStart(n,!0,t.offset);else{var i=this._getCurrentRange();i&&(i.setStartBefore(n),this._selection.addRange(i))}return!0}catch(e){return!1}},C.prototype._getNodeAtCaret=function(t,n){void 0===t&&(t=null),void 0===n&&(n=!1),t=t||this._getCurrentRange();var i={node:null,offset:0,parent:null,prev:null,next:null,isBack:n};if(!t||!t.collapsed)return i;function r(e,t){return{node:e,offset:t,prev:e.previousSibling,next:e.nextSibling,parent:e.parentNode,isBack:n}}if(t.endContainer.nodeType===Node.TEXT_NODE){if(t.endOffset||!n)return r(t.endContainer,n?t.endOffset-1:t.endOffset);var o=e.domUtils.getPreviousSelectableNode(t.endContainer,this._isDeletableOptions);return o?o.nodeType===Node.ELEMENT_NODE?r(o,0):r(o,o.length):i}if(this._isOpaqueNode(t.endContainer))return r(t.endContainer,0);if(t.endOffset||!n){var s=n?t.endOffset-1:t.endOffset;return s<0||s>=t.endContainer.childNodes.length?0===s?r(t.endContainer,0):i:r(t.endContainer.childNodes[s],s)}return i},C.prototype._moveCaret=function(e,t){if(e){var n={root:this.rootElement,filter:null};t===r.Left?e.moveStart("char",-1,n):e.moveEnd("char",1,n),e.collapse(t===r.Left),this._selection.addRange(e)}},C.prototype._isDeletableElement=function(n,i){if(void 0===i&&(i=!1),!n)return!1;if(n.nodeType===Node.TEXT_NODE&&!e.domUtils.isEmptyTextNode(n))return!0;if(n.nodeType!==Node.ELEMENT_NODE)return!1;if(N(n))return!1;for(var r,o=$(n),s=0,a=y.length;s<a;++s)if(r=y[s],o.is(r.selector)){if(r.type===t.Always)return!0;if(r.type===t.NotEmpty)return i||!e.domUtils.hasNoTextOrStubContent(n)}return!1},C.prototype._findDeletableParent=function(e,t){for(;e&&e!==t;){if(e=e.parentNode,this._isDeletableElement(e,!0))return e;if(e.previousSibling)return null}return null},C.prototype._onRangeChanged=function(e){this._params.hostMethods&&this._params.hostMethods.setHostRange&&this._params.hostMethods.setHostRange(e.nativeRange)},C.prototype._collapseOnEdgeOf=function(t,n,i){var r,o=!i&&!e.domUtils.isStubElement(t)&&e.domUtils.matchesSelector(t,a)&&!this._isOpaqueNode(t.firstChild),s={root:this.rootElement,filter:this._isDeletableCallback,excludeSelf:!0};if(n){if(r=o&&e.domUtils.getFirstSelectableChild(t,s))return void this._selection.collapseAtStart(r);this._selection.collapseAfter(t)}else{if(r=!i&&o&&e.domUtils.getLastSelectableChild(t,s))return void this._selection.collapseAtEnd(r);this._selection.collapseBefore(t,this._isDeletableOptions)}},C}(),T=function(){function e(){this.ignoreCount=0,this.timeout=null}return e.prototype.set=function(e){var t=this;this.timeout&&clearTimeout(this.timeout),this.ignoreCount+=e;var n=this.ignoreCount;this.timeout=setTimeout(function(){t.timeout=null,t.ignoreCount=Math.max(t.ignoreCount-n,0)},10)},e.prototype.shouldIgnore=function(e){var t=this.ignoreCount>0;return t&&this.ignoreCount--,0===this.ignoreCount&&this.timeout&&(clearTimeout(this.timeout),this.timeout=null),t},e}(),b=function(){function e(){this._type="none",this._time=0,this._data=null}return e.prototype.setContext=function(e,t){this._type=e,this._time=Date.now(),this._data=t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return Date.now()-this._time>500&&(this._type="none"),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentType",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),e}();e.InlineChangeEditor=function(e){return new C(e)}}(window.FLITE||window),function(t){var n,i,r,o,s,a,l,d,h,c,u=[].slice,p=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},f={}.hasOwnProperty;for(n=function(){function e(t,n,i,r){var o,s,a,l,d,h,c,p,f,g,m,v,_,y,N=this;if(this.id=++e.lastId,this.adapter=e.adapter,r=this.adapter.clone(r),"object"==typeof n?(r=n,n=i=void 0):"object"==typeof i&&(r=i,i=void 0),this._element=t,this._boundingElement=r.boundingElement,this._document=t.ownerDocument,this._window=this._document.defaultView,this._body=this._document.body,e.addTip(this),(o=e.getTips(t)).push(this),e.setTips(t,o),this.triggerElement=this.adapter.wrap(t),this.triggerElement.length>1)throw new Error("You can't call Opentip on multiple elements.");if(this.triggerElement.length<1)throw new Error("Invalid element.");for(this.loaded=!1,this.loading=!1,this.visible=!1,this.currentPosition={left:0,top:0},this.dimensions={width:100,height:50},this.content="",this.redraw=!0,this.currentObservers={showing:!1,visible:!1,hiding:!1,hidden:!1},null!=i&&(r.title=i),null!=n&&this.setContent(n),null==r.extends&&(null!=r.style?r.extends=r.style:r.extends=e.defaultStyle),l=[r],y=r;y.extends;){if(h=y.extends,null==(y=e.styles[h]))throw new Error("Invalid style: "+h);l.unshift(y),null==y.extends&&"standard"!==h&&(y.extends="standard")}for((r=(m=this.adapter).extend.apply(m,[{}].concat(u.call(l)))).hideTriggers=function(){var e,t,n,i;for(i=[],e=0,t=(n=r.hideTriggers).length;e<t;e++)s=n[e],i.push(s);return i}(),r.hideTrigger&&0===r.hideTriggers.length&&r.hideTriggers.push(r.hideTrigger),c=0,f=(v=["tipJoint","targetJoint","stem"]).length;c<f;c++)r[d=v[c]]&&"string"==typeof r[d]&&(r[d]=new e.Joint(r[d]));for(!r.ajax||!0!==r.ajax&&r.ajax||("A"===this.adapter.tagName(this.triggerElement)?r.ajax=this.adapter.attr(this.triggerElement,"href"):r.ajax=!1),"click"===r.showOn&&"A"===this.adapter.tagName(this.triggerElement)&&this.adapter.observe(this.triggerElement,"click",function(e){return e.preventDefault(),e.stopPropagation(),e.stopped=!0}),r.target&&(r.fixed=!0),!0===r.stem&&(r.stem=new e.Joint(r.tipJoint)),!0===r.target?r.target=this.triggerElement:r.target&&(r.target=this.adapter.wrap(r.target)),this.currentStem=r.stem,null==r.delay&&(r.delay="mouseover"===r.showOn?.2:0),null==r.targetJoint&&(r.targetJoint=new e.Joint(r.tipJoint).flip()),this.showTriggers=[],this.showTriggersWhenVisible=[],this.hideTriggers=[],r.showOn&&"creation"!==r.showOn&&this.showTriggers.push({element:this.triggerElement,event:r.showOn}),null!=r.ajaxCache&&(r.cache=r.ajaxCache,delete r.ajaxCache),this.options=r,this.bound={},p=0,g=(_=["prepareToShow","prepareToHide","show","hide","reposition"]).length;p<g;p++)a=_[p],this.bound[a]=function(e){return function(){return N[e].apply(N,arguments)}}(a);this.adapter.domReady(function(){if(N.activate(),"creation"===N.options.showOn)return N.prepareToShow()})}return e.prototype.STICKS_OUT_TOP=1,e.prototype.STICKS_OUT_BOTTOM=2,e.prototype.STICKS_OUT_LEFT=1,e.prototype.STICKS_OUT_RIGHT=2,e.prototype.class={container:"opentip-container",opentip:"opentip",header:"ot-header",content:"ot-content",loadingIndicator:"ot-loading-indicator",close:"ot-close",goingToHide:"ot-going-to-hide",hidden:"ot-hidden",hiding:"ot-hiding",goingToShow:"ot-going-to-show",showing:"ot-showing",visible:"ot-visible",loading:"ot-loading",ajaxError:"ot-ajax-error",fixed:"ot-fixed",showEffectPrefix:"ot-show-effect-",hideEffectPrefix:"ot-hide-effect-",stylePrefix:"style-"},e.prototype._setup=function(){var e,t,n,i,r,o,s,a,l,d,h;for(this._buildContainer(this.triggerElement),this.hideTriggers=[],i=r=0,s=(l=this.options.hideTriggers).length;r<s;i=++r){if(t=l[i],n=null,e=this.options.hideOn instanceof Array?this.options.hideOn[i]:this.options.hideOn,"string"==typeof t)switch(t){case"trigger":e=e||"mouseout",n=this.triggerElement;break;case"tip":e=e||"mouseover",n=this.container;break;case"target":e=e||"mouseover",n=this.options.target;break;case"closeButton":break;default:throw new Error("Unknown hide trigger: "+t+".")}else e=e||"mouseover",n=this.adapter.wrap(t);n&&this.hideTriggers.push({element:n,event:e,original:t})}for(h=[],o=0,a=(d=this.hideTriggers).length;o<a;o++)t=d[o],h.push(this.showTriggersWhenVisible.push({element:t.element,event:"mouseover"}));return h},e.prototype._buildContainer=function(e){if(this.container=this.adapter.create('<div id="opentip-'+this.id+'" class="'+this.class.container+" "+this.class.hidden+" "+this.class.stylePrefix+this.options.className+'"></div>',this._document),this.adapter.css(this.container,{position:"absolute"}),this.options.ajax&&this.adapter.addClass(this.container,this.class.loading),this.options.fixed&&this.adapter.addClass(this.container,this.class.fixed),this.options.showEffect&&this.adapter.addClass(this.container,""+this.class.showEffectPrefix+this.options.showEffect),this.options.hideEffect)return this.adapter.addClass(this.container,""+this.class.hideEffectPrefix+this.options.hideEffect)},e.prototype._buildElements=function(){var e,t,n=this._document;return this.tooltipElement=this.adapter.create('<div class="'+this.class.opentip+'"><div class="'+this.class.header+'"></div><div class="'+this.class.content+'"></div></div>',n),this.backgroundCanvas=this.adapter.wrap(n.createElement("canvas")),this.adapter.css(this.backgroundCanvas,{position:"absolute"}),"undefined"!=typeof G_vmlCanvasManager&&null!==G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.adapter.unwrap(this.backgroundCanvas)),e=this.adapter.find(this.tooltipElement,"."+this.class.header),this.options.title&&(t=this.adapter.create("<h1></h1>",n),this.adapter.update(t,this.options.title,this.options.escapeTitle),this.adapter.append(e,t)),this.options.ajax&&!this.loaded&&this.adapter.append(this.tooltipElement,this.adapter.create('<div class="'+this.class.loadingIndicator+'"><span>↻</span></div>',n)),p.call(this.options.hideTriggers,"closeButton")>=0&&(this.closeButtonElement=this.adapter.create('<a href="javascript:undefined;" class="'+this.class.close+'"><span>Close</span></a>',n),this.adapter.append(e,this.closeButtonElement)),this.adapter.append(this.container,this.backgroundCanvas),this.adapter.append(this.container,this.tooltipElement),this.adapter.prepend(this._body,this.container),this._newContent=!0,this.redraw=!0},e.prototype.setContent=function(e){if(this.content=e,this._newContent=!0,"function"==typeof this.content?(this._contentFunction=this.content,this.content=""):this._contentFunction=null,this.visible)return this._updateElementContent()},e.prototype._updateElementContent=function(){var e;return(this._newContent||!this.options.cache&&this._contentFunction)&&(null!=(e=this.adapter.find(this.container,"."+this.class.content))&&(this._contentFunction&&(this.content=this._contentFunction(this)),this.adapter.update(e,this.content,this.options.escapeContent)),this._newContent=!1),this._storeAndLockDimensions(),this.reposition()},e.prototype._storeAndLockDimensions=function(){var e;if(this.container)return e=this.dimensions,this.adapter.css(this.container,{width:"auto",left:"0px",top:"0px"}),this.dimensions=this.adapter.dimensions(this.container),this.dimensions.width+=1,this.adapter.css(this.container,{width:this.dimensions.width+"px",top:this.currentPosition.top+"px",left:this.currentPosition.left+"px"}),this._dimensionsEqual(this.dimensions,e)?void 0:(this.redraw=!0,this._draw())},e.prototype.activate=function(){return this._setupObservers("hidden","hiding")},e.prototype.deactivate=function(t){return t&&this.adapter.extend(this.options,t),this.hide(),e.removeTip(this),this._setupObservers("-showing","-visible","-hidden","-hiding")},e.prototype._setupObservers=function(){var e,t,n,i,r,o,s,a,l,d,h,c,p,f,g,m,v=this;for(o=0,d=(i=1<=arguments.length?u.call(arguments,0):[]).length;o<d;o++)if(n=i[o],t=!1,"-"===n.charAt(0)&&(t=!0,n=n.substr(1)),this.currentObservers[n]!==!t)switch(this.currentObservers[n]=!t,e=function(){var e,n,i;return e=1<=arguments.length?u.call(arguments,0):[],t?(n=v.adapter).stopObserving.apply(n,e):(i=v.adapter).observe.apply(i,e)},n){case"showing":for(s=0,h=(f=this.hideTriggers).length;s<h;s++)e((r=f[s]).element,r.event,this.bound.prepareToHide);e(null!=document.onresize?document:window,"resize",this.bound.reposition),e(window,"scroll",this.bound.reposition);break;case"visible":for(a=0,c=(g=this.showTriggersWhenVisible).length;a<c;a++)e((r=g[a]).element,r.event,this.bound.prepareToShow);break;case"hiding":for(l=0,p=(m=this.showTriggers).length;l<p;l++)e((r=m[l]).element,r.event,this.bound.prepareToShow);break;case"hidden":break;default:throw new Error("Unknown state: "+n)}return null},e.prototype.prepareToShow=function(){if(this._abortHiding(),this._abortShowing(),!this.visible)return null==this.container&&this._setup(),this.options.group&&e._abortShowingGroup(this.options.group,this),this.preparingToShow=!0,this._setupObservers("-hidden","-hiding","showing"),this._followMousePosition(),this.options.fixed&&!this.options.target&&(this.initialMousePosition=o),this.reposition(),this._showTimeoutId=this.setTimeout(this.bound.show,this.options.delay||0)},e.prototype.show=function(){var t=this;if(this._abortHiding(),!this.visible)return this._clearTimeouts(),this._triggerElementExists()?(null==this.container&&this._setup(),this.options.group&&e._hideGroup(this.options.group,this),this.visible=!0,this.preparingToShow=!1,null==this.tooltipElement&&this._buildElements(),this._updateElementContent(),!this.options.ajax||this.loaded&&this.options.cache||this._loadAjax(),this._searchAndActivateCloseButtons(),this._startEnsureTriggerElement(),this.adapter.css(this.container,{zIndex:e.lastZIndex++}),this._setupObservers("-hidden","-hiding","-showing","-visible","showing","visible"),this.options.fixed&&!this.options.target&&(this.initialMousePosition=o),this.reposition(),this.adapter.removeClass(this.container,this.class.hiding),this.adapter.removeClass(this.container,this.class.hidden),this.adapter.addClass(this.container,this.class.goingToShow),this.setCss3Style(this.container,{transitionDuration:"0s"}),this.defer(function(){var e;if(t.visible&&!t.preparingToHide)return t.adapter.removeClass(t.container,t.class.goingToShow),t.adapter.addClass(t.container,t.class.showing),e=0,t.options.showEffect&&t.options.showEffectDuration&&(e=t.options.showEffectDuration),t.setCss3Style(t.container,{transitionDuration:e+"s"}),t._visibilityStateTimeoutId=t.setTimeout(function(){return t.adapter.removeClass(t.container,t.class.showing),t.adapter.addClass(t.container,t.class.visible)},e),t._activateFirstInput()}),this._draw()):this.deactivate()},e.prototype._abortShowing=function(){if(this.preparingToShow)return this._clearTimeouts(),this._stopFollowingMousePosition(),this.preparingToShow=!1,this._setupObservers("-showing","-visible","hiding","hidden")},e.prototype.prepareToHide=function(){if(this._abortShowing(),this._abortHiding(),this.visible)return this.preparingToHide=!0,this._setupObservers("-showing","visible","-hidden","hiding"),this._hideTimeoutId=this.setTimeout(this.bound.hide,this.options.hideDelay)},e.prototype.hide=function(){var t,n=this;if(this._abortShowing(),this.visible){if(this._clearTimeouts(),this.visible=!1,this.preparingToHide=!1,this._stopEnsureTriggerElement(),this._setupObservers("-showing","-visible","-hiding","-hidden","hiding","hidden"),this._element){for(var i=this.adapter.data(this._element,"__opentips")||[],r=i.length;r--;)i[r]==this&&i.slice(r,1);e.setTips(this._element,i)}if(this.options.fixed||this._stopFollowingMousePosition(),this.container)return t=this.class,this.adapter.removeClass(this.container,t.visible),this.adapter.removeClass(this.container,t.showing),this.adapter.addClass(this.container,t.goingToHide),this.setCss3Style(this.container,{transitionDuration:"0s"}),this.defer(function(){var e;return n.adapter.removeClass(n.container,n.class.goingToHide),n.adapter.addClass(n.container,n.class.hiding),e=0,n.options.hideEffect&&n.options.hideEffectDuration&&(e=n.options.hideEffectDuration),n.setCss3Style(n.container,{transitionDuration:e+"s"}),n._visibilityStateTimeoutId=n.setTimeout(function(){if(n.adapter.removeClass(n.container,n.class.hiding),n.adapter.addClass(n.container,n.class.hidden),n.setCss3Style(n.container,{transitionDuration:"0s"}),n.options.removeElementsOnHide)return n.adapter.remove(n.container),delete n.container,delete n.tooltipElement},e)})}},e.prototype._abortHiding=function(){if(this.preparingToHide)return this._clearTimeouts(),this.preparingToHide=!1,this._setupObservers("-hiding","showing","visible")},e.prototype.reposition=function(){var e,t,n,i=this;if(null!=(e=this.getPosition())&&(t=this.options.stem,this.options.containInViewport&&(e=(n=this._ensureViewportContainment(e)).position,t=n.stem),!this._positionsEqual(e,this.currentPosition)))return this.options.stem&&!t.eql(this.currentStem)&&(this.redraw=!0),this.currentPosition=e,this.currentStem=t,this._draw(),this.adapter.css(this.container,{left:e.left+"px",top:e.top+"px"}),this.defer(function(){var e;return(e=i.adapter.unwrap(i.container)).style.visibility="hidden",e.offsetHeight,e.style.visibility="visible"})},e.prototype.getPosition=function(e,t,n){var i,r,s,a,l,d,h,c,u,p=this._body,f=this._window;if(this.container)return null==e&&(e=this.options.tipJoint),null==t&&(t=this.options.targetJoint),a={},this.options.target?(h=this.adapter.offset(this.options.target),d=this.adapter.dimensions(this.options.target),a=h,t.right?null!=(c=this.adapter.unwrap(this.options.target)).getBoundingClientRect?a.left=c.getBoundingClientRect().right+(null!=(u=f.pageXOffset)?u:p.scrollLeft):a.left+=d.width:t.center&&(a.left+=Math.round(d.width/2)),t.bottom?a.top+=d.height:t.middle&&(a.top+=Math.round(d.height/2)),this.options.borderWidth&&(this.options.tipJoint.left&&(a.left+=this.options.borderWidth),this.options.tipJoint.right&&(a.left-=this.options.borderWidth),this.options.tipJoint.top?a.top+=this.options.borderWidth:this.options.tipJoint.bottom&&(a.top-=this.options.borderWidth))):a=this.initialMousePosition?{top:this.initialMousePosition.y,left:this.initialMousePosition.x}:{top:o.y,left:o.x},this.options.autoOffset&&(s=(l=this.options.stem?this.options.stemLength:0)&&this.options.fixed?2:10,i=e.middle&&!this.options.fixed?15:0,r=e.center&&!this.options.fixed?15:0,e.right?a.left-=s+i:e.left&&(a.left+=s+i),e.bottom?a.top-=s+r:e.top&&(a.top+=s+r),l&&(null==n&&(n=this.options.stem),n.right?a.left-=l:n.left&&(a.left+=l),n.bottom?a.top-=l:n.top&&(a.top+=l))),a.left+=this.options.offset[0],a.top+=this.options.offset[1],e.right?a.left-=this.dimensions.width:e.center&&(a.left-=Math.round(this.dimensions.width/2)),e.bottom?a.top-=this.dimensions.height:e.middle&&(a.top-=Math.round(this.dimensions.height/2)),a},e.prototype._ensureViewportContainment=function(t){var n,i,r,o,s,a,l,d,h,c,u,p=this._document;if(r={position:t,stem:l=this.options.stem},!this.visible||!t)return r;if(!(d=this._sticksOut(t))[0]&&!d[1])return r;if(c=new e.Joint(this.options.tipJoint),this.options.targetJoint&&(h=new e.Joint(this.options.targetJoint)),a=this.adapter.scrollOffset(this._window,this._document),u=this._boundingElement?this.adapter.dimensions(this._boundingElement):this.adapter.viewportDimensions(p),[t.left-a[0],t.top-a[1]],n=!1,u.width>=this.dimensions.width&&d[0])switch(n=!0,d[0]){case this.STICKS_OUT_LEFT:c.setHorizontal("right"),this.options.targetJoint&&h.setHorizontal("right");break;case this.STICKS_OUT_RIGHT:c.setHorizontal("left"),this.options.targetJoint&&h.setHorizontal("left")}if(u.height>=this.dimensions.height&&d[1])switch(n=!0,d[1]){case this.STICKS_OUT_TOP:c.setVertical("top"),this.options.targetJoint&&h.setVertical("bottom");break;case this.STICKS_OUT_BOTTOM:c.setVertical("bottom"),this.options.targetJoint&&h.setVertical("top")}return n?(this.options.stem&&(l=c),t=this.getPosition(c,h,l),o=!1,s=!1,(i=this._sticksOut(t))[0]&&i[0]!==d[0]&&(o=!0,c.setHorizontal(this.options.tipJoint.horizontal),this.options.targetJoint&&h.setHorizontal(this.options.targetJoint.horizontal)),i[1]&&i[1]!==d[1]&&(s=!0,c.setVertical(this.options.tipJoint.vertical),this.options.targetJoint&&h.setVertical(this.options.targetJoint.vertical)),o&&s?r:((o||s)&&(this.options.stem&&(l=c),t=this.getPosition(c,h,l)),{position:t,stem:l})):r},e.prototype._sticksOut=function(e){var t,n,i,r;return n=this.adapter.scrollOffset(this._window,this._document),r=this._boundingElement?this.adapter.dimensions(this._boundingElement):this.adapter.viewportDimensions(doc),i=[!1,!1],(t=[e.left-n[0],e.top-n[1]])[0]<0?i[0]=this.STICKS_OUT_LEFT:t[0]+this.dimensions.width>r.width&&(i[0]=this.STICKS_OUT_RIGHT),t[1]<0?i[1]=this.STICKS_OUT_TOP:t[1]+this.dimensions.height>r.height&&(i[1]=this.STICKS_OUT_BOTTOM),i},e.prototype._draw=function(){var t,n,i,r,o,s,a,l,d,h,c,u,f,g,m,v,_,y,N,C=this;if(this.backgroundCanvas&&this.redraw){if(this.redraw=!1,this.currentStem){for(m=0,v=(_=["top","right","bottom","left"]).length;m<v;m++)u=_[m],this.adapter.removeClass(this.container,"stem-"+u);this.adapter.addClass(this.container,"stem-"+this.currentStem.horizontal),this.adapter.addClass(this.container,"stem-"+this.currentStem.vertical)}return s=[0,0],a=[0,0],p.call(this.options.hideTriggers,"closeButton")>=0&&(o=new e.Joint("top right"===(null!=(y=this.currentStem)?y.toString():void 0)?"top left":"top right"),s=[this.options.closeButtonRadius+this.options.closeButtonOffset[0],this.options.closeButtonRadius+this.options.closeButtonOffset[1]],a=[this.options.closeButtonRadius-this.options.closeButtonOffset[0],this.options.closeButtonRadius-this.options.closeButtonOffset[1]]),i=this.adapter.clone(this.dimensions),r=[0,0],this.options.borderWidth&&(i.width+=2*this.options.borderWidth,i.height+=2*this.options.borderWidth,r[0]-=this.options.borderWidth,r[1]-=this.options.borderWidth),this.options.shadow&&(i.width+=2*this.options.shadowBlur,i.width+=Math.max(0,this.options.shadowOffset[0]-2*this.options.shadowBlur),i.height+=2*this.options.shadowBlur,i.height+=Math.max(0,this.options.shadowOffset[1]-2*this.options.shadowBlur),r[0]-=Math.max(0,this.options.shadowBlur-this.options.shadowOffset[0]),r[1]-=Math.max(0,this.options.shadowBlur-this.options.shadowOffset[1])),n={left:0,right:0,top:0,bottom:0},this.currentStem&&(this.currentStem.left?n.left=this.options.stemLength:this.currentStem.right&&(n.right=this.options.stemLength),this.currentStem.top?n.top=this.options.stemLength:this.currentStem.bottom&&(n.bottom=this.options.stemLength)),o&&(o.left?n.left=Math.max(n.left,a[0]):o.right&&(n.right=Math.max(n.right,a[0])),o.top?n.top=Math.max(n.top,a[1]):o.bottom&&(n.bottom=Math.max(n.bottom,a[1]))),i.width+=n.left+n.right,i.height+=n.top+n.bottom,r[0]-=n.left,r[1]-=n.top,this.currentStem&&this.options.borderWidth&&(N=this._getPathStemMeasures(this.options.stemBase,this.options.stemLength,this.options.borderWidth),g=N.stemLength,f=N.stemBase),(t=this.adapter.unwrap(this.backgroundCanvas)).width=i.width,t.height=i.height,this.adapter.css(this.backgroundCanvas,{width:t.width+"px",height:t.height+"px",left:r[0]+"px",top:r[1]+"px"}),(l=t.getContext("2d")).setTransform(1,0,0,1,0,0),l.clearRect(0,0,t.width,t.height),l.beginPath(),l.fillStyle=this._getColor(l,this.dimensions,this.options.background,this.options.backgroundGradientHorizontal),l.lineJoin="miter",l.miterLimit=500,c=this.options.borderWidth/2,this.options.borderWidth?(l.strokeStyle=this.options.borderColor,l.lineWidth=this.options.borderWidth):(g=this.options.stemLength,f=this.options.stemBase),null==f&&(f=0),h=function(e,t,n){if(n&&l.moveTo(Math.max(f,C.options.borderRadius,s[0])+1-c,-c),t)return l.lineTo(e/2-f/2,-c),l.lineTo(e/2,-g-c),l.lineTo(e/2+f/2,-c)},d=function(e,t,n){var i,r,o,a;return e?(l.lineTo(-f+c,0-c),l.lineTo(g+c,-g-c),l.lineTo(c,f-c)):t?(a=C.options.closeButtonOffset,o=s[0],n%2!=0&&(a=[a[1],a[0]],o=s[1]),i=Math.acos(a[1]/C.options.closeButtonRadius),r=Math.acos(a[0]/C.options.closeButtonRadius),l.lineTo(-o+c,-c),l.arc(c-a[0],-c+a[1],C.options.closeButtonRadius,-(Math.PI/2+i),r,!1)):(l.lineTo(-C.options.borderRadius+c,-c),l.quadraticCurveTo(c,-c,c,C.options.borderRadius-c))},l.translate(-r[0],-r[1]),l.save(),function(){var t,n,i,r,s,a,c,u,p,f,g;for(g=[],n=p=0,f=e.positions.length/2;0<=f?p<f:p>f;n=0<=f?++p:--p)s=2*n,a=0===n||3===n?0:C.dimensions.width,c=n<2?0:C.dimensions.height,u=Math.PI/2*n,i=n%2==0?C.dimensions.width:C.dimensions.height,r=new e.Joint(e.positions[s]),t=new e.Joint(e.positions[s+1]),l.save(),l.translate(a,c),l.rotate(u),h(i,r.eql(C.currentStem),0===n),l.translate(i,0),d(t.eql(C.currentStem),t.eql(o),n),g.push(l.restore())}(),l.closePath(),l.save(),this.options.shadow&&(l.shadowColor=this.options.shadowColor,l.shadowBlur=this.options.shadowBlur,l.shadowOffsetX=this.options.shadowOffset[0],l.shadowOffsetY=this.options.shadowOffset[1]),l.fill(),l.restore(),this.options.borderWidth&&l.stroke(),l.restore(),o?function(){var e,t,n;return 2*C.options.closeButtonRadius,e="top right"===o.toString()?[(n=[C.dimensions.width-C.options.closeButtonOffset[0],C.options.closeButtonOffset[1]])[0]+c,n[1]-c]:[(n=[C.options.closeButtonOffset[0],C.options.closeButtonOffset[1]])[0]-c,n[1]-c],l.translate(e[0],e[1]),t=C.options.closeButtonCrossSize/2,l.save(),l.beginPath(),l.strokeStyle=C.options.closeButtonCrossColor,l.lineWidth=C.options.closeButtonCrossLineWidth,l.lineCap="round",l.moveTo(-t,-t),l.lineTo(t,t),l.stroke(),l.beginPath(),l.moveTo(t,-t),l.lineTo(-t,t),l.stroke(),l.restore(),C.adapter.css(C.closeButtonElement,{left:n[0]-t-C.options.closeButtonLinkOverscan+"px",top:n[1]-t-C.options.closeButtonLinkOverscan+"px",width:C.options.closeButtonCrossSize+2*C.options.closeButtonLinkOverscan+"px",height:C.options.closeButtonCrossSize+2*C.options.closeButtonLinkOverscan+"px"})}():void 0}},e.prototype._getPathStemMeasures=function(e,t,n){var i,r,o,s;if(o=n/2,i=2*(r=Math.atan(e/2/t)),(s=o+t-2*(o/Math.sin(i))*Math.cos(r))<0)throw new Error("Sorry but your stemLength / stemBase ratio is strange.");return{stemLength:s,stemBase:Math.tan(r)*s*2}},e.prototype._getColor=function(e,t,n,i){var r,o,s,a,l;if(null==i&&(i=!1),"string"==typeof n)return n;for(o=i?e.createLinearGradient(0,0,t.width,0):e.createLinearGradient(0,0,0,t.height),s=a=0,l=n.length;a<l;s=++a)r=n[s],o.addColorStop(r[0],r[1]);return o},e.prototype._searchAndActivateCloseButtons=function(){var e,t,n,i;for(t=0,n=(i=this.adapter.findAll(this.container,"."+this.class.close)).length;t<n;t++)e=i[t],this.hideTriggers.push({element:this.adapter.wrap(e),event:"click"});if(this.currentObservers.showing&&this._setupObservers("-showing","showing"),this.currentObservers.visible)return this._setupObservers("-visible","visible")},e.prototype._activateFirstInput=function(){var e;return null!=(e=this.adapter.unwrap(this.adapter.find(this.container,"input, textarea")))&&"function"==typeof e.focus?e.focus():void 0},e.prototype._followMousePosition=function(){if(!this.options.fixed)return e._observeMousePosition(this.bound.reposition)},e.prototype._stopFollowingMousePosition=function(){if(!this.options.fixed)return e._stopObservingMousePosition(this.bound.reposition)},e.prototype._clearShowTimeout=function(){return clearTimeout(this._showTimeoutId)},e.prototype._clearHideTimeout=function(){return clearTimeout(this._hideTimeoutId)},e.prototype._clearTimeouts=function(){return clearTimeout(this._visibilityStateTimeoutId),this._clearShowTimeout(),this._clearHideTimeout()},e.prototype._triggerElementExists=function(){var e;for(e=this.adapter.unwrap(this.triggerElement);e.parentNode;){if("BODY"===e.parentNode.tagName)return!0;e=e.parentNode}return!1},e.prototype._loadAjax=function(){var e=this;if(!this.loading)return this.loaded=!1,this.loading=!0,this.adapter.addClass(this.container,this.class.loading),this.setContent(""),this.adapter.ajax({url:this.options.ajax,method:this.options.ajaxMethod,onSuccess:function(t){return e.adapter.removeClass(e.container,e.class.loading),e.setContent(t)},onError:function(t){var n;return n=e.options.ajaxErrorMessage,e.setContent(n),e.adapter.addClass(e.container,e.class.ajaxError)},onComplete:function(){return e.adapter.removeClass(e.container,e.class.loading),e.loading=!1,e.loaded=!0,e._searchAndActivateCloseButtons(),e._activateFirstInput(),e.reposition()}})},e.prototype._ensureTriggerElement=function(){if(!this._triggerElementExists())return this.deactivate(),this._stopEnsureTriggerElement()},e.prototype._ensureTriggerElementInterval=1e3,e.prototype._startEnsureTriggerElement=function(){var e=this;return this._ensureTriggerElementTimeoutId=setInterval(function(){return e._ensureTriggerElement()},this._ensureTriggerElementInterval)},e.prototype._stopEnsureTriggerElement=function(){return clearInterval(this._ensureTriggerElementTimeoutId)},e}(),l=["khtml","ms","o","moz","webkit"],n.prototype.setCss3Style=function(e,t){var n,i,r,o,s;for(n in e=this.adapter.unwrap(e),s=[],t)f.call(t,n)&&(i=t[n],null!=e.style[n]?s.push(e.style[n]=i):s.push(function(){var t,s,a;for(a=[],t=0,s=l.length;t<s;t++)r=l[t],o=""+this.ucfirst(r)+this.ucfirst(n),null!=e.style[o]?a.push(e.style[o]=i):a.push(void 0);return a}.call(this)));return s},n.prototype.defer=function(e){return setTimeout(e,0)},n.prototype.setTimeout=function(e,t){return setTimeout(e,t?1e3*t:0)},n.prototype.ucfirst=function(e){return null==e?"":e.charAt(0).toUpperCase()+e.slice(1)},n.prototype.dasherize=function(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})},s=[],o={x:0,y:0},function(e){var t,i,r,a;for(o=n.adapter.mousePosition(e),a=[],i=0,r=s.length;i<r;i++)t=s[i],a.push(t());return a},n._observeMousePosition=function(e){return s.push(e)},n._stopObservingMousePosition=function(e){var t;return s=function(){var n,i,r;for(r=[],n=0,i=s.length;n<i;n++)(t=s[n])!==e&&r.push(t);return r}()},n.Joint=function(){function e(e){null!=e&&(e instanceof n.Joint&&(e=e.toString()),this.set(e))}return e.prototype.set=function(e){return e=e.toLowerCase(),this.setHorizontal(e),this.setVertical(e),this},e.prototype.setHorizontal=function(e){var t,n,i,r,o,s,a;for(i=0,o=(n=["left","center","right"]).length;i<o;i++)t=n[i],~e.indexOf(t)&&(this.horizontal=t.toLowerCase());for(null==this.horizontal&&(this.horizontal="center"),a=[],r=0,s=n.length;r<s;r++)t=n[r],a.push(this[t]=this.horizontal===t?t:void 0);return a},e.prototype.setVertical=function(e){var t,n,i,r,o,s,a;for(i=0,o=(n=["top","middle","bottom"]).length;i<o;i++)t=n[i],~e.indexOf(t)&&(this.vertical=t.toLowerCase());for(null==this.vertical&&(this.vertical="middle"),a=[],r=0,s=n.length;r<s;r++)t=n[r],a.push(this[t]=this.vertical===t?t:void 0);return a},e.prototype.eql=function(e){return null!=e&&this.horizontal===e.horizontal&&this.vertical===e.vertical},e.prototype.flip=function(){var e;return e=(n.position[this.toString(!0)]+4)%8,this.set(n.positions[e]),this},e.prototype.toString=function(e){var t,i;return null==e&&(e=!1),i="middle"===this.vertical?"":this.vertical,t="center"===this.horizontal?"":this.horizontal,i&&t&&(t=e?n.prototype.ucfirst(t):" "+t),""+i+t},e}(),n.prototype._positionsEqual=function(e,t){return null!=e&&null!=t&&e.left===t.left&&e.top===t.top},n.prototype._dimensionsEqual=function(e,t){return null!=e&&null!=t&&e.width===t.width&&e.height===t.height},n.prototype.debug=function(){var e;if(e=1<=arguments.length?u.call(arguments,0):[],n.debug&&null!=("undefined"!=typeof console&&null!==console?console.debug:void 0))return e.unshift("#"+this.id+" |"),console.debug.apply(console,e)},n.version="2.4.6",n.debug=!1,n.lastId=0,n.lastZIndex=100,n.tips=[],n._abortShowingGroup=function(e,t){var i,r,o,s,a;for(a=[],r=0,o=(s=n.tips).length;r<o;r++)(i=s[r])!==t&&i.options.group===e?a.push(i._abortShowing()):a.push(void 0);return a},n._hideGroup=function(e,t){var i,r,o,s,a;for(a=[],r=0,o=(s=n.tips).length;r<o;r++)(i=s[r])!==t&&i.options.group===e?a.push(i.hide()):a.push(void 0);return a},n.adapters={},n.adapter=null,i=!0,n.addAdapter=function(e){if(n.adapters[e.name]=e,i)return n.adapter=e,i=!1},n.positions=["top","topRight","right","bottomRight","bottom","bottomLeft","left","topLeft"],n.position={},r=d=0,h=(c=n.positions).length;d<h;r=++d)a=c[r],n.position[a]=r;n.styles={standard:{extends:null,title:void 0,escapeTitle:!0,escapeContent:!1,className:"standard",stem:!0,delay:null,hideDelay:.1,fixed:!1,showOn:"mouseover",hideTrigger:"trigger",hideTriggers:[],hideOn:null,removeElementsOnHide:!1,offset:[0,0],containInViewport:!0,autoOffset:!0,showEffect:"appear",hideEffect:"fade",showEffectDuration:.3,hideEffectDuration:.2,stemLength:5,stemBase:8,tipJoint:"top left",target:null,targetJoint:null,cache:!0,ajax:!1,ajaxMethod:"GET",ajaxErrorMessage:"There was a problem downloading the content.",group:null,style:null,background:"#fff18f",backgroundGradientHorizontal:!1,closeButtonOffset:[5,5],closeButtonRadius:7,closeButtonCrossSize:4,closeButtonCrossColor:"#d2c35b",closeButtonCrossLineWidth:1.5,closeButtonLinkOverscan:6,borderRadius:5,borderWidth:1,borderColor:"#f2e37b",shadow:!0,shadowBlur:10,shadowOffset:[3,3],shadowColor:"rgba(0, 0, 0, 0.1)"},glass:{extends:"standard",className:"glass",background:[[0,"rgba(252, 252, 252, 0.8)"],[.5,"rgba(255, 255, 255, 0.8)"],[.5,"rgba(250, 250, 250, 0.9)"],[1,"rgba(245, 245, 245, 0.9)"]],borderColor:"#eee",closeButtonCrossColor:"rgba(0, 0, 0, 0.2)",borderRadius:15,closeButtonRadius:10,closeButtonOffset:[8,8]},dark:{extends:"standard",className:"dark",borderRadius:13,borderColor:"#444",closeButtonCrossColor:"rgba(240, 240, 240, 1)",shadowColor:"rgba(0, 0, 0, 0.3)",shadowOffset:[2,2],background:[[0,"rgba(30, 30, 30, 0.7)"],[.5,"rgba(30, 30, 30, 0.8)"],[.5,"rgba(10, 10, 10, 0.8)"],[1,"rgba(10, 10, 10, 0.9)"]]},alert:{extends:"standard",className:"alert",borderRadius:1,borderColor:"#AE0D11",closeButtonCrossColor:"rgba(255, 255, 255, 1)",shadowColor:"rgba(0, 0, 0, 0.3)",shadowOffset:[2,2],background:[[0,"rgba(203, 15, 19, 0.7)"],[.5,"rgba(203, 15, 19, 0.8)"],[.5,"rgba(189, 14, 18, 0.8)"],[1,"rgba(179, 14, 17, 0.9)"]]}},n.defaultStyle="standard",n.getTips=function(e){return n.adapter.data(e,"__opentips")||[]},n.setTips=function(e,t){return n.adapter.data(e,"__opentips",t||[])},n.removeTip=function(e){for(var t=n.tips.length;t--;){if(n.tips[t])return n.tips.splice(t,1)}},n.addTip=function(e){n.tips.push(e)},void 0!==e&&null!==e?e.exports=n:window.Opentip=n;u=[].slice;!function(e){var t;jQuery.fn.opentip=function(e,t,i){return new n(this,e,t,i)},t=function(){function t(){}return t.prototype.name="jquery",t.prototype.domReady=function(e){return jQuery(e)},t.prototype.create=function(e,t){if(t){var n=t.createElement("div");return n.innerHTML=e,(n=n.firstChild).parentNode.removeChild(n),jQuery(n)}return jQuery(e)},t.prototype.wrap=function(t){if((t=e(t)).length>1)throw new Error("Multiple elements provided.");return t},t.prototype.unwrap=function(t){return e(t)[0]},t.prototype.tagName=function(e){return this.unwrap(e).tagName},t.prototype.attr=function(){var t,n,i;return n=arguments[0],t=2<=arguments.length?u.call(arguments,1):[],(i=e(n)).attr.apply(i,t)},t.prototype.data=function(){var e,t,n;return t=arguments[0],e=2<=arguments.length?u.call(arguments,1):[],(n=jQuery(t)).data.apply(n,e)},t.prototype.find=function(e,t){return jQuery(e).find(t).get(0)},t.prototype.findAll=function(e,t){return jQuery(e).find(t)},t.prototype.update=function(e,t,n){return e=jQuery(e),n?e.text(t):e.html(t)},t.prototype.append=function(t,n){return e(t).append(n)},t.prototype.prepend=function(t,n){return e(t).prepend(n)},t.prototype.remove=function(t){return e(t).remove()},t.prototype.addClass=function(t,n){return e(t).addClass(n)},t.prototype.removeClass=function(t,n){return e(t).removeClass(n)},t.prototype.css=function(t,n){return e(t).css(n)},t.prototype.dimensions=function(t){return{width:e(t).outerWidth(),height:e(t).outerHeight()}},t.prototype.scrollOffset=function(e,t){return[e.pageXOffset||t.documentElement.scrollLeft||t.body.scrollLeft,e.pageYOffset||t.documentElement.scrollTop||t.body.scrollTop]},t.prototype.viewportDimensions=function(e){return{width:e.documentElement.clientWidth,height:e.documentElement.clientHeight}},t.prototype.mousePosition=function(e){return null==e?null:{x:e.pageX,y:e.pageY}},t.prototype.offset=function(e){var t;return{left:(t=jQuery(e).offset()).left,top:t.top}},t.prototype.observe=function(t,n,i){return e(t).bind(n,i)},t.prototype.stopObserving=function(t,n,i){return e(t).unbind(n,i)},t.prototype.ajax=function(e){var t,n;if(null==e.url)throw new Error("No url provided");return jQuery.ajax({url:e.url,type:null!=(t=null!=(n=e.method)?n.toUpperCase():void 0)?t:"GET"}).done(function(t){return"function"==typeof e.onSuccess?e.onSuccess(t):void 0}).fail(function(t){return"function"==typeof e.onError?e.onError("Server responded with status "+t.status):void 0}).always(function(){return"function"==typeof e.onComplete?e.onComplete():void 0})},t.prototype.clone=function(e){return jQuery.extend({},e)},t.prototype.extend=function(){var t,n;return n=arguments[0],t=2<=arguments.length?u.call(arguments,1):[],jQuery.extend.apply(e,[n].concat(u.call(t)))},t}(),n.addAdapter(new t)}(jQuery);var g={removeElementsOnHide:!0,fixed:!0,showOn:"creation"},m={titleTemplate:"Changed by %u %t",delay:1e3};t.OpentipAdapter=function(){},t.OpentipAdapter.prototype={init:function(e){this._options=jQuery.extend(m,e||{}),this._tips=[]},showTooltip:function(e,t,i){var r=jQuery.extend({target:e,boundingElement:i},g),o=new n(e,t,r);o.show(),jQuery(e).data("_flite_tip_",o)},hideAll:function(e){try{for(var t=n.tips.length;t--;)n.tips[t].deactivate()}catch(e){}if(e&&e.ownerDocument)try{n.adapter.wrap(e.ownerDocument.body).find("div."+n.prototype.class.container).remove()}catch(e){}},hideTooltip:function(e,t){var i=n.getTips(e);if(i){var r={};t&&(r.hideDelay=0,r.hideEffectDuration=0);for(var o=i.length;o--;)i[o].deactivate(r)}}}}(window),Object.defineProperty(t,"__esModule",{value:!0});var s={mcetoggleformat:1,bold:1,underline:1,italic:1,undo:1,redo:1},a={insertunorderedlist:1,insertorderedlist:1};!function(e){var t=tinymce.PluginManager;t.requireLangPack("flite","en,fr,de"),t.add("flite",function(e,t){var n=new h(e,t);return n.initPlugin(e,e.settings&&e.settings.flite),n});var n={INIT:"flite:init",ACCEPT:"flite:accept",REJECT:"flite:reject",SHOW_HIDE:"flite:showHide",TRACKING:"flite:tracking",CHANGE:"flite:change",HOVER_IN:"flite:hover-in",HOVER_OUT:"flite:hover-out"},i={TOGGLE_TRACKING:"flite-toggletracking",TOGGLE_SHOW:"flite-toggleshow",ACCEPT_ALL:"flite-acceptall",REJECT_ALL:"flite-rejectall",ACCEPT_ONE:"flite-acceptone",REJECT_ONE:"flite-rejectone",TOGGLE_TOOLTIPS:"flite-toggletooltips"},r={deleteClass:"ice-del",insertClass:"ice-ins",attributes:{lite2Created:"data-flite-created",lite2Marked:"data-flite-marked",changeId:"data-flite-cid",userId:"data-userid",userName:"data-username",sessionId:"data-session-id",changeData:"data-changedata",time:"data-time",lastTime:"data-last-change-time"},ignoredInsertSelectors:"[data-cke-temp],.opentip-container",ignoredDeleteSelectors:"[data-cke-temp]",trackedInsertSelectors:"",trackedDeleteSelectors:"table,br,tr,td,ul,ol,li,p,div,span",ignoredSelectors:"[data-track-changes-ignore],.opentip-container,.mce-resizehandle,[data-mce-type='bookmark'],span#__caret",stylePrefix:"ice-cts",preserveOnPaste:"p",css:"/css/flite.css"},o=new RegExp("(?:^|s)(?:"+r.deleteClass+"|"+r.insertClass+")(?:s|$)");function l(e){var t=e;return t&&t.className&&o.test(t.className)}function d(e){if(!e||!e.length)return[];var t=[];return e.forEach(function(e){t=t.concat(function e(t){var n,i;if(t.nodeType===Node.ELEMENT_NODE){var r=t.childNodes;for(n=0;n<r.length;++n)if(e(i=r[n]),l(i)){for(;i.firstChild;)t.insertBefore(i.firstChild,i);t.removeChild(i)}}return l(t)?jQuery.makeArray(t.childNodes):[t]}(e))}),t}var h=function(){function t(e,t){this.path=t,this._domLoaded=!1,this._editor=null,this._removeBindings=[],this._isTracking=!0,this._isVisible=!0,this._trackingState=null,this._tracker=null,this._canAcceptReject=!0,this._fliteCommandNames=[],this._onReadyInterval=null,this._buttons={},this._editor=e}return t.prototype.initPlugin=function(t,n){this._editor=t,this._config=$.extend({},n),e.Logger.config(this._config.debug);this._config.tooltips={show:!0,path:"js/opentip-adapter.min.js",classPath:"OpentipAdapter",cssPath:"/css/opentip.css",delay:500,events:null}},t.prototype.init=function(e,t){var n=this,r=function(t){e.addCommand(t.cmd,t.callback,n);var i={tooltip:n._getLocalizedString(t.tooltip),image:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Array.prototype.slice.apply(e,[]).join("/").replace(/(^|[^:])\/[\/]+/g,"$1/")}(n.path,"icons",t.cmd+".png"),cmd:t.cmd,onPostRender:function(e){n._buttons[t.cmd]=e.control}};e.addButton(t.cmd,i),!1!==t.trackingOnly&&n._fliteCommandNames.push(t.cmd)};[{cmd:i.TOGGLE_TRACKING,callback:this._onToggleTracking,tooltip:"TOGGLE_TRACKING",trackingOnly:!1},{cmd:i.TOGGLE_SHOW,callback:this._onToggleShow,tooltip:"TOGGLE_SHOW"},{cmd:i.ACCEPT_ALL,callback:this._onAcceptAll,tooltip:"ACCEPT_ALL"},{cmd:i.REJECT_ALL,callback:this._onRejectAll,tooltip:"REJECT_ALL"},{cmd:i.ACCEPT_ONE,callback:this._onAcceptOne,tooltip:"ACCEPT_ONE"},{cmd:i.REJECT_ONE,callback:this._onRejectOne,tooltip:"REJECT_ONE"}].forEach(function(e){r(e)});var o=e.settings.toolbar,s=typeof o;if(o&&"boolean"!==s&&o.indexOf("FLITE.Commands.TOGGLE_TRACKING")<0){var a=["",i.TOGGLE_TRACKING,i.TOGGLE_SHOW,i.ACCEPT_ALL,i.REJECT_ALL,i.ACCEPT_ONE,i.REJECT_ONE];"string"===s?e.settings.toolbar+=a.join(" "):a.forEach(function(e){return o.push(e)})}this._domLoaded=!1,e.once("SetContent",function(){n._domLoaded||n._onDomLoaded()})},Object.defineProperty(t.prototype,"version",{get:function(){return"1.1.19"},enumerable:!0,configurable:!0}),t.prototype._uninit=function(){},t.prototype._onToggleTracking=function(e){return this.toggleTracking(),!0},t.prototype._onToggleShow=function(e){return this.toggleShow(),!0},t.prototype._onRejectAll=function(e){return this.rejectAll(null),!0},t.prototype._onAcceptAll=function(e){return this.acceptAll(null),!0},t.prototype._onAcceptOne=function(e){var t=this._tracker.currentChangeNode(this._getSelectedNode());return this.acceptChange(t)},t.prototype._onRejectOne=function(e){var t=this._tracker.currentChangeNode(this._getSelectedNode());return this.rejectChange(t)},t.prototype._onToggleTooltips=function(){this._tracker&&this._tracker.toggleTooltips()},t.prototype.acceptChange=function(e){return e&&this._tracker&&(this._tracker.acceptChange(e),this._cleanup(),this._editor.fire(n.ACCEPT,{flite:this}),this._onSelectionChanged()),!0},t.prototype.rejectChange=function(e){return e&&this._tracker&&(this._tracker.rejectChange(e),this._cleanup(),this._editor.fire(n.REJECT,{flite:this}),this._onSelectionChanged()),!0},t.prototype._getSelectedNode=function(){var e=this._tracker&&this._tracker.getSelectedNode();if(e)return e;var t=this._editor.selection;return t?t&&(t.isCollapsed()?t.getStart():t.getNode()):null},t.prototype._setCommandsState=function(e,t){var n;"string"==typeof e&&(e=e.split(",").map(function(e){return e&&e.trim()}).filter(Boolean));for(var i=e.length-1;i>=0;--i)(n=this._buttons[e[i]])&&n.disabled(!t)},t.prototype._onSelectionChanged=function(){var e=this._getSelectedNode(),t=this._isTracking&&this._tracker&&this._tracker.isInsideChange(e,!1);this._setCommandsState([i.ACCEPT_ONE,i.REJECT_ONE],t&&this._canAcceptReject)},t.prototype._onTrackerChange=function(e){var t=this._isTracking&&this._tracker&&this._tracker.hasChanges();this._setCommandsState([i.ACCEPT_ALL,i.REJECT_ALL],t),setTimeout(this._onSelectionChanged.bind(this),0),e&&this._triggerChange()},t.prototype._onTrackerTextChanged=function(){this._editor.fire("change"),this._editor.fire("saveSnapshot")},t.prototype._triggerChange=function(){this._changeTimeout||(this._changeTimeout=setTimeout(this._notifyChange,1))},t.prototype._notifyChange=function(){},t.prototype._notifyTextChange=function(){this._changeTimeout=null,this._editor.fire("change",{flite:this})},t.prototype.isEditorEditable=function(){return!0},t.prototype._updateTrackingState=function(e){if(this._tracker){var t=this._isTracking;if((t!==this._trackingState||e)&&(this._trackingState=t,this._tracker.toggleChangeTracking(t,this._getBody()),this._releaseEventBindings(),this._tracker.unlistenToEvents(),t)){this.isEditorEditable();this._tracker.listenToEvents(),this._addEvent("click",this._onSelectionChanged),this._addEvent("selectionChange",this._onSelectionChanged),this._addEvent("mousedown",this._onMouseDown),this._addEvent("keypress",this._onKeyPress),this._addEvent("ExecCommand",this._onAfterCommand),this._addEvent("BeforeExecCommand",this._onBeforeCommand),this._addEvent("BeforeSetContent",this._onBeforeSetContent),this._addEvent("SetContent",this._onSetContent),this._addEvent("PastePreProcess",this._onPreProcessPaste),this._addEvent("Paste",this._onPaste),this._addEvent("NodeChange",this._onSelectionChanged)}}},t.prototype.toggleTracking=function(e,t){"boolean"==typeof t&&(t={notify:t}),t=t||{};var n=void 0===e?!this._isTracking:e,i=(this._editor,t&&t.force);if(!n&&this._isTracking&&!i&&this._tracker.countChanges({verify:!0}))return window.alert(this._getLocalizedString("PENDING_CHANGES"));this._isTracking=n,this._setCommandsState(this._fliteCommandNames,n),this._updateTrackingState(Boolean(t.force)),this._onTrackerChange(null),this.toggleShow(n,!1)},t.prototype.toggleShow=function(e,t){var n=void 0===e?!this._isVisible:e;this._isVisible=n,this._tracker&&this._tracker.setShowChanges(n&&this._isTracking)},t.prototype.acceptAll=function(e){this._tracker.acceptAll(e),this._cleanup(),this._editor.fire(n.ACCEPT,{flite:this,options:e})},t.prototype.rejectAll=function(e){this._tracker.rejectAll(e),this._cleanup(),this._editor.fire(n.REJECT,{flite:this,options:e})},t.prototype.setUserInfo=function(e){this._user=$.extend(!0,{},{name:this._config.userName||"user",id:this._config.userId||"0"},e&&{name:e.name,id:e.id}),e&&this._tracker&&this._tracker.setCurrentUser(e)},t.prototype._cleanup=function(){var e=this._getBody();jQuery(e).find("span."+r.insertClass+":empty,span."+r.deleteClass+":empty").remove(),this._onSelectionChanged()},t.prototype._onMouseDown=function(){this._hideTooltip(null)},t.prototype.isCutKeystroke=function(e){return!1},t.prototype._onKeyPress=function(e){this.isCutKeystroke(e.keyCode)&&e.stopPropagation()},t.prototype._hideTooltip=function(e){if(this._config.tooltips.events)return this._editor&&this._editor.fire(n.HOVER_OUT,{flite:this,node:e});this._tooltipsHandler&&(e?this._tooltipsHandler.hideTooltip(e||this._tracker&&this._tracker.getTrackedNodes()):this._tooltipsHandler.hideAll(this._getBody()))},t.prototype._beforeInsert=function(){},t.prototype._afterInsert=function(){},t.prototype.padString=function(e,t,n,i){var r;r=null===e||void 0===e?"":String(e);for(var o=(n=String(n)).length,s=r.length;s<t;s+=o)i?r+=n:r=n+r;return r},t.prototype.padNumber=function(e,t){return this.padString(e,t,"0",!1)},t.prototype.relativeDateFormat=function(t){var n,i,r,o=new Date,s=o.getDate(),a=o.getMonth(),l=o.getFullYear(),d=typeof t;return s==(n="string"===d||"number"===d?new Date(n):t).getDate()&&a==n.getMonth()&&l==n.getFullYear()?(i=Math.floor((o.getTime()-n.getTime())/6e4))<1?this._getLocalizedString("NOW"):i<2?this._getLocalizedString("MINUTE_AGO"):i<60?this._getLocalizedString("MINUTES_AGO").replace("%Minutes",i):(r=n.getHours(),i=n.getMinutes(),this._getLocalizedString("AT")+" "+this.padNumber(r,2)+":"+this.padNumber(i,2)):this._getLocalizedString("ON")+" "+e.utils.makeDateLabel(this._getLocalizedString.bind(this),n.getDate(),n.getMonth(),l===n.getFullYear()?null:n.getFullYear())},t.prototype._makeTooltipTitle=function(e){window.jQuery;var t=new Date(e.time),n=(this._getLocalizedString.bind(this),new Date(e.lastTime)),i=this._config.tooltipTemplate||"%a by %u %t";return i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=i.replace(/%a/g,"insert"===e.type?this._getLocalizedString("CHANGE_TYPE_ADDED"):this._getLocalizedString("CHANGE_TYPE_DELETED"))).replace(/%t/g,this.relativeDateFormat(t))).replace(/%u/g,e.username)).replace(/%dd/g,this.padNumber(t.getDate(),2))).replace(/%d/g,String(t.getDate()))).replace(/%mm/g,this.padNumber(t.getMonth()+1,2))).replace(/%m/g,String(t.getMonth()+1))).replace(/%yy/g,this.padNumber(t.getFullYear()%100,2))).replace(/%y/g,String(t.getFullYear()))).replace(/%nn/g,this.padNumber(t.getMinutes(),2))).replace(/%n/g,String(t.getMinutes()))).replace(/%hh/g,this.padNumber(t.getHours(),2))).replace(/%h/g,String(t.getHours()))).replace(/%T/g,this.relativeDateFormat(n))).replace(/%DD/g,this.padNumber(n.getDate(),2))).replace(/%D/g,String(n.getDate()))).replace(/%MM/g,this.padNumber(n.getMonth()+1,2))).replace(/%M/g,String(n.getMonth()+1))).replace(/%YY/g,this.padNumber(n.getFullYear()%100,2))).replace(/%Y/g,String(n.getFullYear()))).replace(/%NN/g,this.padNumber(n.getMinutes(),2))).replace(/%N/g,String(n.getMinutes()))).replace(/%HH/g,this.padNumber(n.getHours(),2))).replace(/%H/g,String(n.getHours()))},t.prototype._getBody=function(){return this._editor.getBody()},t.prototype._getDocument=function(){return this._getBody().ownerDocument},t.prototype.onScriptsLoaded=function(){var t=this._config;if(t.tooltips){var n=e.DefaultTooltips;if(n){try{this._tooltipsHandler=new n}catch(e){}this._tooltipsHandler?this._tooltipsHandler.init(t.tooltips):e.Logger.error("Unable to create tooltip handler",t.tooltips.classPath)}}},t.prototype._loadCSS=function(e,t){var n=e.getElementsByTagName("head")[0],i=t.cssPath,r=this.path;function o(t,i){if(t){var o=jQuery(n).find("#"+i);o.length||((o=e.createElement("link")).setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("id",i),o.setAttribute("href",r+t),n.appendChild(o))}}!1!==i&&o(i||t.defaultCssPath,"__lite__css__"),this._config.tooltips.cssPath&&o(this._config.tooltips.cssPath,"__lite_tt_css__")},t.prototype._onReady=function(){this._domLoaded&&e.rangy.isInitialized()?(this._onReadyInterval&&(clearInterval(this._onReadyInterval),this._onReadyInterval=null),this.onScriptsLoaded(),this._afterReady()):this._onReadyInterval||(this._onReadyInterval=window.setInterval(this._onReady.bind(this),100))},t.prototype._getHostRange=function(){return this._editor.selection.getRng(!0)},t.prototype._setHostRange=function(e){var t=this._editor&&this._editor.selection;t&&t.setRng(e)},t.prototype._hostCopy=function(){console.log("TODO: _hostCopy")},t.prototype._beforeEdit=function(){this._editor.undoManager.add()},t.prototype._showTooltip=function(e,t){console.log("-D- show tooltip");var i=this._config.tooltips;if(i.events)return this._editor&&this._editor.fire(n.HOVER_IN,{flite:this,node:e,changeId:t.id});if(i.show){var r=this._makeTooltipTitle(t);this._tooltipsHandler&&(this._tooltipsHandler.hideAll(this._getBody()),this._tooltipsHandler.showTooltip(e,r,this._editor.getContainer()))}},t.prototype._afterReady=function(){var t=this._editor,i=this._getDocument(),o=this._getBody(),s=this._config,a=this._hideTooltip.bind(this);s&&s.debug;if(this._loadCSS(i,{cssPath:s.cssPath,defaultCssPath:r.css}),this._tracker&&(e.utils.isFLITEBody(o)||(this._tracker.toggleChangeTracking(!1,null),jQuery(this._tracker).unbind(),this._tracker.dispose(),this._tracker=null)),e.utils.markFLITEBody(o),!this._tracker){var l={element:o,mergeBlocks:!1,changeGroupTime:200,opaqueSelectors:".cke_widget_wrapper,.cke_widget_placeholder",userStyles:s.userStyles,changeTypes:{insertType:{alias:r.insertClass,action:"Inserted"},deleteType:{alias:r.deleteClass,action:"Deleted"}},hostMethods:{getHostRange:this._getHostRange.bind(this),nativeNodeToHostNode:function(e){return new tinymce.activeEditor.dom.element(e)},hostNodeToNativeNode:function(e){return e},setHostRange:this._setHostRange.bind(this),getNewLineNodeName:this._getNewlineNodeName.bind(this),beforeEdit:this._beforeEdit.bind(this),getHostNativeRange:this._getHostRange.bind(this),showTooltip:this._showTooltip.bind(this),hideTooltip:a,beforeDelete:a,beforeInsert:a,updateLastUndo:this._updateLastUndo.bind(this),getLocalizedString:this._getLocalizedString.bind(this)},tooltipsDelay:s.tooltips&&s.tooltips.delay||100,tooltips:s.tooltips.show||!0,attributes:void 0,classes:void 0,ignoredSelectors:void 0,ignoredInsertSelectors:void 0,ignoredDeleteSelectors:void 0,trackedDeleteSelectors:void 0,trackedInsertSelectors:void 0,attrValuePrefix:void 0,blockEl:void 0,stylePrefix:void 0,contentEditable:void 0,isVisible:!0,_changeData:void 0,handleSelectAll:void 0};jQuery.extend(l,r),this._tracker=new e.InlineChangeEditor(l);try{this.setUserInfo(this._user),this._tracker.toggleChangeTracking(!0,o),this.toggleTracking(this._isTracking,!1),this._updateTrackingState(!0),jQuery(this._tracker).on("change",this._onTrackerChange.bind(this)).on("textChange",this._onTrackerTextChanged.bind(this)),t.fire(n.INIT,{flite:this}),this._onSelectionChanged(),this._onTrackerChange(null)}catch(t){e.Logger.error("FLITE plugin init:",t)}}},t.prototype._onPreProcessPaste=function(e){var t=document.createElement("div");return t.innerHTML=e.content,this._tracker.getCleanDOM(t,null),e.content=t.innerHTML,e.content},t.prototype._onPaste=function(t){var n=t;e.Logger.log(n)},t.prototype._onDomLoaded=function(){this._domLoaded=!0;var e=this._getDocument();e&&e.body.addEventListener("mscontrolselect",function(e){e.preventDefault()}),this._hideTooltip(null),this._onReady()},t.prototype._getNewlineNodeName=function(){return"P"},t.prototype._onAfterCommand=function(e){if(this._editor&&this._tracker&&this._trackingState){var t=(e.command||"").toLowerCase();"undo"!==t&&"redo"!==t||this._tracker.reload(null)}},t.prototype._onBeforeSetContent=function(e){this._tracker&&"delete"!==this._tracker.getMutationContext()&&this._tracker.ignoreNextMutation()},t.prototype._onSetContent=function(){if(this._hideTooltip(null),this._tracker&&this._trackingState){var t=this._getBody();this._tracker.reload(e.utils.isFLITEBody(t)?null:t)}},t.prototype._onBeforeCommand=function(t){if(this._editor&&this._tracker&&this._trackingState){var n=(t.command||"").toLowerCase();if(e.Logger.debug("before command:",n),n in s)e.Logger.debug("skipping command",n),this._tracker.ignoreNextMutation();else if(n in a){var i=this._getSelectedNode(),r=e.domUtils.matchesSelector(i,"li,ol,ul,li *,ol *, ul *");this._tracker.setMutationContext(r?"remove-list":"insert-list",null)}else"mceinsertcontent"===n?this._processInsert(t):"delete"===n&&this._tracker.setMutationContext("delete",null)}},t.prototype._processInsert=function(t){if(t.value)if(this._isOverridingCommand)this._isOverridingCommand=!1;else{this._isOverridingCommand=!0,t.preventDefault(),t.stopImmediatePropagation();var n="string"==typeof t.value?t.value:t.value.content;if("string"==typeof n){this._tracker.ignoreNextMutation();var i=this._processInsertedHtml(n);try{t.target.insertContent(i)}catch(t){e.Logger.error("while inserting content",t)}finally{this._isOverridingCommand=!1}}}},t.prototype._prepareNodesForPaste=function(e){if(!(this._tracker&&this._isTracking&&e&&e.length))return null;var t=null;return e.length&&(e=d(e),t=this._tracker.processNodesForInsert(e)),t},t.prototype._processInsertedHtml=function(e){var t=this._getDocument().createElement("div");t.innerHTML=e;var n=this._tracker.getCleanDOM(t,null);if(!n.innerHTML)return e;var i=jQuery.makeArray(n.childNodes),r=this._prepareNodesForPaste(i);if(r&&r.length)try{return r.map(function(e){return e.nodeType===Node.TEXT_NODE?e.data:e.outerHTML}).join("")}catch(t){return e}},t.prototype._updateLastUndo=function(){},t.prototype._hasChanges=function(){return this._isTracking&&this._tracker&&this._tracker.hasChanges()},t.prototype._addEvent=function(e,t,n){void 0===n&&(n=!0);var i=n?t.bind(this):t;this._removeBindings.push({event:e,context:this._editor.on(e,i),callback:i})},t.prototype._releaseEventBindings=function(){var e,t=this._removeBindings.filter(Boolean);this._removeBindings=[];for(var n=t.length-1;n>=0;--n)(e=t[n]).context.off(e.event,e.callback)},t.prototype._getLocalizedString=function(e){if(!e)return"";var t=0===e.indexOf("flite_")?e:"flite_"+e,n=this._editor&&this._editor.editorManager.i18n.translate(t)||e||e;return n&&(n=n.replace(/^flite_/,"")),n},t}();!function(){function e(t,n,i){var r=this;this.callback=i,this.id=String(e.nextId++),e._guards[this.id]=this;var o=function(a){n&&n!==a.command||(delete e._guards[r.id],t.off("ExecCommand",o),s&&(clearTimeout(s),s=null),i())};t.on("ExecCommand",o);var s=setTimeout(function(){s=0,t.off("ExecCommand",o),delete e._guards[r.id]},1)}e._guards={},e.nextId=0}()}(window.FLITE)}()}).call(this,n(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}]);